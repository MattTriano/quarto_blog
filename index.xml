<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Matt Triano</title>
<link>https://www.matttriano.dev/index.html</link>
<atom:link href="https://www.matttriano.dev/index.xml" rel="self" type="application/rss+xml"/>
<description>Experiments, walkthroughs past-me would have liked, and gifts to future me</description>
<generator>quarto-1.3.433</generator>
<lastBuildDate>Fri, 23 Jun 2023 00:00:00 GMT</lastBuildDate>
<item>
  <title>Data Quality Monitoring with Great Expectations</title>
  <dc:creator>Matt Triano</dc:creator>
  <link>https://www.matttriano.dev/posts/006_great_expectations_setup/data_monitoring_w_gx_1_setup.html</link>
  <description><![CDATA[ 




<div class="cell" data-execution_count="1">
<details>
<summary>Imports and path-definition</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> collections <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Counter</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> dt</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pathlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Path</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> urllib.request <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> urlretrieve</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> geopandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> gpd</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-8"></span>
<span id="cb1-9">PROJECT_DIR <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Path(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"."</span>).resolve()</span>
<span id="cb1-10">PROJECT_DATA_DIR <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> PROJECT_DIR.joinpath(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>)</span></code></pre></div>
</details>
</div>
<p>Great Expectations (or GX for short) is an open-source Python-based library that brings the idea of “testing” to your data. It enables you to define expectations for properties of your datasets (like records per batch, distribution of values in a column, columns in a table, etc) and check that the data meets those expectations when the data is updated.</p>
<section id="workflow-overview" class="level1">
<h1>Workflow Overview</h1>
<p>The high-level <code>great_expectations</code> workflow follows this pattern:</p>
<ol start="0" type="1">
<li>Install <code>great_expectations</code>.</li>
<li>Create (or load) a <a href="https://docs.greatexpectations.io/docs/guides/setup/configuring_data_contexts/instantiating_data_contexts/instantiate_data_context"><code>DataContext</code></a> for your project.</li>
<li>Connect <a href="https://docs.greatexpectations.io/docs/terms/datasource/"><code>Datasources</code></a> to your <code>DataContext</code>.</li>
<li>Define <a href="https://docs.greatexpectations.io/docs/guides/connecting_to_your_data/connect_to_data_lp/"><code>DataAssets</code></a></li>
<li>Define <a href="https://docs.greatexpectations.io/docs/guides/expectations/expectations_lp"><code>Expectations</code></a> for your <code>DataAssets</code>.</li>
<li>Set <a href="https://docs.greatexpectations.io/docs/guides/validation/validate_data_lp"><code>Checkpoints</code></a> to validate your <code>DataAssets</code>.</li>
</ol>
<p>In this post, I’ll demonstrate this workflow with local-file-based <code>DataAssets</code> in a local filesystem <code>DataContext</code> (although <code>great_expectations</code> also works with SQL-based and cloud-bucket-based <code>DataAssets</code>).</p>
<section id="sample-data-collection-and-preparation" class="level3">
<h3 class="anchored" data-anchor-id="sample-data-collection-and-preparation">Sample Data Collection and Preparation</h3>
<p>Many data pipelines process data in discrete, periodic batches. I’m going to simulate that situation by downloading a dataset, splitting it into 1-month batches (based on a datetime-like column), and then write each of those 1-month batches to file. I’m going to use the <a href="https://data.cityofchicago.org/Health-Human-Services/Food-Inspections/4ijn-s7e5">Food Inspection dataset</a> on Chicago’s public data portal.</p>
</section>
<section id="step-0-great-expectations-setup" class="level2">
<h2 class="anchored" data-anchor-id="step-0-great-expectations-setup">Step 0: Great Expectations Setup</h2>
<p>First, you’ll need to install the <code>great_expectations</code>. If you already have <code>conda</code> installed on your machine, you can easily set up a <code>conda</code> env just like the one used to run this notebook by: 1. copying the <code>gx_env_environment.yml</code> file in the same dir as this notebook file to your machine, 2. open a terminal and navigate to the dir with that new file, and 3. run command <code>conda env create -f environment.yml</code></p>
<p>If you don’t have <code>conda</code> but would like to, check out my <a href="../../posts/000_setting_up_miniconda/Setting_up_Miniconda.html">opinionated conda install and configuration</a> post.</p>
<div class="cell" data-execution_count="2">
<details>
<summary>Collecting and preprocessing sample data for this post</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">PROJECT_DATA_DIR.mkdir(exist_ok<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb2-2"></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># First, we need to download the data to our local machine.</span></span>
<span id="cb2-4">url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://data.cityofchicago.org/api/geospatial/4ijn-s7e5?method=export&amp;format=GeoJSON"</span></span>
<span id="cb2-5">full_file_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> PROJECT_DATA_DIR.joinpath(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"full_food_inspections.geojson"</span>)</span>
<span id="cb2-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> full_file_path.is_file():</span>
<span id="cb2-7">    urlretrieve(url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>url, filename<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>full_file_path)</span>
<span id="cb2-8">food_inspection_gdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gpd.read_file(full_file_path)</span>
<span id="cb2-9"></span>
<span id="cb2-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For some reason, Socrata adds on these four always-null location columns on</span></span>
<span id="cb2-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   to geospatial exports. I'm going to remove them.</span></span>
<span id="cb2-12">location_cols <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location_state"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location_zip"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location_address"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location_city"</span>]</span>
<span id="cb2-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># uncomment the lines below to confirm those columns are always empty</span></span>
<span id="cb2-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print("Rows with a non-null value in these location_xxx columns:")</span></span>
<span id="cb2-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># display(food_inspection_gdf[location_cols].notnull().sum())</span></span>
<span id="cb2-16">food_inspection_gdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> food_inspection_gdf.drop(columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>location_cols)</span>
<span id="cb2-17"></span>
<span id="cb2-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># That column ordering is a bit chaotic, so I'll reorder them (for readability).</span></span>
<span id="cb2-19">col_order <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb2-20">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_id"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_date"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dba_name"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"aka_name"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"license_"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"facility_type"</span>,</span>
<span id="cb2-21">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"risk"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_type"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"results"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"address"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"city"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"state"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zip"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"violations"</span>,</span>
<span id="cb2-22">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"longitude"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latitude"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"geometry"</span></span>
<span id="cb2-23">]</span>
<span id="cb2-24">food_inspection_gdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> food_inspection_gdf[col_order].copy()</span>
<span id="cb2-25"></span>
<span id="cb2-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># I also want to break this into batches based on the dates, so I need to cast</span></span>
<span id="cb2-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   the `inspection_date` to a datetime type.</span></span>
<span id="cb2-28">food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_date"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.to_datetime(</span>
<span id="cb2-29">    food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_date"</span>]</span>
<span id="cb2-30">)</span>
<span id="cb2-31"></span>
<span id="cb2-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># I'll also cast string and numeric features to their proper dtypes.</span></span>
<span id="cb2-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># food_inspection_gdf = food_inspection_gdf.convert_dtypes()</span></span>
<span id="cb2-34">food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_id"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_id"</span>].astype(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Int64"</span>)</span>
<span id="cb2-35">food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"longitude"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"longitude"</span>].astype(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>)</span>
<span id="cb2-36">food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latitude"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latitude"</span>].astype(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>)</span>
<span id="cb2-37"></span>
<span id="cb2-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># I'll also just make all string uppercase (to reduce cardinality)</span></span>
<span id="cb2-39">str_cols <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(food_inspection_gdf.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>).select_dtypes(include<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"object"</span>).columns)</span>
<span id="cb2-40">food_inspection_gdf[str_cols] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> food_inspection_gdf[str_cols].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> x: x.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.upper())</span></code></pre></div>
</details>
</div>
<p>In the (folded up) cell below, we split the dataset into batches and write each batch to file in this post’s <code>./data</code> directory.</p>
<div class="cell" data-execution_count="3">
<details>
<summary>And here we split the dataset into batches and write each batch to file in this post’s <code>./data</code> directory.</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># I want to split the data into 1-month batches, so I need to get the first day of the month</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   for every month between the earliest inspection and the month after the latest inspection</span></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   in our food inspection dataset.</span></span>
<span id="cb3-4">month_start_dates <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.date_range(</span>
<span id="cb3-5">    start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_date"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pd.DateOffset(months<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb3-6">    end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_date"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(),</span>
<span id="cb3-7">    freq<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MS"</span>,</span>
<span id="cb3-8">)</span>
<span id="cb3-9"></span>
<span id="cb3-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Here, we'll iterate through each of those month_start_dates, extract the batch of data,</span></span>
<span id="cb3-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   format a filename containing the month_start_date, and write the batch to file.</span></span>
<span id="cb3-12"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> month_start_date <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> month_start_dates:</span>
<span id="cb3-13">    batch_period <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.to_datetime(month_start_date).strftime(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y_%m"</span>)</span>
<span id="cb3-14">    batch_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> food_inspection_gdf.loc[</span>
<span id="cb3-15">        food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_date"</span>].between(</span>
<span id="cb3-16">            left<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>month_start_date,</span>
<span id="cb3-17">            right<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>month_start_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pd.DateOffset(months<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb3-18">            inclusive<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>)</span>
<span id="cb3-19">    ].copy()</span>
<span id="cb3-20">    batch_file_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> PROJECT_DATA_DIR.joinpath(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"food_inspection_batch_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>batch_period<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">.parquet"</span>)</span>
<span id="cb3-21">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> batch_file_path.is_file():</span>
<span id="cb3-22">        batch_data.to_parquet(batch_file_path, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="step-1-create-or-load-great-expectations-datacontext" class="level2">
<h2 class="anchored" data-anchor-id="step-1-create-or-load-great-expectations-datacontext">Step 1: Create or Load Great Expectations <code>DataContext</code></h2>
<p>A <a href="https://docs.greatexpectations.io/docs/terms/data_context/"><code>DataContext</code></a> is your primary tool for configuring your project and accessing project resources or GX methods. When you first create a <code>DataContext</code> for your project, GX will create a directory named <code>/great_expectations</code> in the <code>project_root_dir</code> directory.</p>
<p>The code below will create a new <code>DataContext</code> if one doesn’t already exist in the <code>PROJECT_DIR</code> directory, and then load a <code>DataContext</code> instance from that <code>PROJECT_DIR</code>. Great Expectations defaults to collecting <a href="https://docs.greatexpectations.io/docs/reference/usage_statistics/">anonymized usage statistics</a>, but you can disable that for your context by setting <code>usage_statistics_enabled=False</code>.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> great_expectations <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> gx</span>
<span id="cb4-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> great_expectations.data_context <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> FileDataContext</span>
<span id="cb4-3"></span>
<span id="cb4-4">context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> FileDataContext.create(project_root_dir<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>PROJECT_DIR, usage_statistics_enabled<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span></code></pre></div>
</div>
<p>This tutorial uses a local <code>FileDataContext</code>, but GX also supports <code>CloudDataContext</code>s and <code>EphemeralDataContext</code>s.</p>
<div class="cell" data-execution_count="5">
<details>
<summary>Kinds of <code>DataContext</code>s</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">[el <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> el <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dir</span>(gx.data_context) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> el.endswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Context"</span>)]</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>['AbstractDataContext',
 'BaseDataContext',
 'CloudDataContext',
 'DataContext',
 'EphemeralDataContext',
 'FileDataContext']</code></pre>
</div>
</div>
</section>
<section id="step-2-create-or-load-a-datasource" class="level2">
<h2 class="anchored" data-anchor-id="step-2-create-or-load-a-datasource">Step 2: Create or load a <code>Datasource</code></h2>
<p>A GX <a href="https://docs.greatexpectations.io/docs/terms/datasource/"><code>Datasource</code></a> connects you to a source of data and gives you methods to define and access <code>DataAssets</code>.</p>
<p>The code below will check the <code>DataContext</code> <code>context</code> for a <code>Datasource</code> with the given <code>datasource_name</code>, and either load or create a local filesystem <code>Datasource</code> instance.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1">datasource_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"food_inspection_datasource"</span></span>
<span id="cb7-2"></span>
<span id="cb7-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">any</span>(el[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> datasource_name <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> el <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> context.list_datasources()):</span>
<span id="cb7-4">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Datasource with name '</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>datasource_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">' found; loading now"</span>)</span>
<span id="cb7-5">    datasource <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> context.get_datasource(datasource_name)</span>
<span id="cb7-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb7-7">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"No Datasource with name '</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>datasource_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">' found; creating now"</span>)</span>
<span id="cb7-8">    datasource <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> context.sources.add_pandas_filesystem(</span>
<span id="cb7-9">        name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>datasource_name,</span>
<span id="cb7-10">        base_directory<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>PROJECT_DATA_DIR</span>
<span id="cb7-11">    )</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>No Datasource with name 'food_inspection_datasource' found; creating now</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<details>
<summary>Other kinds of GX <code>Datasource</code>s</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">[el <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> el <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dir</span>(context.sources) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> el.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"add_"</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_update_"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> el]</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>['add_pandas',
 'add_pandas_abs',
 'add_pandas_dbfs',
 'add_pandas_filesystem',
 'add_pandas_gcs',
 'add_pandas_s3',
 'add_postgres',
 'add_spark',
 'add_spark_abs',
 'add_spark_dbfs',
 'add_spark_filesystem',
 'add_spark_gcs',
 'add_spark_s3',
 'add_sql',
 'add_sqlite']</code></pre>
</div>
</div>
</section>
<section id="step-3-define-dataassets-in-that-datasource" class="level2">
<h2 class="anchored" data-anchor-id="step-3-define-dataassets-in-that-datasource">Step 3: Define <code>DataAssets</code> in that <code>Datasource</code></h2>
<p>A GX <a href="https://docs.greatexpectations.io/docs/terms/data_asset/"><code>DataAsset</code></a> specifies a collection of records in a <code>Datasource</code> and the method for accessing those records.</p>
<p>The code below checks if a <code>DataAsset</code> with the given name exists in the <code>datasource</code>, loading it if it exists, or specifying it if not. In the part that specifies the <code>DataAsset</code>, note that we set the name of the asset, specify that the data is in parquet files, and provide a regex pattern for the file_names and also defines variable-names for the <code>year</code> and <code>month</code> parts each file_name. We can use those <code>year</code> and <code>month</code> variables to specify how <code>DataAssets</code> should be split into batches and the order of those batches.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1">data_asset_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"food_inspections_asset"</span></span>
<span id="cb11-2"></span>
<span id="cb11-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> data_asset_name <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> datasource.get_asset_names():</span>
<span id="cb11-4">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Creating data asset </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>data_asset_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb11-5">    data_asset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datasource.add_parquet_asset(</span>
<span id="cb11-6">        name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data_asset_name,</span>
<span id="cb11-7">        batching_regex <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"food_inspection_batch_(?P&lt;year&gt;\d</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{4}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">)_(?P&lt;month&gt;\d</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{2}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">)\.parquet"</span></span>
<span id="cb11-8">    )</span>
<span id="cb11-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb11-10">    data_asset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datasource.get_asset(data_asset_name)</span>
<span id="cb11-11">data_asset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_asset.add_sorters([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+year"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+month"</span>])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Creating data asset food_inspections_asset</code></pre>
</div>
</div>
<div class="cell" data-execution_count="9">
<details>
<summary>Other data file formats GX supports</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">[el <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> el <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dir</span>(datasource) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> el.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"add_"</span>)]</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>['add_csv_asset',
 'add_excel_asset',
 'add_feather_asset',
 'add_fwf_asset',
 'add_hdf_asset',
 'add_html_asset',
 'add_json_asset',
 'add_orc_asset',
 'add_parquet_asset',
 'add_pickle_asset',
 'add_sas_asset',
 'add_spss_asset',
 'add_stata_asset',
 'add_xml_asset']</code></pre>
</div>
</div>
</section>
<section id="step-4-create-expectations-for-a-dataasset" class="level2">
<h2 class="anchored" data-anchor-id="step-4-create-expectations-for-a-dataasset">Step 4: Create <code>Expectation</code>s for a <code>DataAsset</code></h2>
<p>A GX <a href="https://docs.greatexpectations.io/docs/terms/expectation/"><code>Expectation</code></a> is a verifiable assertion about some property of a <code>DataAsset</code>, and defining <code>Expectations</code> both enables GX to check that data meets expectations and enables domain experts to explicitly represent and communicate <code>Expectations</code> for data.</p>
<p>GX supports hundreds of different <code>Expectations</code> and catalogs them in the <a href="https://greatexpectations.io/expectations/">Expectation Gallery</a> (although not all <code>Expectations</code> are implemented for all kinds of <code>Datasources</code>). GX also provides tools to aid in several <a href="https://docs.greatexpectations.io/docs/guides/expectations/create_expectations_overview">workflows</a> for defining suites of <code>Expectations</code>, including the GX <a href="https://docs.greatexpectations.io/docs/terms/data_assistant/"><strong>Data Assistant</strong></a> workflow (used below), which builds a suite of <code>Expectations</code> by profiling batches of data.</p>
<p>In the code below, we create a new <code>Expectation</code> suite (on lines 3-5), organize batches of data (on lines 6-7), and use the data assistant to profile the <code>DataAsset</code> based on our batches of data (on lines 8-11).</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1">expectation_suite_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"food_inspections_suite"</span></span>
<span id="cb15-2"></span>
<span id="cb15-3">expectation_suite <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> context.add_or_update_expectation_suite(</span>
<span id="cb15-4">    expectation_suite_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>expectation_suite_name</span>
<span id="cb15-5">)</span>
<span id="cb15-6">batch_request <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_asset.build_batch_request()</span>
<span id="cb15-7">batches <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_asset.get_batch_list_from_batch_request(batch_request)</span>
<span id="cb15-8">data_assistant_result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> context.assistants.onboarding.run(</span>
<span id="cb15-9">    batch_request<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>batch_request,</span>
<span id="cb15-10">    exclude_column_names<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_date"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"geometry"</span>],</span>
<span id="cb15-11">)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"11db1ea0639d43b2a42eb35da7d97a67","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"31507452bbc347cbb40cb3e251a29dce","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"1623455d058345f1b3c2da849fbbf50e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"295e87146d9248459083698088582933","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d725938cfecf438eab055b655b85f502","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f73d8b6d3978411d92ea7181a21d1d7c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"806294d12a6b4bb9a328fce1b72baa34","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"fc53e71d915440ae97022e2a0f64b7db","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"1fa77d075490414e839ebfa4ab9e1284","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7b86d129222c4822b302970303d5f58f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f8fbc8ead6c3487baa2c088cc6be826b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9f0ffa062420418b92a592c4a327b516","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e8b4db53158d4554ab3997db941a1366","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f3ee87ed95e24cbfbc6be174a0773bf2","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"1a1e69c5d26f4e4f8ff09d43e07ad227","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"05b16b968043402c834b96ade67f9173","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6fa41c8b0d834a37aff4a7c7fd9e4806","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"8087453abe4a489d820043cc30f78cdf","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"5ba48b2419b84027a4e2ad665dcba3fb","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d93d86caad9845359b57516da22e1502","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"053ab09acbc74779a1a6880cf53cf35d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"08e25ae0eca241b4b439c43767ca39a0","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"5b65dc193ab946db94172518eaf11a1e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"fd2e58f0d7b1410ea7960d65c6c90a5d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"3f4194f64b8e4de4a9f8fc46f12c33d2","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e57d2b3d81ac40e5aab3157c18bdf3ae","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b903a3020d7e48caabf7da69ffa4afb0","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"76288fce1fe744e595ba92ecffa5bd4e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"26ff2003db6d4752990aba0b41a34470","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7268da074e47438ca770a7b22f26da3b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4764ad86713042c490b3edf60ac33fb7","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"1aab8423e859457d82df47bf99aa41dc","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b67393cf14174efcabd36d4bf4aa870c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"aa6fcf5077594c4a975c5d5dfc31d6d8","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"30eea499c344484d8f8125fa4f1eeb0a","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f144ccbe88c54079ab0147791877ba76","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d20de5af95b94863851880aba66a904e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2623b1c948c0478a90aa3665c87c5d08","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"3333762ba9de4568a89bffe60fd21390","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"89afd24ea8a0436891ad73b116fdd6fb","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"02f91c3a8ef84cd8a3e065364588162f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"55ffccea131b48d6b442070bce007d89","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"513ba6a1158b4a289b26ec44239cfc1e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b0875f593ca740b5a720eb991a511330","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"06db7af1cd4f4263b59b349fe74f75f7","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0b53c66c7a854c548be6aed7c71997c8","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d155c4434b724a4e99ab91d70615d727","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"61ab18ce765b4504939560360640717e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d87b54fc5a144a42b6ba8e52668a68af","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e9a870970d1f4b06af47bf4b04d03864","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f5f5c47f967447548af3209219f5646d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b751c028817d4268b496d683054b0415","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ef72af3bcba1424ea68b84366c37359d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c2c2bf7b7523487e8e9b5a80ad27ecf9","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a9f6d1a917cd4975afdc1ed1263f1f3d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b0bb51efc72249c9928e8f5fa8c2132f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"28e3b9709f4f42b8b94c40dd2877ab6d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c18d4c82fe2d404d8c86c53e165d2109","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"896348d89b9044cd90b3ae9b6dfeb05c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ac1418d3fcfa491084921304613186a1","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"035a75fe77824715a121164e48614404","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f3c97d49d4c44c2d9efdd480db6a5295","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f601e48243574888b0c60d51f4d5a46f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"fe6f4531c7654b4eb06aee2c3c8da245","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"52893003e5144a93a99cc282ce002e5d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"fa47c251a6644af192d7cc1f4ce1c693","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"623a1284211644d0868c032f90bd1a50","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"99d45ab5e44f4b61b25604d8801b5485","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"095feed8119e40769ac6eda826a7371b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7bd8d8e65f614f8dbac2a4cb7769ec13","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"444e677423d24ba4922247e1776054c5","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f2f59e46d7504aefa4862912fa6da4d5","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"59bc4f16983349baa74c05aa18296c81","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"fe7cd61424b8483993b1a5facb3eb904","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"857194450aab4ae281637fbd6a53dea9","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4fb0ce0191e749bea07198dfae24fd03","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"72fa0c8dccc841a8968aaa655945e01e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b69625d1ecf54b62b7fa9495f1553fe7","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c3abb841471a4a7a8296fb530b1eae8a","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ad5c7b024eeb452faa155b7c3a7e9eeb","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"afca8d3e8b214b9dad7e486fefd71585","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b0e8c5a3194c4ae3b7dd15461717408d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2768d8c7587c440fbb3847a19ab982c5","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e2399b1d0f6546bca86c6b1dd9deb6ca","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4e331b8935ef4ea984a2c83c41c8dd13","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"510b10209e494196968d25f33d9ac586","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4e9562da963e4d78b87f4a492632e568","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"1c322acf2f6d487f9e054810a6577467","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"1b041d86bbfb4de7b202b612cb79ab3f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e0b369ce2ae94772b65c5cf8c239fd29","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"cfc7b730739b48f1b8d7abf52e7a82b6","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"19f3dfaa34754f718451af01979a1e46","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"cc74a81834c7467aa9a69517e278a7cb","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"26a64014bb3a46e0bf644c6f3d607543","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"fe04ee27283a48fe916a973a67cf8118","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"1bdb6742a01143a7be03ed4539810601","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7b4708b103b14219a893bb169d8d1040","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4cbb4865b8994ce9a9eb2e6f496636ac","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"757c05f73d694a82a2d197adccc48950","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"5270702d520f465fa06508e2d6d106be","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"383980d4259e42659e29d03f690d5c8e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c543090a5e624abbaced4a6c8d1d5950","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6057cc61aaed4154a38a0c803283de6a","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"20f69e13108e45d7808d943f59276c97","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b1c46344582045de80093e6c1fc0267e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e468402f04a14ae68ee2f75d5937e372","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"247f5d6755f5419da5fc3fb93b2f4e65","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"98d25feb56484425980905ea57c7b69b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4ed5695c652e4c97bb1cb10dfe2b0526","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a9a3b5375d89422a96fc0d539e8f648b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b4ca1107a0804e8797de14fb38c18e86","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"3f1907a25f944c25bf6ce64499787a36","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f441bd3b55254a8e8aec34df1eebdc7b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"480552198770413098b0c9e018a26b05","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"bb8f45c4c0b4437caeb432212b5677a3","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"df5d75dcb9d64473bc3160920fb76a7e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0f4fd1ee44a34a96877877eeccba85be","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6b8d7f99af8e4af7a9ba21172ad61723","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"40f82676a5354795ace117f885a78998","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0c7250293de4418a908cc1f25477ea21","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9ef51bb2a00d43c99bd69df933a4627b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a55ad83d7fea4774898544ec9be7b4c7","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d84432c8ba9d4d0d883e8b1178fb5a9b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b0f9d5a4828b4d25ab40390411df2eab","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b0c5613924a14ba890f911e95d302955","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a95a102c2bc349bfaf2cdee7268e5261","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e4fe50d428ea4fe7800ff52d87e7fad4","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"48e41675063e4ad6bbe6a591ea864aa5","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c97e42025098406ba41e4cae5bf2a6c9","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"220d4bafd698441ca7a11ba5eb16e2eb","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"91aa8cfa7b1a406a8fabbf54cdb1c89d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"eaf14c015d5e4e259029b36142061f6f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ecda6b74910a47a19d037a62a8472694","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d2d4ad4d50e744b2aec5800756fdfb72","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d543afd6c9904d2bbf5d2e337e46c7ea","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<p>The profiler will sequentially generate a lot of progress bars (like these) as it profiles dataset features.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.matttriano.dev/posts/006_great_expectations_setup/gx_data_assistant_profiler_profiling.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Profiler output</figcaption>
</figure>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">data_assistant_result.plot_expectations_and_metrics()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>64 Expectations produced, 23 Expectation and Metric plots implemented
Use DataAssistantResult.show_expectations_by_domain_type() or
DataAssistantResult.show_expectations_by_expectation_type() to show all produced Expectations</code></pre>
</div>
<div class="cell-output cell-output-display">

                <style>
                @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600&display=swap');
                </style>
                
</div>
<div class="cell-output cell-output-display">

                <style>
                span.vega-bind-name {
                    color: #404041;
                    font-family: Montserrat;
                    font-size: 14px;
                    font-weight: 500;
                }
                form.vega-bindings {
                    color: #404041;
                    font-family: Montserrat;
                    font-size: 14px;
                    font-weight: 500;
                    position: absolute;
                    left: 75px;
                    top: 28px;
                }
                </style>
            
</div>
<div class="cell-output cell-output-display">

                <style>
                .widget-inline-hbox .widget-label {
                    color: #404041;
                    font-family: Montserrat;
                    font-size: 14px;
                    font-weight: 500;
                }
                .widget-dropdown > select {
                    padding-right: 21px;
                    padding-left: 3px;
                    color: #404041;
                    font-family: Montserrat;
                    font-size: 14px;
                    font-weight: 500;
                    height: 20px;
                    line-height: 14px;
                    background-size: 20px;
                    border-radius: 2px;
                }
                </style>
            
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4d088681de56442486962b97209f6168","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code></code></pre>
</div>
</div>
<section id="data-assistant-plot-inspector-plots" class="level3">
<h3 class="anchored" data-anchor-id="data-assistant-plot-inspector-plots">Data Assistant Plot Inspector plots</h3>
<p>After the Data Assistant finishes profiling, it outputs results to a variable we named <code>data_assistant_result</code>, and you can explore the results across batches by calling <code>data_assistant_result.plot_expectations_and_metrics()</code> and selecting the expectation and column you’re interested in.</p>
<p><img src="https://www.matttriano.dev/posts/006_great_expectations_setup/gx_data_assistant_result_row_count_across_batches.png" class="img-fluid" alt="Total row count per batch"> <img src="https://www.matttriano.dev/posts/006_great_expectations_setup/gx_data_assistant_result_unique_facility_type_values.png" class="img-fluid" alt="Unique facility_type values per batch"> <img src="https://www.matttriano.dev/posts/006_great_expectations_setup/gx_data_assistant_result_unique_inspection_type_values.png" class="img-fluid" alt="Unique inspection_type values per batch"> <img src="https://www.matttriano.dev/posts/006_great_expectations_setup/gx_data_assistant_result_unique_results_values.png" class="img-fluid" alt="Unique result values per batch"></p>
</section>
<section id="extracting-optionally-editing-and-committing-our-expectation-suite-to-our-datacontext" class="level3">
<h3 class="anchored" data-anchor-id="extracting-optionally-editing-and-committing-our-expectation-suite-to-our-datacontext">Extracting, [optionally] Editing, and Committing our <code>Expectation Suite</code> to our <code>DataContext</code></h3>
<p>If we’re content with the <code>Expectations</code> generated by the Data Assistant’s profiler, we can simply extract the <code>Expectations</code> and add them to our <code>context</code> via</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1">expectation_suite <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_assistant_result.get_expectation_suite(</span>
<span id="cb20-2">    expectation_suite_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>expectation_suite_name</span>
<span id="cb20-3">)</span>
<span id="cb20-4">saved_suite <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> context.add_or_update_expectation_suite(expectation_suite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>expectation_suite)</span></code></pre></div>
<p>In a future post I’ll go into further depth on methods for editing <code>Expectations</code>, but here I’ll show how to inspect and remove <code>Expectations</code>.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1">expectation_suite <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_assistant_result.get_expectation_suite(</span>
<span id="cb21-2">    expectation_suite_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>expectation_suite_name</span>
<span id="cb21-3">)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="13">
<details>
<summary>Counts of Expectations by Type</summary>
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Counts of Expectations by Expectation-type:"</span>)</span>
<span id="cb22-2">expecs_by_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expectation_suite.get_grouped_and_ordered_expectations_by_expectation_type()</span>
<span id="cb22-3">display(Counter([ex._expectation_type <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> ex <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> expecs_by_type]))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Counts of Expectations by Expectation-type:</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Counter({'expect_column_value_lengths_to_be_between': 12,
         'expect_column_values_to_match_regex': 11,
         'expect_column_proportion_of_unique_values_to_be_between': 7,
         'expect_column_unique_value_count_to_be_between': 7,
         'expect_column_values_to_be_in_set': 7,
         'expect_column_values_to_not_be_null': 4,
         'expect_column_max_to_be_between': 2,
         'expect_column_mean_to_be_between': 2,
         'expect_column_median_to_be_between': 2,
         'expect_column_min_to_be_between': 2,
         'expect_column_quantile_values_to_be_between': 2,
         'expect_column_stdev_to_be_between': 2,
         'expect_column_values_to_be_between': 2,
         'expect_table_columns_to_match_set': 1,
         'expect_table_row_count_to_be_between': 1})</code></pre>
</div>
</div>
<div class="cell" data-execution_count="14">
<details>
<summary>Counts of Expectations by Column</summary>
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Counts of Expectations by Column-name:"</span>)</span>
<span id="cb25-2">expecs_by_col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expectation_suite.get_grouped_and_ordered_expectations_by_column()</span>
<span id="cb25-3">expec_count_by_col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {col: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(col_expecs) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> col, col_expecs <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> expecs_by_col[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].items()}</span>
<span id="cb25-4">display(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sorted</span>(expec_count_by_col.items(), key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> x: x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], reverse<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Counts of Expectations by Column-name:</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>[('longitude', 7),
 ('latitude', 7),
 ('inspection_type', 6),
 ('results', 6),
 ('facility_type', 5),
 ('risk', 5),
 ('city', 5),
 ('state', 5),
 ('zip', 5),
 ('dba_name', 3),
 ('_nocolumn', 2),
 ('address', 2),
 ('aka_name', 2),
 ('license_', 2),
 ('violations', 2)]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<details>
<summary>Expectation-related methods on our expectation_suite</summary>
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1">[el <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> el <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dir</span>(expectation_suite) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_expectation"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> el]</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>['_add_expectation',
 '_get_expectations_by_domain_using_accessor_method',
 '_validate_expectation_configuration_before_adding',
 'add_expectation',
 'add_expectation_configurations',
 'append_expectation',
 'find_expectation_indexes',
 'find_expectations',
 'get_column_expectations',
 'get_column_pair_expectations',
 'get_grouped_and_ordered_expectations_by_column',
 'get_grouped_and_ordered_expectations_by_domain_type',
 'get_grouped_and_ordered_expectations_by_expectation_type',
 'get_multicolumn_expectations',
 'get_table_expectations',
 'patch_expectation',
 'remove_all_expectations_of_type',
 'remove_expectation',
 'replace_expectation',
 'show_expectations_by_domain_type',
 'show_expectations_by_expectation_type']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="16">
<details>
<summary>Inspecting Expectation types for a given column</summary>
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1">col_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"longitude"</span></span>
<span id="cb30-2">[ex[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"expectation_type"</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> ex <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> expectation_suite.get_column_expectations() <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> ex[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kwargs"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"column"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> col_name]</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>['expect_column_min_to_be_between',
 'expect_column_max_to_be_between',
 'expect_column_values_to_be_between',
 'expect_column_quantile_values_to_be_between',
 'expect_column_median_to_be_between',
 'expect_column_mean_to_be_between',
 'expect_column_stdev_to_be_between']</code></pre>
</div>
</div>
<p>Some <code>Expectations</code> are redundant, such as <code>expect_column_min_to_be_between</code> and <code>expect_column_max_to_be_between</code>. I’ll remove them.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1">col_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"longitude"</span></span>
<span id="cb32-2">expectation_types_to_remove <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb32-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"expect_column_min_to_be_between"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"expect_column_max_to_be_between"</span></span>
<span id="cb32-4">]</span>
<span id="cb32-5">col_expectations_w_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb32-6">    ex <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> ex <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> expectation_suite.get_column_expectations()</span>
<span id="cb32-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (ex[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kwargs"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"column"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> col_name) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (ex[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"expectation_type"</span>] <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> expectation_types_to_remove)</span>
<span id="cb32-8">]</span>
<span id="cb32-9">col_expectations_w_type</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>[{"kwargs": {"column": "longitude", "strict_min": false, "min_value": -87.91442843927047, "strict_max": false, "max_value": -87.81649552747085}, "meta": {"profiler_details": {"metric_configuration": {"metric_name": "column.min", "domain_kwargs": {"column": "longitude"}, "metric_value_kwargs": null}, "num_batches": 162}}, "expectation_type": "expect_column_min_to_be_between"},
 {"kwargs": {"column": "longitude", "strict_min": false, "min_value": -87.5510612280602, "strict_max": false, "max_value": -87.5250941359867}, "meta": {"profiler_details": {"metric_configuration": {"metric_name": "column.max", "domain_kwargs": {"column": "longitude"}, "metric_value_kwargs": null}, "num_batches": 162}}, "expectation_type": "expect_column_max_to_be_between"}]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Expectations prior to removal: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(expectation_suite.expectations)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb34-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> expectation_to_remove <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> col_expectations_w_type:</span>
<span id="cb34-3">    removed_expec <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expectation_suite.remove_expectation(expectation_to_remove)</span>
<span id="cb34-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Expectations after removal:    </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(expectation_suite.expectations)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Expectations prior to removal: 64
Expectations after removal:    62</code></pre>
</div>
</div>
<p>We can also get rid of every instance of an <code>Expectation</code> type.</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Removing Expectation types:"</span>)</span>
<span id="cb36-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> expec_type <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> expectation_types_to_remove:</span>
<span id="cb36-3">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  - </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>expec_type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb36-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Expectations prior to removal: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(expectation_suite.expectations)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb36-5">removed_expecs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expectation_suite.remove_all_expectations_of_type(expectation_types<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>expectation_types_to_remove)</span>
<span id="cb36-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Expectations after removal:    </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(expectation_suite.expectations)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Removing Expectation types:
  - expect_column_min_to_be_between
  - expect_column_max_to_be_between
Expectations prior to removal: 62
Expectations after removal:    60</code></pre>
</div>
</div>
<p>After reviewing and editing <code>Expectations</code>, the <code>Expectation Suite</code> must be committed to the <code>DataContext</code>.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1">saved_suite <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> context.add_or_update_expectation_suite(expectation_suite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>expectation_suite)</span></code></pre></div>
</div>
</section>
</section>
<section id="step-5-setup-a-checkpoint-to-check-expectations" class="level2">
<h2 class="anchored" data-anchor-id="step-5-setup-a-checkpoint-to-check-expectations">Step 5: Setup a Checkpoint to check Expectations</h2>
<p>A GX <a href="https://docs.greatexpectations.io/docs/terms/checkpoint"><code>Checkpoint</code></a> configures the validation process for an <code>Expectation Suite</code>.</p>
<p>Specifically, a <code>Checkpoint</code> defines: * the <code>Expectation Suite</code> to evaluate, * the data Batches to evaluate against, and * the actions to take after evaluation.</p>
<p>We’ll take the actions of compiling a report of results and committing our <code>Checkpoint</code> to our <code>DataContext</code>, but you can also configure a <code>Checkpoint</code> to send results via a <a href="https://docs.greatexpectations.io/docs/guides/validation/validation_actions/actions_lp">email or Slack notification</a>.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1">checkpoint_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"food_inspections_checkpoint"</span></span>
<span id="cb39-2"></span>
<span id="cb39-3">checkpoint <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gx.checkpoint.SimpleCheckpoint(</span>
<span id="cb39-4">    name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>checkpoint_name,</span>
<span id="cb39-5">    data_context<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>context,</span>
<span id="cb39-6">    validations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb39-7">        {</span>
<span id="cb39-8">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"batch_request"</span>: batch_request,</span>
<span id="cb39-9">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"expectation_suite_name"</span>: expectation_suite_name,</span>
<span id="cb39-10">        },</span>
<span id="cb39-11">    ],</span>
<span id="cb39-12">)</span>
<span id="cb39-13">checkpoint_result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> checkpoint.run()</span></code></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0a22e12b43ef4f55845a492d39b17cd5","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1">context.build_data_docs()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>{'local_site': 'file:///home/matt/projects/blogs/quarto_blog/posts/006_great_expectations_setup/great_expectations/uncommitted/data_docs/local_site/index.html'}</code></pre>
</div>
</div>
<p>To view the generated validation report (or <strong>Data Docs</strong>), open the file <code>.../great_expectations/uncommitted/data_docs/local_site/index.html</code> and select the validation run you want to review. You may have to click <code>Trust HTML</code> (upper left corner in Jupyterlab) to navigate the document.</p>
<p><img src="https://www.matttriano.dev/posts/006_great_expectations_setup/data_docs_index.png" class="img-fluid" alt="Data docs index"> <img src="https://www.matttriano.dev/posts/006_great_expectations_setup/validation_run_data_docs_sample.png" class="img-fluid" alt="Sample view of a validation report"></p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1">context.add_checkpoint(checkpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>checkpoint)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>{
  "action_list": [
    {
      "name": "store_validation_result",
      "action": {
        "class_name": "StoreValidationResultAction"
      }
    },
    {
      "name": "store_evaluation_params",
      "action": {
        "class_name": "StoreEvaluationParametersAction"
      }
    },
    {
      "name": "update_data_docs",
      "action": {
        "class_name": "UpdateDataDocsAction"
      }
    }
  ],
  "batch_request": {},
  "class_name": "SimpleCheckpoint",
  "config_version": 1.0,
  "evaluation_parameters": {},
  "module_name": "great_expectations.checkpoint",
  "name": "food_inspections_checkpoint",
  "profilers": [],
  "runtime_configuration": {},
  "validations": [
    {
      "batch_request": {
        "datasource_name": "food_inspection_datasource",
        "data_asset_name": "food_inspections_asset",
        "options": {}
      },
      "expectation_suite_name": "food_inspections_suite"
    }
  ]
}</code></pre>
</div>
</div>
<p>You can easily integrate a defined <code>Checkpoint</code> into a pipeline with just a few lines of code (and another dependency).</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> great_expectations <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> gx</span>
<span id="cb44-2"></span>
<span id="cb44-3">context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gx.get_context(context_root_dir<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>PROJECT_DIR.joinpath(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"great_expectations"</span>))</span>
<span id="cb44-4">retrieved_checkpoint <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> context.get_checkpoint(name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"food_inspections_checkpoint"</span>)</span>
<span id="cb44-5">retrieved_checkpoint_result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> retrieved_checkpoint.run()</span>
<span id="cb44-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> retrieved_checkpoint_result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"success"</span>]:</span>
<span id="cb44-7">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Failed Validation Checkpoint!"</span>)</span>
<span id="cb44-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># or raise Exception("if you'd rather handle validation failures that way")</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"5893b105cdc145c5999fd752d2bfa2d7","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
</section>
</section>
<section id="summary" class="level1">
<h1>Summary</h1>
<p>In this notebook, we’ve built some data infrastructure that helps communicate some expectations for our data to data users and enables us to check that those expectations are still being met after every update.</p>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next Steps</h2>
<p>In future posts, I’ll dive deeper into the <code>Expectation</code>-setting process, demonstrate a workflow with a PostgreSQL <code>Datasource</code> and <code>DataAssets</code> (where GX really shines), and explore strategies for integrating data monitoring into production ETL/ELT pipelines (like those in my <a href="https://github.com/MattTriano/analytics_data_where_house">personal data warehousing platform</a>).</p>



</section>
</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div> ]]></description>
  <category>great_expectations</category>
  <category>tutorial</category>
  <category>long</category>
  <guid>https://www.matttriano.dev/posts/006_great_expectations_setup/data_monitoring_w_gx_1_setup.html</guid>
  <pubDate>Fri, 23 Jun 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.matttriano.dev/posts/006_great_expectations_setup/pip_setting_(up)_Great_Expectations.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Census TIGER Dataset Collector Dev</title>
  <dc:creator>Matt Triano</dc:creator>
  <link>https://www.matttriano.dev/posts/004_census_tiger_dev/TIGER_data_collector_dev.html</link>
  <description><![CDATA[ 




<div class="cell" data-execution_count="41">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> textwrap</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Dict, List, Union, Optional</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> urllib.request <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> urlretrieve</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> bs4 <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BeautifulSoup</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> geopandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> gpd</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> requests</span></code></pre></div>
</details>
</div>
<p>The US Census Bureau (USCB) runs a massive array of surveys of residents of the United States. After aggregating responses into demographic and/or geographic groups, the USCB publishes those aggregated datasets to its massive public data catalog. I’ve already developed some tooling to collect and ingest Census datasets into my personal data warehouse and analytics environment, but to map out geographic Census data or join in other geospatial datasets, I also need to collect and ingest spatial files describing the geographic boundaries of Census groupings. Fortunately, the USCB provides shapefiles with these geometries in their TIGER (Topologically Integrated Geographic Encoding and Referencing) data offerings, and in this notebook, I’ll synthesize the findings the experiments and research in my last notebook into a data model and data collection tools.</p>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References:</h3>
<ul>
<li><a href="https://www.census.gov/programs-surveys/geography/technical-documentation/complete-technical-documentation/tiger-geo-line.2022.html">TIGER Technical Docs</a></li>
<li><a href="https://www.census.gov/programs-surveys/geography/technical-documentation/code-lists.html">TIGER Geographic Codes</a></li>
</ul>
<p>Each year, the USCB can add or alter geographic boundaries or connected data features, so they organize TIGER data offering into annual vintages, which can be downloaded either through the USCB web interface or from their <a href="https://www2.census.gov/geo/tiger/">file server interface</a> (https://www2.census.gov/geo/tiger/).</p>
<p>The functions in the cell below aid in scraping the table off of any of pages linked in that file-tree interface.</p>
<div class="cell" data-execution_count="4">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> request_page(metadata_url: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> requests.models.Response:</span>
<span id="cb2-2">    resp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> requests.get(metadata_url)</span>
<span id="cb2-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> resp.status_code <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>:</span>
<span id="cb2-4">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> resp</span>
<span id="cb2-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb2-6">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Couldn't get page metadata for url </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>metadata_url<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb2-7"></span>
<span id="cb2-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> scrape_census_ftp_metadata_page(metadata_url: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb2-9">    resp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> request_page(metadata_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>metadata_url)</span>
<span id="cb2-10">    soup <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BeautifulSoup(resp.content, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"html.parser"</span>)</span>
<span id="cb2-11">    table <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.find(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"table"</span>)</span>
<span id="cb2-12">    rows <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> table.find_all(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tr"</span>)</span>
<span id="cb2-13">    table_contents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb2-14">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> row <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> rows:</span>
<span id="cb2-15">        cols <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> row.find_all(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"td"</span>)</span>
<span id="cb2-16">        cols <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [col.text.strip() <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> col <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> cols]</span>
<span id="cb2-17">        table_contents.append(cols)</span>
<span id="cb2-18">    table_rows <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [el <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> el <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> table_contents <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(el) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb2-19"></span>
<span id="cb2-20">    metadata_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(</span>
<span id="cb2-21">        [row[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> row <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> table_rows],</span>
<span id="cb2-22">        columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"last_modified"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"size"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"description"</span>],</span>
<span id="cb2-23">    )</span>
<span id="cb2-24">    metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"last_modified"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.to_datetime(metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"last_modified"</span>])</span>
<span id="cb2-25">    metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_dir"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.endswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/"</span>)</span>
<span id="cb2-26">    metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clean_name"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, regex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb2-27">    metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_file"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_dir"</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> (</span>
<span id="cb2-28">        metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clean_name"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Parent Directory"</span></span>
<span id="cb2-29">    )</span>
<span id="cb2-30">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">while</span> metadata_url.strip().endswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/"</span>):</span>
<span id="cb2-31">        metadata_url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> metadata_url[:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb2-32">    mask <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_file"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_dir"</span>]</span>
<span id="cb2-33">    metadata_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> metadata_df.loc[mask].copy()</span>
<span id="cb2-34">    metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata_url"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (metadata_url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clean_name"</span>])</span>
<span id="cb2-35">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> metadata_df</span></code></pre></div>
</details>
</div>
<p><code>request_page()</code> makes a GET request for the content at the URL <code>metadata_url</code> and returns the response (if successful, i.e.&nbsp;if the response has the “success” HTTP response status code). This function is only called by <code>scrape_census_ftp_metadata_page()</code>, but it’s separated out to make it easier to test <code>scrape_census_ftp_metadata_page()</code>.</p>
<div class="cell" data-execution_count="5">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> request_page(metadata_url: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> requests.models.Response:</span>
<span id="cb3-2">    resp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> requests.get(metadata_url)</span>
<span id="cb3-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> resp.status_code <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>:</span>
<span id="cb3-4">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> resp</span>
<span id="cb3-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb3-6">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Couldn't get page metadata for url </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>metadata_url<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
<p><code>scrape_census_ftp_metadata_page()</code> gets the content from a given Census file-tree page (at URL <code>metadata_url</code>), parses it into a convenient and well structured format (a <code>pandas DataFrame</code>) with features that aid in filtering to desired rows.</p>
<div class="cell" data-execution_count="10">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">resp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> request_page(metadata_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://www2.census.gov/geo/tiger/"</span>)</span>
<span id="cb4-2">soup <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BeautifulSoup(resp.content, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"html.parser"</span>)</span>
<span id="cb4-3">table <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.find(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"table"</span>)</span>
<span id="cb4-4">rows <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> table.find_all(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tr"</span>)</span>
<span id="cb4-5">rows[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>]</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>[&lt;tr&gt;&lt;th valign="top"&gt;&lt;img alt="[ICO]" src="/icons/blank.gif"/&gt;&lt;/th&gt;&lt;th&gt;&lt;a href="?C=N;O=D"&gt;Name&lt;/a&gt;&lt;/th&gt;&lt;th&gt;&lt;a href="?C=M;O=A"&gt;Last modified&lt;/a&gt;&lt;/th&gt;&lt;th&gt;&lt;a href="?C=S;O=A"&gt;Size&lt;/a&gt;&lt;/th&gt;&lt;th&gt;&lt;a href="?C=D;O=A"&gt;Description&lt;/a&gt;&lt;/th&gt;&lt;/tr&gt;,
 &lt;tr&gt;&lt;th colspan="5"&gt;&lt;hr/&gt;&lt;/th&gt;&lt;/tr&gt;,
 &lt;tr&gt;&lt;td valign="top"&gt;&lt;img alt="[PARENTDIR]" src="/icons/back.gif"/&gt;&lt;/td&gt;&lt;td&gt;&lt;a href="/geo/"&gt;Parent Directory&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&nbsp;&lt;/td&gt;&lt;td align="right"&gt;  - &lt;/td&gt;&lt;td&gt;&nbsp;&lt;/td&gt;&lt;/tr&gt;,
 &lt;tr&gt;&lt;td valign="top"&gt;&lt;img alt="[   ]" src="/icons/layout.gif"/&gt;&lt;/td&gt;&lt;td&gt;&lt;a href="Directory_Contents_ReadMe.pdf"&gt;Directory_Contents_ReadMe.pdf&lt;/a&gt;&lt;/td&gt;&lt;td align="right"&gt;2019-06-25 09:13  &lt;/td&gt;&lt;td align="right"&gt;439K&lt;/td&gt;&lt;td&gt;&nbsp;&lt;/td&gt;&lt;/tr&gt;,
 &lt;tr&gt;&lt;td valign="top"&gt;&lt;img alt="[DIR]" src="/icons/folder.gif"/&gt;&lt;/td&gt;&lt;td&gt;&lt;a href="GENZ2010/"&gt;GENZ2010/&lt;/a&gt;&lt;/td&gt;&lt;td align="right"&gt;2013-07-24 12:46  &lt;/td&gt;&lt;td align="right"&gt;  - &lt;/td&gt;&lt;td&gt;&nbsp;&lt;/td&gt;&lt;/tr&gt;,
 &lt;tr&gt;&lt;td valign="top"&gt;&lt;img alt="[DIR]" src="/icons/folder.gif"/&gt;&lt;/td&gt;&lt;td&gt;&lt;a href="GENZ2012/"&gt;GENZ2012/&lt;/a&gt;&lt;/td&gt;&lt;td align="right"&gt;2013-07-24 12:47  &lt;/td&gt;&lt;td align="right"&gt;  - &lt;/td&gt;&lt;td&gt;&nbsp;&lt;/td&gt;&lt;/tr&gt;,
 &lt;tr&gt;&lt;td valign="top"&gt;&lt;img alt="[DIR]" src="/icons/folder.gif"/&gt;&lt;/td&gt;&lt;td&gt;&lt;a href="GENZ2013/"&gt;GENZ2013/&lt;/a&gt;&lt;/td&gt;&lt;td align="right"&gt;2014-07-02 08:28  &lt;/td&gt;&lt;td align="right"&gt;  - &lt;/td&gt;&lt;td&gt;&nbsp;&lt;/td&gt;&lt;/tr&gt;]</code></pre>
</div>
</div>
<p>The cell above shows code that extracts HTML <code>tr</code> (table-row) elements extracted from the page (sorry for showing something so ugly!), and the cell below shows the (beautiful) end product of <code>scrape_census_ftp_metadata_page()</code>.</p>
<div class="cell" data-execution_count="11">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">all_tiger_vintages_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scrape_census_ftp_metadata_page(</span>
<span id="cb6-2">    metadata_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://www2.census.gov/geo/tiger/"</span></span>
<span id="cb6-3">)</span>
<span id="cb6-4">display(all_tiger_vintages_df.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">last_modified</th>
<th data-quarto-table-cell-role="th">size</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">is_dir</th>
<th data-quarto-table-cell-role="th">clean_name</th>
<th data-quarto-table-cell-role="th">is_file</th>
<th data-quarto-table-cell-role="th">metadata_url</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>Directory_Contents_ReadMe.pdf</td>
<td>2019-06-25 09:13:00</td>
<td>439K</td>
<td></td>
<td>False</td>
<td>Directory_Contents_ReadMe.pdf</td>
<td>True</td>
<td>https://www2.census.gov/geo/tiger/Directory_Co...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>GENZ2010/</td>
<td>2013-07-24 12:46:00</td>
<td>-</td>
<td></td>
<td>True</td>
<td>GENZ2010</td>
<td>False</td>
<td>https://www2.census.gov/geo/tiger/GENZ2010</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>GENZ2012/</td>
<td>2013-07-24 12:47:00</td>
<td>-</td>
<td></td>
<td>True</td>
<td>GENZ2012</td>
<td>False</td>
<td>https://www2.census.gov/geo/tiger/GENZ2012</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>GENZ2013/</td>
<td>2014-07-02 08:28:00</td>
<td>-</td>
<td></td>
<td>True</td>
<td>GENZ2013</td>
<td>False</td>
<td>https://www2.census.gov/geo/tiger/GENZ2013</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="26">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Files on the top-level TIGER dataset page:                </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>all_tiger_vintages_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'is_file'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:&gt;3}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb7-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"TIGER data offerings on the top-level TIGER dataset page: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>all_tiger_vintages_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'is_dir'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:&gt;3}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Files on the top-level TIGER dataset page:                  1
TIGER data offerings on the top-level TIGER dataset page:  59</code></pre>
</div>
</div>
<p>The <code>GENZyyyy</code> TIGER data offerings are interesting, but the real wealth of geospatial files can be found in the TIGER offerings with names matching the <code>TIGERyyyy</code> pattern, and I implemented the <code>get_tiger_vintages_metadata()</code> function to get the metadata for these offerings, or <strong>vintages</strong>.</p>
<div class="cell" data-execution_count="25">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_tiger_vintages_metadata() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb9-2">    all_tiger_vintages_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scrape_census_ftp_metadata_page(</span>
<span id="cb9-3">        metadata_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://www2.census.gov/geo/tiger/"</span></span>
<span id="cb9-4">    )</span>
<span id="cb9-5">    tiger_vintages_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> all_tiger_vintages_df.loc[</span>
<span id="cb9-6">        all_tiger_vintages_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^TIGER\d</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{4}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">/"</span>, regex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb9-7">    ].copy()</span>
<span id="cb9-8">    tiger_vintages_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tiger_vintages_df.sort_values(by<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>, ignore_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb9-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> tiger_vintages_df</span>
<span id="cb9-10"></span>
<span id="cb9-11">tiger_vintages_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_tiger_vintages_metadata()</span>
<span id="cb9-12"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Available TIGER vintages:"</span>)</span>
<span id="cb9-13">names <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> textwrap.wrap(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">", "</span>.join(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(tiger_vintages_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clean_name"</span>].values)), width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">95</span>)</span>
<span id="cb9-14"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> line <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> names:</span>
<span id="cb9-15">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"    </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>line<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb9-16">display(tiger_vintages_df.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Available TIGER vintages:
    TIGER1992, TIGER1999, TIGER2002, TIGER2003, TIGER2008, TIGER2009, TIGER2010, TIGER2011,
    TIGER2012, TIGER2013, TIGER2014, TIGER2015, TIGER2016, TIGER2017, TIGER2018, TIGER2019,
    TIGER2020, TIGER2021, TIGER2022</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">last_modified</th>
<th data-quarto-table-cell-role="th">size</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">is_dir</th>
<th data-quarto-table-cell-role="th">clean_name</th>
<th data-quarto-table-cell-role="th">is_file</th>
<th data-quarto-table-cell-role="th">metadata_url</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>TIGER1992/</td>
<td>2011-12-19 07:56:00</td>
<td>-</td>
<td></td>
<td>True</td>
<td>TIGER1992</td>
<td>False</td>
<td>https://www2.census.gov/geo/tiger/TIGER1992</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>TIGER1999/</td>
<td>2012-02-13 11:19:00</td>
<td>-</td>
<td></td>
<td>True</td>
<td>TIGER1999</td>
<td>False</td>
<td>https://www2.census.gov/geo/tiger/TIGER1999</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>TIGER2002/</td>
<td>2015-05-05 18:37:00</td>
<td>-</td>
<td></td>
<td>True</td>
<td>TIGER2002</td>
<td>False</td>
<td>https://www2.census.gov/geo/tiger/TIGER2002</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now that we have tools for scraping the any page in the Census’s file server, we can use those tools to retrieve data on the geographic entities in a given TIGER vintage.</p>
<div class="cell" data-execution_count="35">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> TIGERCatalog:</span>
<span id="cb11-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb11-3">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.dataset_vintages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_tiger_vintages_metadata()</span>
<span id="cb11-4"></span>
<span id="cb11-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_vintage_metadata(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, year: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb11-6">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.dataset_vintages.loc[<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.dataset_vintages[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"TIGER</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>year<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/"</span>].copy()</span>
<span id="cb11-7"></span>
<span id="cb11-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> TIGERVintageCatalog:</span>
<span id="cb11-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, year: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, catalog: Optional[TIGERCatalog] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>):</span>
<span id="cb11-10">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.year <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(year)</span>
<span id="cb11-11">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.set_catalog(catalog<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>catalog)</span>
<span id="cb11-12"></span>
<span id="cb11-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> set_catalog(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, catalog: Optional[TIGERCatalog]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb11-14">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> catalog <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">is</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb11-15">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.catalog <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TIGERCatalog()</span>
<span id="cb11-16">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb11-17">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.catalog <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> catalog</span>
<span id="cb11-18"></span>
<span id="cb11-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@property</span></span>
<span id="cb11-20">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> vintage_metadata(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb11-21">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.catalog.get_vintage_metadata(year<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.year)</span>
<span id="cb11-22"></span>
<span id="cb11-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@property</span></span>
<span id="cb11-24">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> vintage_entities(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb11-25">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vintage_metadata) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb11-26">            tiger_vintage_url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vintage_metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata_url"</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb11-27">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> scrape_census_ftp_metadata_page(metadata_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tiger_vintage_url)</span>
<span id="cb11-28">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb11-29">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span>(</span>
<span id="cb11-30">                <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Failed to get unambiguous metadata (got </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>vintage_metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)"</span></span>
<span id="cb11-31">            )</span>
<span id="cb11-32"></span>
<span id="cb11-33">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_entity_metadata(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, entity_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb11-34">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vintage_entities.loc[<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vintage_entities[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clean_name"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> entity_name].copy()</span>
<span id="cb11-35"></span>
<span id="cb11-36">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> print_entity_names(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb11-37">        entity_names <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vintage_entities.loc[</span>
<span id="cb11-38">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vintage_entities[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_dir"</span>], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clean_name"</span></span>
<span id="cb11-39">        ].values</span>
<span id="cb11-40">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"TIGER Entity options for the </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>year<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> TIGER vintage:"</span>)</span>
<span id="cb11-41">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> entity_name <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> entity_names:</span>
<span id="cb11-42">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  - </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>entity_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb11-43">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Entity count: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(entity_names)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
<div class="cell" data-execution_count="34">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">tiger_catalog <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TIGERCatalog()</span>
<span id="cb12-2">vintage_entity_catalog <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TIGERVintageCatalog(year<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022"</span>, catalog<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tiger_catalog)</span>
<span id="cb12-3">vintage_entity_catalog.print_entity_names()</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>TIGER Entity options for the 2022 TIGER vintage:
  - ADDR
  - ADDRFEAT
  - ADDRFN
  - AIANNH
  - AITSN
  - ANRC
  - AREALM
  - AREAWATER
  - BG
  - CD
  - COASTLINE
  - CONCITY
  - COUNTY
  - COUSUB
  - EDGES
  - ELSD
  - ESTATE
  - FACES
  - FACESAH
  - FACESAL
  - FACESMIL
  - FEATNAMES
  - LINEARWATER
  - MIL
  - PLACE
  - POINTLM
  - PRIMARYROADS
  - PRISECROADS
  - PUMA
  - RAILS
  - ROADS
  - SCSD
  - SDADM
  - SLDL
  - SLDU
  - STATE
  - SUBBARRIO
  - TABBLOCK20
  - TBG
  - TRACT
  - TTRACT
  - UAC
  - UNSD
  - ZCTA520
Entity count: 44</code></pre>
</div>
</div>
<p>Let’s examine Census Tracts.</p>
<p>I’ll need some tooling to collect information on a given entity in a given TIGER vintage. I know this object will need data that’s in the relevant <code>TIGERVintageCatalog</code> instance, so I’ll make that an attribute of the entity vintage class. I could require that the use passes in a <code>TIGERVintageCatalog</code> instance (which would reduce the number of calls to the same Census resource in the usecase where a user is interactively working using these classes), but ultimately I’m going to build out pipelines that only collect one TIGER entity at a from a given vintage (as I don’t need most of the available entities listed above).</p>
<div class="cell" data-execution_count="36">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> TIGERGeographicEntityVintage:</span>
<span id="cb14-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, entity_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, year: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, catalog: Optional[TIGERCatalog] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>):</span>
<span id="cb14-3">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> entity_name</span>
<span id="cb14-4">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.year <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(year)</span>
<span id="cb14-5">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vintage_catalog <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TIGERVintageCatalog(year<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>year, catalog<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>catalog)</span>
<span id="cb14-6">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_metadata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vintage_catalog.get_entity_metadata(entity_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_name)</span>
<span id="cb14-7"></span>
<span id="cb14-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@property</span></span>
<span id="cb14-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> entity_url(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb14-10">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata_url"</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb14-11"></span>
<span id="cb14-12">tiger_tract22_obj <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TIGERGeographicEntityVintage(entity_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRACT"</span>, year<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022"</span>, catalog<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tiger_catalog)</span>
<span id="cb14-13">display(tiger_tract22_obj.entity_metadata)</span>
<span id="cb14-14">entity_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scrape_census_ftp_metadata_page(metadata_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tiger_tract22_obj.entity_url)</span>
<span id="cb14-15"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(entity_df.shape)</span>
<span id="cb14-16">display(entity_df.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">last_modified</th>
<th data-quarto-table-cell-role="th">size</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">is_dir</th>
<th data-quarto-table-cell-role="th">clean_name</th>
<th data-quarto-table-cell-role="th">is_file</th>
<th data-quarto-table-cell-role="th">metadata_url</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">41</td>
<td>TRACT/</td>
<td>2022-09-30 22:39:00</td>
<td>-</td>
<td></td>
<td>True</td>
<td>TRACT</td>
<td>False</td>
<td>https://www2.census.gov/geo/tiger/TIGER2022/TRACT</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>(56, 8)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">last_modified</th>
<th data-quarto-table-cell-role="th">size</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">is_dir</th>
<th data-quarto-table-cell-role="th">clean_name</th>
<th data-quarto-table-cell-role="th">is_file</th>
<th data-quarto-table-cell-role="th">metadata_url</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>tl_2022_01_tract.zip</td>
<td>2022-10-31 19:42:00</td>
<td>11M</td>
<td></td>
<td>False</td>
<td>tl_2022_01_tract.zip</td>
<td>True</td>
<td>https://www2.census.gov/geo/tiger/TIGER2022/TR...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>tl_2022_02_tract.zip</td>
<td>2022-10-31 19:42:00</td>
<td>3.0M</td>
<td></td>
<td>False</td>
<td>tl_2022_02_tract.zip</td>
<td>True</td>
<td>https://www2.census.gov/geo/tiger/TIGER2022/TR...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Looking at the names, I see that the Census groups tracts by state <strong>FIPS</strong> code (Federal Information Processing Series code). I know the FIPS code for Illinois is “17” (you can review the FIPS codes for other geographic entities <a href="https://www.census.gov/library/reference/code-lists/ansi.html">here</a>). I also know I don’t always want to pull data for all states, so I need to add a method that allows the user to filter the entity files. Also, I should build in the step of getting the entity files metadata.</p>
<div class="cell" data-execution_count="47">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> TIGERGeographicEntityVintage:</span>
<span id="cb16-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, entity_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, year: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, catalog: Optional[TIGERCatalog] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>):</span>
<span id="cb16-3">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> entity_name</span>
<span id="cb16-4">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.year <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(year)</span>
<span id="cb16-5">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vintage_catalog <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TIGERVintageCatalog(year<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>year, catalog<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>catalog)</span>
<span id="cb16-6">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_metadata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vintage_catalog.get_entity_metadata(entity_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_name)</span>
<span id="cb16-7"></span>
<span id="cb16-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@property</span></span>
<span id="cb16-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> entity_url(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb16-10">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata_url"</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb16-11"></span>
<span id="cb16-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@property</span></span>
<span id="cb16-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> entity_files_metadata(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb16-14">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> scrape_census_ftp_metadata_page(metadata_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_url)</span>
<span id="cb16-15"></span>
<span id="cb16-16">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_entity_file_metadata(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, filter_str: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb16-17">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_files_metadata.loc[<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_files_metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(filter_str)].copy()</span>
<span id="cb16-18"></span>
<span id="cb16-19">tiger_tract22_obj <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TIGERGeographicEntityVintage(entity_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRACT"</span>, year<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022"</span>, catalog<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tiger_catalog)</span>
<span id="cb16-20">il_tracts22_metadata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tiger_tract22_obj.get_entity_file_metadata(filter_str<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_17_"</span>)</span>
<span id="cb16-21">display(il_tracts22_metadata)</span>
<span id="cb16-22"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"IL Tracts archive download Url: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>il_tracts22_metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata_url'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">last_modified</th>
<th data-quarto-table-cell-role="th">size</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">is_dir</th>
<th data-quarto-table-cell-role="th">clean_name</th>
<th data-quarto-table-cell-role="th">is_file</th>
<th data-quarto-table-cell-role="th">metadata_url</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>tl_2022_17_tract.zip</td>
<td>2022-10-31 19:43:00</td>
<td>9.5M</td>
<td></td>
<td>False</td>
<td>tl_2022_17_tract.zip</td>
<td>True</td>
<td>https://www2.census.gov/geo/tiger/TIGER2022/TR...</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>IL Tracts archive download Url: https://www2.census.gov/geo/tiger/TIGER2022/TRACT/tl_2022_17_tract.zip</code></pre>
</div>
</div>
<p>Geopandas provides some extremely convenient functionality for loading data. I can provide the URL to a zipped archive (of geospatial files) to <code>geopandas</code>’ <code>read_file()</code> function and it handles the network request and unzipping for me.</p>
<div class="cell" data-execution_count="48">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1">il_tracts_gdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gpd.read_file(il_tracts22_metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata_url"</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span></code></pre></div>
</details>
</div>
<div class="cell" data-execution_count="49">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(il_tracts_gdf.shape)</span>
<span id="cb19-2">il_tracts_gdf.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(3265, 13)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">STATEFP</th>
<th data-quarto-table-cell-role="th">COUNTYFP</th>
<th data-quarto-table-cell-role="th">TRACTCE</th>
<th data-quarto-table-cell-role="th">GEOID</th>
<th data-quarto-table-cell-role="th">NAME</th>
<th data-quarto-table-cell-role="th">NAMELSAD</th>
<th data-quarto-table-cell-role="th">MTFCC</th>
<th data-quarto-table-cell-role="th">FUNCSTAT</th>
<th data-quarto-table-cell-role="th">ALAND</th>
<th data-quarto-table-cell-role="th">AWATER</th>
<th data-quarto-table-cell-role="th">INTPTLAT</th>
<th data-quarto-table-cell-role="th">INTPTLON</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>17</td>
<td>019</td>
<td>010701</td>
<td>17019010701</td>
<td>107.01</td>
<td>Census Tract 107.01</td>
<td>G5020</td>
<td>S</td>
<td>5266000</td>
<td>30553</td>
<td>+40.1150269</td>
<td>-088.0329549</td>
<td>POLYGON ((-88.05240 40.11923, -88.05238 40.119...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>17</td>
<td>019</td>
<td>005902</td>
<td>17019005902</td>
<td>59.02</td>
<td>Census Tract 59.02</td>
<td>G5020</td>
<td>S</td>
<td>962402</td>
<td>4892</td>
<td>+40.1087344</td>
<td>-088.2247204</td>
<td>POLYGON ((-88.22891 40.11271, -88.22882 40.112...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>And now I have plottable, spatially-joinable geospatial data ready to ingest into a data warehouse table or to plot out.</p>
<div class="cell" data-execution_count="45">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1">fig_width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span></span>
<span id="cb21-2"></span>
<span id="cb21-3">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(fig_width, fig_width))</span>
<span id="cb21-4">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> il_tracts_gdf.plot(facecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>, edgecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.015</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> fig_width, ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="https://www.matttriano.dev/posts/004_census_tiger_dev/TIGER_data_collector_dev_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>



</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div> ]]></description>
  <guid>https://www.matttriano.dev/posts/004_census_tiger_dev/TIGER_data_collector_dev.html</guid>
  <pubDate>Wed, 14 Jun 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.matttriano.dev/posts/004_census_tiger_dev/Census_TIGER.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Working with Notebooks</title>
  <dc:creator>Matt Triano</dc:creator>
  <link>https://www.matttriano.dev/posts/002_notebook_test/jupyter_quarto.html</link>
  <description><![CDATA[ 




<div class="cell" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-3"></span>
<span id="cb1-4">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb1-5">theta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.pi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> r</span>
<span id="cb1-6">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(</span>
<span id="cb1-7">  subplot_kw <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'projection'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'polar'</span>} </span>
<span id="cb1-8">)</span>
<span id="cb1-9">ax.plot(theta, r)</span>
<span id="cb1-10">ax.set_rticks([<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb1-11">ax.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb1-12">plt.show()</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-polar" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://www.matttriano.dev/posts/002_notebook_test/jupyter_quarto_files/figure-html/fig-polar-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;1: A line plot on a polar axis</figcaption>
</figure>
</div>
</div>
</div>
<ol type="1">
<li><p>Develop a notebook</p></li>
<li><p>Render that notebook via</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">quarto_env</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user@hostname:~/...$</span> quarto render notebook_name.ipynb</span></code></pre></div></li>
<li><p>Preview your document via</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">quarto_env</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user@hostname:~/...$</span> quarto preview quarto_blog/</span></code></pre></div>
<p>Note: Make sure <code>draft: false</code> in your document, or it won’t render.</p></li>
</ol>




<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div> ]]></description>
  <guid>https://www.matttriano.dev/posts/002_notebook_test/jupyter_quarto.html</guid>
  <pubDate>Mon, 12 Jun 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.matttriano.dev/posts/002_notebook_test/studious_robot.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Setting up Conda</title>
  <dc:creator>Matt Triano</dc:creator>
  <link>https://www.matttriano.dev/posts/000_setting_up_miniconda/Setting_up_Miniconda.html</link>
  <description><![CDATA[ 




<section id="conda" class="level1">
<h1>Conda</h1>
<p><code>conda</code> is a language-agnostic package manager and environment management system. <code>conda</code>’s environment management functionality makes it possible for a user to easily switch between environments (where an environment consists of the hardware and software used to execute code) and makes it possible to export a specification of that environment that can be used to reproduce that environment on another system.</p>
<p>In this post, I’ll show my opinionated <code>conda</code> installation and configuration process.</p>
<section id="conda-installation" class="level2">
<h2 class="anchored" data-anchor-id="conda-installation">Conda Installation</h2>
<p><code>conda</code> is primarily installable via two distributions; the Anaconda distribution, which includes the <code>conda</code> executable along with over 700 additional conda packages from the Anaconda repository, and the Miniconda distribution, which consists of the <code>conda</code> executable with the minimal number of packages needed for <code>conda</code> to run. Install a miniconda distribution.</p>
</section>
</section>
<section id="step-1.-download-a-miniconda-installer" class="level1">
<h1>Step 1. Download a miniconda installer</h1>
<p>Download a <a href="https://docs.conda.io/en/latest/miniconda.html">miniconda</a> installer, copy the corresponding SHA256 hash, calculate the SHA256 hash of the downloaded file, and compare that value to the one copied from the download link page. If the values match exactly, proceed in installation. * For the miniconda version downloaded below, the SHA256 sum should be aef279d6baea7f67940f16aad17ebe5f6aac97487c7c03466ff01f4819e5a651</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>curl <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>o Miniconda3<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>py310_23<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.3.1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Linux<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x86_64.sh https:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span>repo.anaconda.com<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>miniconda<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>Miniconda3<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>py310_23<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.3.1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Linux<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x86_64.sh</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 69.7M  100 69.7M    0     0  75.9M      0 --:--:-- --:--:-- --:--:-- 75.8M</code></pre>
</div>
</div>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>sha256sum Miniconda3<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>py310_23<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.3.1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Linux<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x86_64.sh</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>aef279d6baea7f67940f16aad17ebe5f6aac97487c7c03466ff01f4819e5a651  Miniconda3-py310_23.3.1-0-Linux-x86_64.sh</code></pre>
</div>
</div>
<p>If the calculated hash matches the hash published on the miniconda installer link page, proceed.</p>
</section>
<section id="step-2.-execute-the-installer" class="level1">
<h1>Step 2. Execute the installer</h1>
<p>Run the installer via</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bash</span> Miniconda3-py310_23.3.1-0-Linux-x86_64.sh <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">or</span> whatever your version is<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<p>and respond to prompts as appropriate (go with defaults). After running <code>conda init</code>, run the command <code>source ~/.bashrc</code> to add the path to <code>conda</code> to your <code>$PATH</code> (or you can just open a new terminal window, <code>~/.bashrc</code> runs whenever you open a terminal).</p>
</section>
<section id="step-3.-install-the-libmamba-solver-and-set-it-as-the-default" class="level1">
<h1>Step 3. Install the <code>libmamba</code> solver and set it as the default</h1>
<p>The <code>libmamba</code> dependency solver is far faster than the regular <code>conda</code> solver, and in my experience, it has succeeded at nearly instantly resolving envs that the regular <code>conda</code> solver failed to resolve in hours. It’s great.</p>
<p>Install it via</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">conda</span> install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> base conda-libmamba-solver</span></code></pre></div>
<p>and set it as the default solver via</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">conda</span> config <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--set</span> solver libmamba</span></code></pre></div>
</section>
<section id="step-4.-configure-conda-forge-as-the-priority-channel" class="level1">
<h1>Step 4. Configure <strong>conda-forge</strong> as the priority channel</h1>
<p>Conda-forge is the most complete channel and doesn’t allow package versions to be removed (so an env made purely of packages from the conda-forge channel will be reproducible).</p>
<p>Run these commands to 1) prioritize the conda-forge channel and 2) force conda to only download packages from the highest priority channel.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">conda</span> config <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--add</span> channels conda-forge</span>
<span id="cb8-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">conda</span> config <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--set</span> channel_priority strict</span></code></pre></div>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>This process should take no more than 5 minutes and it will give you a <code>conda</code> setup that avoids the common complaints (e.g., slow, unreproducible).</p>
<p>To learn more about how <code>conda</code> installs packages, read <a href="https://conda.io/projects/conda/en/latest/user-guide/concepts/conda-performance.html#how-a-package-is-installed">this</a>.</p>



</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div> ]]></description>
  <category>conda</category>
  <category>setup</category>
  <category>tutorial</category>
  <guid>https://www.matttriano.dev/posts/000_setting_up_miniconda/Setting_up_Miniconda.html</guid>
  <pubDate>Fri, 22 Jul 2022 00:00:00 GMT</pubDate>
  <media:content url="https://www.matttriano.dev/posts/000_setting_up_miniconda/interested_conda.png" medium="image" type="image/png" height="144" width="144"/>
</item>
</channel>
</rss>
