<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Triano&#39;s Quarto Blog</title>
<link>https://www.matttriano.dev/about.html</link>
<atom:link href="https://www.matttriano.dev/about.xml" rel="self" type="application/rss+xml"/>
<description>A blog by Matt Triano</description>
<image>
<url>https://www.matttriano.dev/profile.jpg</url>
<title>Triano&#39;s Quarto Blog</title>
<link>https://www.matttriano.dev/about.html</link>
</image>
<generator>quarto-1.3.427</generator>
<lastBuildDate>Fri, 23 Jun 2023 00:00:00 GMT</lastBuildDate>
<item>
  <title>Data Quality Monitoring with Great Expectations</title>
  <dc:creator>Matt Triano</dc:creator>
  <link>https://www.matttriano.dev/posts/006_great_expectations_setup/data_monitoring_w_gx_1_setup.html</link>
  <description><![CDATA[ 




<div class="cell" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> dt</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pathlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Path</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> urllib.request <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> urlretrieve</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> geopandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> gpd</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span></code></pre></div>
</details>
</div>
<p>Great Expectations is an open-source Python-based library that brings the idea of “testing” to your data. It enables you to define expectations for properties of your datasets (like records per batch, distribution of values in a column, columns in a table, etc) and check that the data meets those expectations when the data is updated.</p>
<section id="workflow-overview" class="level1">
<h1>Workflow Overview</h1>
<p>The high-level <code>great_expectations</code> workflow follows this pattern:</p>
<ol start="0" type="1">
<li>Install <code>great_expectations</code>.</li>
<li>Create (or load) a <a href="https://docs.greatexpectations.io/docs/guides/setup/configuring_data_contexts/instantiating_data_contexts/instantiate_data_context"><code>DataContext</code></a> for your project.</li>
<li>Connect <a href="https://docs.greatexpectations.io/docs/guides/connecting_to_your_data/connect_to_data_lp/"><code>Datasources</code></a> (and their <code>DataAssets</code>) to your <code>DataContext</code>.</li>
<li>Define <a href="https://docs.greatexpectations.io/docs/guides/expectations/expectations_lp"><code>Expectations</code></a> for your <code>DataAssets</code>.</li>
<li>Set <a href="https://docs.greatexpectations.io/docs/guides/validation/validate_data_lp"><code>Checkpoints</code></a> to validate your <code>DataAssets</code>.</li>
</ol>
<p>In this post, I’ll demonstrate this workflow with local-file-based <code>DataAssets</code> in a local filesystem <code>DataContext</code> (although <code>great_expectations</code> also works with SQL-based and cloud-bucket-based <code>DataAssets</code>).</p>
<section id="great-expectations-setup" class="level2">
<h2 class="anchored" data-anchor-id="great-expectations-setup">0. Great Expectations Setup</h2>
<p>First, you’ll need to install the <code>great_expectations</code>. If you already have <code>conda</code> installed on your machine, you can easily set up a conda env just like the one used to run this notebook by: 1. copying the <code>gx_env_environment.yml</code> file in the same dir as this notebook file to your machine, 2. open a terminal and navigate to the dir with that new file, and 3. run command <code>conda env create -f environment.yml</code></p>
</section>
<section id="sample-data-collection-and-preparation" class="level2">
<h2 class="anchored" data-anchor-id="sample-data-collection-and-preparation">Sample Data Collection and Preparation</h2>
<p>Many data pipelines process data in discrete, periodic batches. I’m going to simulate that situation by downloading a dataset, splitting it into 1-month batches (based on a datetime-like column), and then write each of those 1-month batches to file. I’m going to use the <a href="https://data.cityofchicago.org/Health-Human-Services/Food-Inspections/4ijn-s7e5">Food Inspection dataset</a> on Chicago’s public data portal.</p>
<div class="cell" data-execution_count="4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">POST_DIR <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Path(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"."</span>).resolve()</span>
<span id="cb2-2">POST_DATA_DIR <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> POST_DIR.joinpath(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>)</span>
<span id="cb2-3">POST_DATA_DIR.mkdir(exist_ok<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># First, we need to download the data to our local machine.</span></span>
<span id="cb2-6">url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://data.cityofchicago.org/api/geospatial/4ijn-s7e5?method=export&amp;format=GeoJSON"</span></span>
<span id="cb2-7">full_file_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> POST_DATA_DIR.joinpath(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"full_food_inspections.geojson"</span>)</span>
<span id="cb2-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> full_file_path.is_file():</span>
<span id="cb2-9">    urlretrieve(url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>url, filename<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>full_file_path)</span>
<span id="cb2-10">food_inspection_gdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gpd.read_file(full_file_path)</span>
<span id="cb2-11"></span>
<span id="cb2-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For some reason, Socrata adds on these four always-null location columns on</span></span>
<span id="cb2-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   to geospatial exports. I'm going to remove them.</span></span>
<span id="cb2-14">location_cols <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location_state"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location_zip"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location_address"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location_city"</span>]</span>
<span id="cb2-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># uncomment the lines below to confirm those columns are always empty</span></span>
<span id="cb2-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print("Rows with a non-null value in these location_xxx columns:")</span></span>
<span id="cb2-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># display(food_inspection_gdf[location_cols].notnull().sum())</span></span>
<span id="cb2-18">food_inspection_gdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> food_inspection_gdf.drop(columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>location_cols)</span>
<span id="cb2-19"></span>
<span id="cb2-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># That column ordering is a bit chaotic, so I'll reorder them (for readability).</span></span>
<span id="cb2-21">col_order <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb2-22">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_id"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_date"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dba_name"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"aka_name"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"license_"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"facility_type"</span>,</span>
<span id="cb2-23">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"risk"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_type"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"results"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"address"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"city"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"state"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zip"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"violations"</span>,</span>
<span id="cb2-24">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"longitude"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latitude"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"geometry"</span></span>
<span id="cb2-25">]</span>
<span id="cb2-26">food_inspection_gdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> food_inspection_gdf[col_order].copy()</span>
<span id="cb2-27"></span>
<span id="cb2-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># I also want to break this into batches based on the dates, so I need to cast</span></span>
<span id="cb2-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   the `inspection_date` to a datetime type.</span></span>
<span id="cb2-30">food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_date"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.to_datetime(</span>
<span id="cb2-31">    food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_date"</span>]</span>
<span id="cb2-32">)</span>
<span id="cb2-33"></span>
<span id="cb2-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># I'll also cast string and numeric features to their proper dtypes.</span></span>
<span id="cb2-35">food_inspection_gdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> food_inspection_gdf.convert_dtypes()</span>
<span id="cb2-36">food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_id"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_id"</span>].astype(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Int64"</span>)</span>
<span id="cb2-37">food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"license_"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"license_"</span>].astype(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Int64"</span>)</span>
<span id="cb2-38">food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"longitude"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"longitude"</span>].astype(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Float64"</span>)</span>
<span id="cb2-39">food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latitude"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latitude"</span>].astype(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Float64"</span>)</span>
<span id="cb2-40"></span>
<span id="cb2-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># I'll also just make all string uppercase (to reduce cardinality)</span></span>
<span id="cb2-42">str_cols <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(food_inspection_gdf.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>).select_dtypes(include<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"string"</span>).columns)</span>
<span id="cb2-43">food_inspection_gdf[str_cols] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> food_inspection_gdf[str_cols].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> x: x.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.upper())</span></code></pre></div>
</details>
</div>
<p>Here’s a sample of the dataset (after some light preprocessing and <code>dtype</code>setting).</p>
<div class="cell" data-execution_count="25">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(food_inspection_gdf.shape)</span>
<span id="cb3-2">food_inspection_gdf.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(255573, 17)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">inspection_id</th>
<th data-quarto-table-cell-role="th">inspection_date</th>
<th data-quarto-table-cell-role="th">dba_name</th>
<th data-quarto-table-cell-role="th">aka_name</th>
<th data-quarto-table-cell-role="th">license_</th>
<th data-quarto-table-cell-role="th">facility_type</th>
<th data-quarto-table-cell-role="th">risk</th>
<th data-quarto-table-cell-role="th">inspection_type</th>
<th data-quarto-table-cell-role="th">results</th>
<th data-quarto-table-cell-role="th">address</th>
<th data-quarto-table-cell-role="th">city</th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">zip</th>
<th data-quarto-table-cell-role="th">violations</th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2577546</td>
<td>2023-06-20</td>
<td>CIAO RAGAZZI</td>
<td>CIAO RAGAZZI</td>
<td>2808408</td>
<td>Restaurant</td>
<td>Risk 1 (High)</td>
<td>Canvass</td>
<td>Pass w/ Conditions</td>
<td>5440 S NARRAGANSETT AVE</td>
<td>CHICAGO</td>
<td>IL</td>
<td>60638</td>
<td>10. ADEQUATE HANDWASHING SINKS PROPERLY SUPPLI...</td>
<td>-87.781975</td>
<td>41.793006</td>
<td>POINT (-87.78197 41.79301)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2577553</td>
<td>2023-06-20</td>
<td>CHISOX BAR &amp; GRILL</td>
<td>CHI SOX BAR &amp; GRILL</td>
<td>2078887</td>
<td>Restaurant</td>
<td>Risk 1 (High)</td>
<td>Canvass</td>
<td>Pass</td>
<td>320 W 35TH ST</td>
<td>CHICAGO</td>
<td>IL</td>
<td>60616</td>
<td>51. PLUMBING INSTALLED; PROPER BACKFLOW DEVICE...</td>
<td>-87.634932</td>
<td>41.831008</td>
<td>POINT (-87.63493 41.83101)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>In the (folded up) cell below, we split the dataset into batches and write each batch to file in this post’s <code>./data</code> directory.</p>
<div class="cell" data-execution_count="43">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># I want to split the data into 1-month batches, so I need to get the first day of the month</span></span>
<span id="cb5-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   for every month between the earliest inspection and the month after the latest inspection</span></span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   in our food inspection dataset.</span></span>
<span id="cb5-4">month_start_dates <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.date_range(</span>
<span id="cb5-5">    start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_date"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pd.DateOffset(months<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb5-6">    end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_date"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pd.DateOffset(months<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb5-7">    freq<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MS"</span>,</span>
<span id="cb5-8">)</span>
<span id="cb5-9"></span>
<span id="cb5-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Here, we'll iterate through each of those month_start_dates, extract the batch of data,</span></span>
<span id="cb5-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   format a filename containing the month_start_date, and write the batch to file.</span></span>
<span id="cb5-12"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> month_start_date <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> month_start_dates:</span>
<span id="cb5-13">    batch_period <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.to_datetime(month_start_date).strftime(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y_%m"</span>)</span>
<span id="cb5-14">    batch_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> food_inspection_gdf.loc[</span>
<span id="cb5-15">        food_inspection_gdf[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_date"</span>].between(</span>
<span id="cb5-16">            left<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>month_start_date,</span>
<span id="cb5-17">            right<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>month_start_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pd.DateOffset(months<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb5-18">            inclusive<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>)</span>
<span id="cb5-19">    ].copy()</span>
<span id="cb5-20">    batch_file_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> POST_DATA_DIR.joinpath(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"food_inspection_batch_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>batch_period<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">.parquet"</span>)</span>
<span id="cb5-21">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> batch_file_path.is_file():</span>
<span id="cb5-22">        batch_data.to_parquet(batch_file_path, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="create-or-load-great-expectations-data-context" class="level2">
<h2 class="anchored" data-anchor-id="create-or-load-great-expectations-data-context">1. Create or Load Great Expectations Data Context</h2>
<div class="cell" data-execution_count="13">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> great_expectations <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> gx</span>
<span id="cb6-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> great_expectations.data_context <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> FileDataContext</span>
<span id="cb6-3"></span>
<span id="cb6-4">context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> FileDataContext.create(project_root_dir<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>POST_DIR)</span></code></pre></div>
</details>
</div>
</section>
<section id="create-a-datasource" class="level2">
<h2 class="anchored" data-anchor-id="create-a-datasource">Create a Datasource</h2>
<div class="cell" data-execution_count="17">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">datasource_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"food_inspection_datasource"</span></span>
<span id="cb7-2"></span>
<span id="cb7-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">any</span>(el[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> datasource_name <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> el <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> context.list_datasources()):</span>
<span id="cb7-4">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Datasource with name '</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>datasource_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">' found; loading now"</span>)</span>
<span id="cb7-5">    datasource <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> context.get_datasource(datasource_name)</span>
<span id="cb7-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb7-7">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"No Datasource with name '</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>datasource_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">' found; creating now"</span>)</span>
<span id="cb7-8">    datasource <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> context.sources.add_pandas_filesystem(</span>
<span id="cb7-9">        name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>datasource_name,</span>
<span id="cb7-10">        base_directory<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>POST_DATA_DIR</span>
<span id="cb7-11">    )</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Datasource with name 'food_inspection_datasource' found; loading now</code></pre>
</div>
</div>
<div class="cell" data-execution_count="16">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell" data-execution_count="20">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">[el <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> el <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dir</span>(datasource) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> el.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"add_"</span>)]</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>['add_csv_asset',
 'add_excel_asset',
 'add_feather_asset',
 'add_fwf_asset',
 'add_hdf_asset',
 'add_html_asset',
 'add_json_asset',
 'add_orc_asset',
 'add_parquet_asset',
 'add_pickle_asset',
 'add_sas_asset',
 'add_spss_asset',
 'add_stata_asset',
 'add_xml_asset']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="29">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">data_asset_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"food_inspections_asset"</span></span>
<span id="cb13-2"></span>
<span id="cb13-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> data_asset_name <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> datasource.get_asset_names():</span>
<span id="cb13-4">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Creating data asset </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>data_asset_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb13-5">    data_asset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datasource.add_parquet_asset(</span>
<span id="cb13-6">        name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data_asset_name,</span>
<span id="cb13-7">        batching_regex <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"food_inspection_batch_(?P&lt;year&gt;\d</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{4}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">)_(?P&lt;month&gt;\d</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{2}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">)\.parquet"</span></span>
<span id="cb13-8">    )</span>
<span id="cb13-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb13-10">    data_asset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datasource.get_asset(data_asset_name)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Creating data asset food_inspections_asset</code></pre>
</div>
</div>
<p>I’ll also sort these batches.</p>
<div class="cell" data-execution_count="30">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">data_asset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_asset.add_sorters([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+year"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+month"</span>])</span></code></pre></div>
</details>
</div>
<div class="cell" data-execution_count="31">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1">batch_request <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_asset.build_batch_request()</span>
<span id="cb16-2">batches <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_asset.get_batch_list_from_batch_request(batch_request)</span></code></pre></div>
</details>
</div>
</section>
<section id="using-the-profiler-to-create-basic-expectations" class="level2">
<h2 class="anchored" data-anchor-id="using-the-profiler-to-create-basic-expectations">Using the profiler to create basic expectations</h2>
<div class="cell" data-execution_count="35">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">expectation_suite_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"food_inspections_suite"</span></span>
<span id="cb17-2"></span>
<span id="cb17-3">expectation_suite <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> context.add_or_update_expectation_suite(</span>
<span id="cb17-4">    expectation_suite_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>expectation_suite_name</span>
<span id="cb17-5">)</span></code></pre></div>
</details>
</div>
<div class="cell" data-execution_count="36">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1">data_assistant_result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> context.assistants.onboarding.run(</span>
<span id="cb18-2">    batch_request<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>batch_request,</span>
<span id="cb18-3">    exclude_column_names<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[],</span>
<span id="cb18-4">)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"bc025d110ee643a2b69a270acd152875","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2bc11c9742e44059bd734fe954f55df8","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"fe860fe4bdf04715bdddf02b2f9584f2","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"06fc78a96d2a460da7389645df432eb6","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"5b91b6e8a2d7467fb28808aa8bfeb6ea","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e590bbadf096426e8c62e3926aa1e4f6","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7ffeaba854714e9eabd737b449323f2c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0bd2fb99d3a749b197db5b41a6a095de","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b6139faf45834d239489b509b6940a16","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"545c6b2d6c9244019c1ecbf512198f2b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f6f801ae202945d8bbd676d85a1659e1","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"8539acb710184cf89d250cf013f30747","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"544628e51dc74859afc5e6e9672f6cd0","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4a233c00294e416d8f6a8c25d053a582","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"64044b5c0b8c466db47f36d3386097cf","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"bd663daad8594e0486db28292e5667d3","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c85eeb851b574817b3f457f06703b73a","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"abf47bc585794e76b9ea41140a29d973","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"78711c640a624be092fb23b21974b504","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6eaf0b1736534ba782465cf47e67c1fc","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9844a583ccc64d9a9ab5fb3daf13918b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0c9165f8f75a45dd80e78cda9896a194","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"72d40e38c62e4569b2b57e02860a7b52","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6ddb4f72b4194a5e84084d0bd4c6910e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d158bd57e75f45e8b083117516c67add","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"cdabf2cb25bb4de39d0851073b2d98a6","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"93a9fde25c104bd89808aba4a671d88b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d0f6fba70dbc4bb6bd47680345d10d15","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f5196fce82114d4aae64fc3e279a585d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"fbad91a00dcc4e1db5b61ae2e41d8457","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"24a700af19ee4546b8e7b44f1a999967","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"819c91d4bff5417ca5f8deed6e3e9dc5","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7370cffbf40f4f788d767ad42533f447","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"56b0a5fbb7a24b22996685dacfd0d363","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e782ef03a4ee4f8c9311e225aeb4dc4c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"1f08d37e57d542c98f8a5d148517f33d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"caceffd80f624b4e9d1c386a41f85966","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"240998980b8746059d5f12da50ea8508","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"3a5a079d8e5943ffbab49d48c998d85c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"fe6db70933d94668aebc561e1bfea0f5","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"821daae193d2419b9eb5f3e9577f92ad","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"99c4f48f6a17452c92ad979253ecaf00","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f94edf81ee0e45d6ac5b8ec63f97acf7","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a8b0ced60e6b4053a2a6a53fc4808cea","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4666e50bad694fc1a0e129f32f0b48d5","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c06fa0077e0140839d72f828f771f4a7","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"cf995eb15bf04498af27cddbca8b42f9","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"95110b0726e441b5b9bcba9e6e71727d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2b53aa3c18f34d0dbad73d2f54003163","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b580296f5cf14cbead83612e10e65192","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"65dc7a80a50e4a8a9aff604961d1b97b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"eba4c5c784b246fb841bd4ba00a79fe2","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f309e3d9932749f792f355102589dc26","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9429612202b04993a219b24465302e86","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a7cd4ba62f124a0b8235e1122c9a9186","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2f8855f2e0af438a98a770b72e9f2a8b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"429d297e014641479405c6b788b5c9c8","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6a896aa6c33049caac9f2ea0fccd80cc","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"efec4be735ff4fcb96033ae569afbd07","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"60b57baa368543ca8c7a2f955e5e5d44","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"99f8e6dd40fd4a44ac27adec12d94de6","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"1d3fafb444f3431b995c88c12ab41f0c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"91671a12b8704c76ac5e271f6e648ac7","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"08992a56c1f541a597622bb5c665b8ba","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"3d5b4290b3614e5bab9a79cec297c8cf","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0a2b28a274924da2a83a50cf261a2381","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6b7e4c4b5579468c9b10d5a5c20815ce","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0832192a3a994d01a012300da4759eb5","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e26a1a774a4a468a97d5bbc3ec3ae256","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"cdda647829204ba7b2eb14806cf27d58","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"879318abf2c249fa8eea5e543287c86c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"5df32dcf84ae47019e9e4d122d080f3d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"069556fd3f5f4ef59981ad29a4fe7b82","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f17eb2fc8571448cae73d787d4a77aa7","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6ab57cd7487d4ce19b9a9ef24d19d0f2","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"3264253f48ed4c56bccf557408bb30f0","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"98018bfd2abf4ccc965ea5f9df5ca4ce","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"98c58cd062e1427d9123aaecff7b35f3","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"556efe5ab1424edfb2754c91246b233d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e1a1b7d208934d919b0e056f54012d7a","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"28cb8f36d94146edb69e3fa42a3b0b52","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"40a67360ab134de3854e657445c3466c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"1dbb036010284b9babf691bca9c992e7","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a205c36cd23547e7b873cce581a602a4","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e35ca00eca2b45c7bed99ffcf86ac17b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"97bf8a6b535241499b280b52dcfd9ec7","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"87445fb540804f7a87d7b5a804d765f2","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6fd74a77399b42d58da08128e753ebe6","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a29bf7fa64e54e82b2334cdac25fe53b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4d6d36a93ede4ea385e08ab0a91ca679","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6a1597f6666c4de3b9ccc5a42036b010","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b2e85e0d7ed84a219fac2459c4be7c2a","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4895254ccfb5459a871c732d52ce469f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"49b83ab9fb594a39a82f216df7c1a958","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"dc10ff9216f841fba09e6c12416f334e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"64d47e0f5846499d9733205a47f397f3","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"191ac0ed397a4d718515baf40724d30e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"44c054d1a64b409c85cddad39c403179","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"fa7b70d41e3c437fa375cd7b3a13d9a3","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"47032ca816a849c3a22949330c6e13ec","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"687ae8722cdf44e5aa676a3b6bc822e2","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"20b23cf62bb44a12ad7401ba868ba677","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b4787c943deb4932923fe06007860ff2","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"bcebb1c0d64146fc9b37ea6dac9b120e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2e318d2e9c914241b6b6995bbd19117f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"517500e872dd401ea1c25745c8dca84c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e37cbf13d67d44e29ed66f2f85b53368","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"95f66205769846d5a1cc9b8b94e62efa","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c3c84503b6f44d1184c89782f981cde7","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e7eb5bd8248e4492af04e58f97fb0c9f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"de7cf0f57f194d8a90fd720aa39263b1","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d3a4d790c0b54135b124685553b0f495","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ff6981032fd543e3b265e74566952ed6","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c303c41a045f49538f95fba36a106ed6","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"35bca147074a4bdb846683f2ecb8eecb","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e58257fc22af4420a0cc0b9ac0413452","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b9b315643755493eba0bf9f91194cf94","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9d4c7731ee054904b7ba2eea7d207872","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"951e9a01464741568bf7d541af8e61d5","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a6cfb01dafa54468b85b7bab7fdc8f46","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"aa157977118840f3abc116f4e9cec371","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b3701a93c2d147a7baaf12a613497459","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"5597af81b80e416e9f6eff32e5f98724","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9854f0e9052249c19b1173a35efe0268","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"12dd5e7d23bb43fa9c47aae328a70a47","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"873385a9e5ba431b802d8d1b0aee4b62","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"43fb747981e2412b90c851dd63c74885","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"06dbf8c3ad8244799449090e2973d3ce","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"65c235f91171498e8d2ccd97d0d9d2a3","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9f5e5a63d0b14ab490c368b86eef7082","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"13691e91064d4fa6baa060cb009dbbcb","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"46e14f5d89214e499c702b98a017c06a","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4637de8e41f54f42839b94fbd5af11b9","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"bebfad1ade8d443db8a29f03eac8dc57","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c69708d730ab45a0b69cd59c2b6841db","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6cc35db070854f3988c31802bd193e69","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"cfe2db5864124a298f622917ed5bb5ac","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b52db801dd93480cb6aaf5f2f5c08239","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"1bf4fab110774139ba38243aadd1cf34","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div class="cell" data-execution_count="47">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1">data_assistant_result.plot_expectations_and_metrics(exclude_column_names<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inspection_date"</span>])</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>62 Expectations produced, 9 Expectation and Metric plots implemented
Use DataAssistantResult.show_expectations_by_domain_type() or
DataAssistantResult.show_expectations_by_expectation_type() to show all produced Expectations</code></pre>
</div>
<div class="cell-output cell-output-display">

                <style>
                @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600&display=swap');
                </style>
                
</div>
<div class="cell-output cell-output-display">

                <style>
                span.vega-bind-name {
                    color: #404041;
                    font-family: Montserrat;
                    font-size: 14px;
                    font-weight: 500;
                }
                form.vega-bindings {
                    color: #404041;
                    font-family: Montserrat;
                    font-size: 14px;
                    font-weight: 500;
                    position: absolute;
                    left: 75px;
                    top: 28px;
                }
                </style>
            
</div>
<div class="cell-output cell-output-display">

                <style>
                .widget-inline-hbox .widget-label {
                    color: #404041;
                    font-family: Montserrat;
                    font-size: 14px;
                    font-weight: 500;
                }
                .widget-dropdown > select {
                    padding-right: 21px;
                    padding-left: 3px;
                    color: #404041;
                    font-family: Montserrat;
                    font-size: 14px;
                    font-weight: 500;
                    height: 20px;
                    line-height: 14px;
                    background-size: 20px;
                    border-radius: 2px;
                }
                </style>
            
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"5c07186771b6443488565100dbd55850","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code></code></pre>
</div>
</div>
<div class="cell" data-execution_count="40">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1">expectation_suite <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_assistant_result.get_expectation_suite(</span>
<span id="cb23-2">    expectation_suite_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>expectation_suite_name</span>
<span id="cb23-3">)</span></code></pre></div>
</details>
</div>
<div class="cell" data-execution_count="48">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># expectation_suite.show_expectations_by_expectation_type()</span></span></code></pre></div>
</details>
</div>
<div class="cell" data-execution_count="50">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1">saved_suite <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> context.add_or_update_expectation_suite(expectation_suite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>expectation_suite)</span></code></pre></div>
</details>
</div>



</section>
</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div> ]]></description>
  <guid>https://www.matttriano.dev/posts/006_great_expectations_setup/data_monitoring_w_gx_1_setup.html</guid>
  <pubDate>Fri, 23 Jun 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.matttriano.dev/posts/006_great_expectations_setup/pip_setting_(up)_Great_Expectations.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Census TIGER Dataset Collector Dev</title>
  <dc:creator>Matt Triano</dc:creator>
  <link>https://www.matttriano.dev/posts/004_census_tiger_dev/TIGER_data_collector_dev.html</link>
  <description><![CDATA[ 




<div class="cell" data-execution_count="41">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> textwrap</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Dict, List, Union, Optional</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> urllib.request <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> urlretrieve</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> bs4 <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BeautifulSoup</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> geopandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> gpd</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> requests</span></code></pre></div>
</details>
</div>
<p>The US Census Bureau (USCB) runs a massive array of surveys of residents of the United States. After aggregating responses into demographic and/or geographic groups, the USCB publishes those aggregated datasets to its massive public data catalog. I’ve already developed some tooling to collect and ingest Census datasets into my personal data warehouse and analytics environment, but to map out geographic Census data or join in other geospatial datasets, I also need to collect and ingest spatial files describing the geographic boundaries of Census groupings. Fortunately, the USCB provides shapefiles with these geometries in their TIGER (Topologically Integrated Geographic Encoding and Referencing) data offerings, and in this notebook, I’ll synthesize the findings the experiments and research in my last notebook into a data model and data collection tools.</p>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References:</h3>
<ul>
<li><a href="https://www.census.gov/programs-surveys/geography/technical-documentation/complete-technical-documentation/tiger-geo-line.2022.html">TIGER Technical Docs</a></li>
<li><a href="https://www.census.gov/programs-surveys/geography/technical-documentation/code-lists.html">TIGER Geographic Codes</a></li>
</ul>
<p>Each year, the USCB can add or alter geographic boundaries or connected data features, so they organize TIGER data offering into annual vintages, which can be downloaded either through the USCB web interface or from their <a href="https://www2.census.gov/geo/tiger/">file server interface</a> (https://www2.census.gov/geo/tiger/).</p>
<p>The functions in the cell below aid in scraping the table off of any of pages linked in that file-tree interface.</p>
<div class="cell" data-execution_count="4">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> request_page(metadata_url: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> requests.models.Response:</span>
<span id="cb2-2">    resp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> requests.get(metadata_url)</span>
<span id="cb2-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> resp.status_code <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>:</span>
<span id="cb2-4">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> resp</span>
<span id="cb2-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb2-6">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Couldn't get page metadata for url </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>metadata_url<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb2-7"></span>
<span id="cb2-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> scrape_census_ftp_metadata_page(metadata_url: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb2-9">    resp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> request_page(metadata_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>metadata_url)</span>
<span id="cb2-10">    soup <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BeautifulSoup(resp.content, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"html.parser"</span>)</span>
<span id="cb2-11">    table <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.find(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"table"</span>)</span>
<span id="cb2-12">    rows <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> table.find_all(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tr"</span>)</span>
<span id="cb2-13">    table_contents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb2-14">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> row <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> rows:</span>
<span id="cb2-15">        cols <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> row.find_all(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"td"</span>)</span>
<span id="cb2-16">        cols <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [col.text.strip() <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> col <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> cols]</span>
<span id="cb2-17">        table_contents.append(cols)</span>
<span id="cb2-18">    table_rows <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [el <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> el <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> table_contents <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(el) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb2-19"></span>
<span id="cb2-20">    metadata_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(</span>
<span id="cb2-21">        [row[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> row <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> table_rows],</span>
<span id="cb2-22">        columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"last_modified"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"size"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"description"</span>],</span>
<span id="cb2-23">    )</span>
<span id="cb2-24">    metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"last_modified"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.to_datetime(metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"last_modified"</span>])</span>
<span id="cb2-25">    metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_dir"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.endswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/"</span>)</span>
<span id="cb2-26">    metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clean_name"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, regex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb2-27">    metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_file"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_dir"</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> (</span>
<span id="cb2-28">        metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clean_name"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Parent Directory"</span></span>
<span id="cb2-29">    )</span>
<span id="cb2-30">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">while</span> metadata_url.strip().endswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/"</span>):</span>
<span id="cb2-31">        metadata_url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> metadata_url[:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb2-32">    mask <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_file"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_dir"</span>]</span>
<span id="cb2-33">    metadata_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> metadata_df.loc[mask].copy()</span>
<span id="cb2-34">    metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata_url"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (metadata_url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> metadata_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clean_name"</span>])</span>
<span id="cb2-35">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> metadata_df</span></code></pre></div>
</details>
</div>
<p><code>request_page()</code> makes a GET request for the content at the URL <code>metadata_url</code> and returns the response (if successful, i.e.&nbsp;if the response has the “success” HTTP response status code). This function is only called by <code>scrape_census_ftp_metadata_page()</code>, but it’s separated out to make it easier to test <code>scrape_census_ftp_metadata_page()</code>.</p>
<div class="cell" data-execution_count="5">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> request_page(metadata_url: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> requests.models.Response:</span>
<span id="cb3-2">    resp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> requests.get(metadata_url)</span>
<span id="cb3-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> resp.status_code <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>:</span>
<span id="cb3-4">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> resp</span>
<span id="cb3-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb3-6">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Couldn't get page metadata for url </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>metadata_url<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
<p><code>scrape_census_ftp_metadata_page()</code> gets the content from a given Census file-tree page (at URL <code>metadata_url</code>), parses it into a convenient and well structured format (a <code>pandas DataFrame</code>) with features that aid in filtering to desired rows.</p>
<div class="cell" data-execution_count="10">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">resp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> request_page(metadata_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://www2.census.gov/geo/tiger/"</span>)</span>
<span id="cb4-2">soup <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BeautifulSoup(resp.content, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"html.parser"</span>)</span>
<span id="cb4-3">table <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.find(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"table"</span>)</span>
<span id="cb4-4">rows <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> table.find_all(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tr"</span>)</span>
<span id="cb4-5">rows[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>]</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>[&lt;tr&gt;&lt;th valign="top"&gt;&lt;img alt="[ICO]" src="/icons/blank.gif"/&gt;&lt;/th&gt;&lt;th&gt;&lt;a href="?C=N;O=D"&gt;Name&lt;/a&gt;&lt;/th&gt;&lt;th&gt;&lt;a href="?C=M;O=A"&gt;Last modified&lt;/a&gt;&lt;/th&gt;&lt;th&gt;&lt;a href="?C=S;O=A"&gt;Size&lt;/a&gt;&lt;/th&gt;&lt;th&gt;&lt;a href="?C=D;O=A"&gt;Description&lt;/a&gt;&lt;/th&gt;&lt;/tr&gt;,
 &lt;tr&gt;&lt;th colspan="5"&gt;&lt;hr/&gt;&lt;/th&gt;&lt;/tr&gt;,
 &lt;tr&gt;&lt;td valign="top"&gt;&lt;img alt="[PARENTDIR]" src="/icons/back.gif"/&gt;&lt;/td&gt;&lt;td&gt;&lt;a href="/geo/"&gt;Parent Directory&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&nbsp;&lt;/td&gt;&lt;td align="right"&gt;  - &lt;/td&gt;&lt;td&gt;&nbsp;&lt;/td&gt;&lt;/tr&gt;,
 &lt;tr&gt;&lt;td valign="top"&gt;&lt;img alt="[   ]" src="/icons/layout.gif"/&gt;&lt;/td&gt;&lt;td&gt;&lt;a href="Directory_Contents_ReadMe.pdf"&gt;Directory_Contents_ReadMe.pdf&lt;/a&gt;&lt;/td&gt;&lt;td align="right"&gt;2019-06-25 09:13  &lt;/td&gt;&lt;td align="right"&gt;439K&lt;/td&gt;&lt;td&gt;&nbsp;&lt;/td&gt;&lt;/tr&gt;,
 &lt;tr&gt;&lt;td valign="top"&gt;&lt;img alt="[DIR]" src="/icons/folder.gif"/&gt;&lt;/td&gt;&lt;td&gt;&lt;a href="GENZ2010/"&gt;GENZ2010/&lt;/a&gt;&lt;/td&gt;&lt;td align="right"&gt;2013-07-24 12:46  &lt;/td&gt;&lt;td align="right"&gt;  - &lt;/td&gt;&lt;td&gt;&nbsp;&lt;/td&gt;&lt;/tr&gt;,
 &lt;tr&gt;&lt;td valign="top"&gt;&lt;img alt="[DIR]" src="/icons/folder.gif"/&gt;&lt;/td&gt;&lt;td&gt;&lt;a href="GENZ2012/"&gt;GENZ2012/&lt;/a&gt;&lt;/td&gt;&lt;td align="right"&gt;2013-07-24 12:47  &lt;/td&gt;&lt;td align="right"&gt;  - &lt;/td&gt;&lt;td&gt;&nbsp;&lt;/td&gt;&lt;/tr&gt;,
 &lt;tr&gt;&lt;td valign="top"&gt;&lt;img alt="[DIR]" src="/icons/folder.gif"/&gt;&lt;/td&gt;&lt;td&gt;&lt;a href="GENZ2013/"&gt;GENZ2013/&lt;/a&gt;&lt;/td&gt;&lt;td align="right"&gt;2014-07-02 08:28  &lt;/td&gt;&lt;td align="right"&gt;  - &lt;/td&gt;&lt;td&gt;&nbsp;&lt;/td&gt;&lt;/tr&gt;]</code></pre>
</div>
</div>
<p>The cell above shows code that extracts HTML <code>tr</code> (table-row) elements extracted from the page (sorry for showing something so ugly!), and the cell below shows the (beautiful) end product of <code>scrape_census_ftp_metadata_page()</code>.</p>
<div class="cell" data-execution_count="11">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">all_tiger_vintages_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scrape_census_ftp_metadata_page(</span>
<span id="cb6-2">    metadata_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://www2.census.gov/geo/tiger/"</span></span>
<span id="cb6-3">)</span>
<span id="cb6-4">display(all_tiger_vintages_df.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">last_modified</th>
<th data-quarto-table-cell-role="th">size</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">is_dir</th>
<th data-quarto-table-cell-role="th">clean_name</th>
<th data-quarto-table-cell-role="th">is_file</th>
<th data-quarto-table-cell-role="th">metadata_url</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>Directory_Contents_ReadMe.pdf</td>
<td>2019-06-25 09:13:00</td>
<td>439K</td>
<td></td>
<td>False</td>
<td>Directory_Contents_ReadMe.pdf</td>
<td>True</td>
<td>https://www2.census.gov/geo/tiger/Directory_Co...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>GENZ2010/</td>
<td>2013-07-24 12:46:00</td>
<td>-</td>
<td></td>
<td>True</td>
<td>GENZ2010</td>
<td>False</td>
<td>https://www2.census.gov/geo/tiger/GENZ2010</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>GENZ2012/</td>
<td>2013-07-24 12:47:00</td>
<td>-</td>
<td></td>
<td>True</td>
<td>GENZ2012</td>
<td>False</td>
<td>https://www2.census.gov/geo/tiger/GENZ2012</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>GENZ2013/</td>
<td>2014-07-02 08:28:00</td>
<td>-</td>
<td></td>
<td>True</td>
<td>GENZ2013</td>
<td>False</td>
<td>https://www2.census.gov/geo/tiger/GENZ2013</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="26">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Files on the top-level TIGER dataset page:                </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>all_tiger_vintages_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'is_file'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:&gt;3}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb7-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"TIGER data offerings on the top-level TIGER dataset page: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>all_tiger_vintages_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'is_dir'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:&gt;3}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Files on the top-level TIGER dataset page:                  1
TIGER data offerings on the top-level TIGER dataset page:  59</code></pre>
</div>
</div>
<p>The <code>GENZyyyy</code> TIGER data offerings are interesting, but the real wealth of geospatial files can be found in the TIGER offerings with names matching the <code>TIGERyyyy</code> pattern, and I implemented the <code>get_tiger_vintages_metadata()</code> function to get the metadata for these offerings, or <strong>vintages</strong>.</p>
<div class="cell" data-execution_count="25">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_tiger_vintages_metadata() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb9-2">    all_tiger_vintages_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scrape_census_ftp_metadata_page(</span>
<span id="cb9-3">        metadata_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://www2.census.gov/geo/tiger/"</span></span>
<span id="cb9-4">    )</span>
<span id="cb9-5">    tiger_vintages_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> all_tiger_vintages_df.loc[</span>
<span id="cb9-6">        all_tiger_vintages_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^TIGER\d</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{4}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">/"</span>, regex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb9-7">    ].copy()</span>
<span id="cb9-8">    tiger_vintages_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tiger_vintages_df.sort_values(by<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>, ignore_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb9-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> tiger_vintages_df</span>
<span id="cb9-10"></span>
<span id="cb9-11">tiger_vintages_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_tiger_vintages_metadata()</span>
<span id="cb9-12"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Available TIGER vintages:"</span>)</span>
<span id="cb9-13">names <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> textwrap.wrap(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">", "</span>.join(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(tiger_vintages_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clean_name"</span>].values)), width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">95</span>)</span>
<span id="cb9-14"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> line <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> names:</span>
<span id="cb9-15">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"    </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>line<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb9-16">display(tiger_vintages_df.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Available TIGER vintages:
    TIGER1992, TIGER1999, TIGER2002, TIGER2003, TIGER2008, TIGER2009, TIGER2010, TIGER2011,
    TIGER2012, TIGER2013, TIGER2014, TIGER2015, TIGER2016, TIGER2017, TIGER2018, TIGER2019,
    TIGER2020, TIGER2021, TIGER2022</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">last_modified</th>
<th data-quarto-table-cell-role="th">size</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">is_dir</th>
<th data-quarto-table-cell-role="th">clean_name</th>
<th data-quarto-table-cell-role="th">is_file</th>
<th data-quarto-table-cell-role="th">metadata_url</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>TIGER1992/</td>
<td>2011-12-19 07:56:00</td>
<td>-</td>
<td></td>
<td>True</td>
<td>TIGER1992</td>
<td>False</td>
<td>https://www2.census.gov/geo/tiger/TIGER1992</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>TIGER1999/</td>
<td>2012-02-13 11:19:00</td>
<td>-</td>
<td></td>
<td>True</td>
<td>TIGER1999</td>
<td>False</td>
<td>https://www2.census.gov/geo/tiger/TIGER1999</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>TIGER2002/</td>
<td>2015-05-05 18:37:00</td>
<td>-</td>
<td></td>
<td>True</td>
<td>TIGER2002</td>
<td>False</td>
<td>https://www2.census.gov/geo/tiger/TIGER2002</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now that we have tools for scraping the any page in the Census’s file server, we can use those tools to retrieve data on the geographic entities in a given TIGER vintage.</p>
<div class="cell" data-execution_count="35">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> TIGERCatalog:</span>
<span id="cb11-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb11-3">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.dataset_vintages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_tiger_vintages_metadata()</span>
<span id="cb11-4"></span>
<span id="cb11-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_vintage_metadata(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, year: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb11-6">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.dataset_vintages.loc[<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.dataset_vintages[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"TIGER</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>year<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/"</span>].copy()</span>
<span id="cb11-7"></span>
<span id="cb11-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> TIGERVintageCatalog:</span>
<span id="cb11-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, year: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, catalog: Optional[TIGERCatalog] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>):</span>
<span id="cb11-10">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.year <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(year)</span>
<span id="cb11-11">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.set_catalog(catalog<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>catalog)</span>
<span id="cb11-12"></span>
<span id="cb11-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> set_catalog(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, catalog: Optional[TIGERCatalog]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb11-14">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> catalog <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">is</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb11-15">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.catalog <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TIGERCatalog()</span>
<span id="cb11-16">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb11-17">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.catalog <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> catalog</span>
<span id="cb11-18"></span>
<span id="cb11-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@property</span></span>
<span id="cb11-20">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> vintage_metadata(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb11-21">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.catalog.get_vintage_metadata(year<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.year)</span>
<span id="cb11-22"></span>
<span id="cb11-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@property</span></span>
<span id="cb11-24">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> vintage_entities(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb11-25">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vintage_metadata) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb11-26">            tiger_vintage_url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vintage_metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata_url"</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb11-27">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> scrape_census_ftp_metadata_page(metadata_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tiger_vintage_url)</span>
<span id="cb11-28">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb11-29">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span>(</span>
<span id="cb11-30">                <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Failed to get unambiguous metadata (got </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>vintage_metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)"</span></span>
<span id="cb11-31">            )</span>
<span id="cb11-32"></span>
<span id="cb11-33">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_entity_metadata(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, entity_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb11-34">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vintage_entities.loc[<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vintage_entities[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clean_name"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> entity_name].copy()</span>
<span id="cb11-35"></span>
<span id="cb11-36">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> print_entity_names(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb11-37">        entity_names <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vintage_entities.loc[</span>
<span id="cb11-38">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vintage_entities[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_dir"</span>], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clean_name"</span></span>
<span id="cb11-39">        ].values</span>
<span id="cb11-40">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"TIGER Entity options for the </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>year<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> TIGER vintage:"</span>)</span>
<span id="cb11-41">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> entity_name <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> entity_names:</span>
<span id="cb11-42">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  - </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>entity_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb11-43">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Entity count: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(entity_names)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
<div class="cell" data-execution_count="34">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">tiger_catalog <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TIGERCatalog()</span>
<span id="cb12-2">vintage_entity_catalog <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TIGERVintageCatalog(year<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022"</span>, catalog<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tiger_catalog)</span>
<span id="cb12-3">vintage_entity_catalog.print_entity_names()</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>TIGER Entity options for the 2022 TIGER vintage:
  - ADDR
  - ADDRFEAT
  - ADDRFN
  - AIANNH
  - AITSN
  - ANRC
  - AREALM
  - AREAWATER
  - BG
  - CD
  - COASTLINE
  - CONCITY
  - COUNTY
  - COUSUB
  - EDGES
  - ELSD
  - ESTATE
  - FACES
  - FACESAH
  - FACESAL
  - FACESMIL
  - FEATNAMES
  - LINEARWATER
  - MIL
  - PLACE
  - POINTLM
  - PRIMARYROADS
  - PRISECROADS
  - PUMA
  - RAILS
  - ROADS
  - SCSD
  - SDADM
  - SLDL
  - SLDU
  - STATE
  - SUBBARRIO
  - TABBLOCK20
  - TBG
  - TRACT
  - TTRACT
  - UAC
  - UNSD
  - ZCTA520
Entity count: 44</code></pre>
</div>
</div>
<p>Let’s examine Census Tracts.</p>
<p>I’ll need some tooling to collect information on a given entity in a given TIGER vintage. I know this object will need data that’s in the relevant <code>TIGERVintageCatalog</code> instance, so I’ll make that an attribute of the entity vintage class. I could require that the use passes in a <code>TIGERVintageCatalog</code> instance (which would reduce the number of calls to the same Census resource in the usecase where a user is interactively working using these classes), but ultimately I’m going to build out pipelines that only collect one TIGER entity at a from a given vintage (as I don’t need most of the available entities listed above).</p>
<div class="cell" data-execution_count="36">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> TIGERGeographicEntityVintage:</span>
<span id="cb14-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, entity_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, year: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, catalog: Optional[TIGERCatalog] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>):</span>
<span id="cb14-3">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> entity_name</span>
<span id="cb14-4">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.year <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(year)</span>
<span id="cb14-5">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vintage_catalog <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TIGERVintageCatalog(year<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>year, catalog<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>catalog)</span>
<span id="cb14-6">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_metadata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vintage_catalog.get_entity_metadata(entity_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_name)</span>
<span id="cb14-7"></span>
<span id="cb14-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@property</span></span>
<span id="cb14-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> entity_url(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb14-10">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata_url"</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb14-11"></span>
<span id="cb14-12">tiger_tract22_obj <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TIGERGeographicEntityVintage(entity_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRACT"</span>, year<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022"</span>, catalog<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tiger_catalog)</span>
<span id="cb14-13">display(tiger_tract22_obj.entity_metadata)</span>
<span id="cb14-14">entity_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scrape_census_ftp_metadata_page(metadata_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tiger_tract22_obj.entity_url)</span>
<span id="cb14-15"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(entity_df.shape)</span>
<span id="cb14-16">display(entity_df.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">last_modified</th>
<th data-quarto-table-cell-role="th">size</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">is_dir</th>
<th data-quarto-table-cell-role="th">clean_name</th>
<th data-quarto-table-cell-role="th">is_file</th>
<th data-quarto-table-cell-role="th">metadata_url</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">41</td>
<td>TRACT/</td>
<td>2022-09-30 22:39:00</td>
<td>-</td>
<td></td>
<td>True</td>
<td>TRACT</td>
<td>False</td>
<td>https://www2.census.gov/geo/tiger/TIGER2022/TRACT</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>(56, 8)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">last_modified</th>
<th data-quarto-table-cell-role="th">size</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">is_dir</th>
<th data-quarto-table-cell-role="th">clean_name</th>
<th data-quarto-table-cell-role="th">is_file</th>
<th data-quarto-table-cell-role="th">metadata_url</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>tl_2022_01_tract.zip</td>
<td>2022-10-31 19:42:00</td>
<td>11M</td>
<td></td>
<td>False</td>
<td>tl_2022_01_tract.zip</td>
<td>True</td>
<td>https://www2.census.gov/geo/tiger/TIGER2022/TR...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>tl_2022_02_tract.zip</td>
<td>2022-10-31 19:42:00</td>
<td>3.0M</td>
<td></td>
<td>False</td>
<td>tl_2022_02_tract.zip</td>
<td>True</td>
<td>https://www2.census.gov/geo/tiger/TIGER2022/TR...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Looking at the names, I see that the Census groups tracts by state <strong>FIPS</strong> code (Federal Information Processing Series code). I know the FIPS code for Illinois is “17” (you can review the FIPS codes for other geographic entities <a href="https://www.census.gov/library/reference/code-lists/ansi.html">here</a>). I also know I don’t always want to pull data for all states, so I need to add a method that allows the user to filter the entity files. Also, I should build in the step of getting the entity files metadata.</p>
<div class="cell" data-execution_count="47">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> TIGERGeographicEntityVintage:</span>
<span id="cb16-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, entity_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, year: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, catalog: Optional[TIGERCatalog] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>):</span>
<span id="cb16-3">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> entity_name</span>
<span id="cb16-4">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.year <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(year)</span>
<span id="cb16-5">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vintage_catalog <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TIGERVintageCatalog(year<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>year, catalog<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>catalog)</span>
<span id="cb16-6">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_metadata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vintage_catalog.get_entity_metadata(entity_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_name)</span>
<span id="cb16-7"></span>
<span id="cb16-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@property</span></span>
<span id="cb16-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> entity_url(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb16-10">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata_url"</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb16-11"></span>
<span id="cb16-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@property</span></span>
<span id="cb16-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> entity_files_metadata(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb16-14">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> scrape_census_ftp_metadata_page(metadata_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_url)</span>
<span id="cb16-15"></span>
<span id="cb16-16">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_entity_file_metadata(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, filter_str: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb16-17">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_files_metadata.loc[<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.entity_files_metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(filter_str)].copy()</span>
<span id="cb16-18"></span>
<span id="cb16-19">tiger_tract22_obj <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TIGERGeographicEntityVintage(entity_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRACT"</span>, year<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022"</span>, catalog<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tiger_catalog)</span>
<span id="cb16-20">il_tracts22_metadata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tiger_tract22_obj.get_entity_file_metadata(filter_str<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_17_"</span>)</span>
<span id="cb16-21">display(il_tracts22_metadata)</span>
<span id="cb16-22"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"IL Tracts archive download Url: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>il_tracts22_metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata_url'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">last_modified</th>
<th data-quarto-table-cell-role="th">size</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">is_dir</th>
<th data-quarto-table-cell-role="th">clean_name</th>
<th data-quarto-table-cell-role="th">is_file</th>
<th data-quarto-table-cell-role="th">metadata_url</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>tl_2022_17_tract.zip</td>
<td>2022-10-31 19:43:00</td>
<td>9.5M</td>
<td></td>
<td>False</td>
<td>tl_2022_17_tract.zip</td>
<td>True</td>
<td>https://www2.census.gov/geo/tiger/TIGER2022/TR...</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>IL Tracts archive download Url: https://www2.census.gov/geo/tiger/TIGER2022/TRACT/tl_2022_17_tract.zip</code></pre>
</div>
</div>
<p>Geopandas provides some extremely convenient functionality for loading data. I can provide the URL to a zipped archive (of geospatial files) to <code>geopandas</code>’ <code>read_file()</code> function and it handles the network request and unzipping for me.</p>
<div class="cell" data-execution_count="48">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1">il_tracts_gdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gpd.read_file(il_tracts22_metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata_url"</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span></code></pre></div>
</details>
</div>
<div class="cell" data-execution_count="49">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(il_tracts_gdf.shape)</span>
<span id="cb19-2">il_tracts_gdf.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(3265, 13)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">STATEFP</th>
<th data-quarto-table-cell-role="th">COUNTYFP</th>
<th data-quarto-table-cell-role="th">TRACTCE</th>
<th data-quarto-table-cell-role="th">GEOID</th>
<th data-quarto-table-cell-role="th">NAME</th>
<th data-quarto-table-cell-role="th">NAMELSAD</th>
<th data-quarto-table-cell-role="th">MTFCC</th>
<th data-quarto-table-cell-role="th">FUNCSTAT</th>
<th data-quarto-table-cell-role="th">ALAND</th>
<th data-quarto-table-cell-role="th">AWATER</th>
<th data-quarto-table-cell-role="th">INTPTLAT</th>
<th data-quarto-table-cell-role="th">INTPTLON</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>17</td>
<td>019</td>
<td>010701</td>
<td>17019010701</td>
<td>107.01</td>
<td>Census Tract 107.01</td>
<td>G5020</td>
<td>S</td>
<td>5266000</td>
<td>30553</td>
<td>+40.1150269</td>
<td>-088.0329549</td>
<td>POLYGON ((-88.05240 40.11923, -88.05238 40.119...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>17</td>
<td>019</td>
<td>005902</td>
<td>17019005902</td>
<td>59.02</td>
<td>Census Tract 59.02</td>
<td>G5020</td>
<td>S</td>
<td>962402</td>
<td>4892</td>
<td>+40.1087344</td>
<td>-088.2247204</td>
<td>POLYGON ((-88.22891 40.11271, -88.22882 40.112...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>And now I have plottable, spatially-joinable geospatial data ready to ingest into a data warehouse table or to plot out.</p>
<div class="cell" data-execution_count="45">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1">fig_width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span></span>
<span id="cb21-2"></span>
<span id="cb21-3">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(fig_width, fig_width))</span>
<span id="cb21-4">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> il_tracts_gdf.plot(facecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>, edgecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.015</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> fig_width, ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="https://www.matttriano.dev/posts/004_census_tiger_dev/TIGER_data_collector_dev_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>



</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div> ]]></description>
  <guid>https://www.matttriano.dev/posts/004_census_tiger_dev/TIGER_data_collector_dev.html</guid>
  <pubDate>Wed, 14 Jun 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.matttriano.dev/posts/004_census_tiger_dev/Census_TIGER.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Working with Notebooks</title>
  <dc:creator>Matt Triano</dc:creator>
  <link>https://www.matttriano.dev/posts/002_notebook_test/jupyter_quarto.html</link>
  <description><![CDATA[ 




<div class="cell" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-3"></span>
<span id="cb1-4">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb1-5">theta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.pi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> r</span>
<span id="cb1-6">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(</span>
<span id="cb1-7">  subplot_kw <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'projection'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'polar'</span>} </span>
<span id="cb1-8">)</span>
<span id="cb1-9">ax.plot(theta, r)</span>
<span id="cb1-10">ax.set_rticks([<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb1-11">ax.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb1-12">plt.show()</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-polar" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://www.matttriano.dev/posts/002_notebook_test/jupyter_quarto_files/figure-html/fig-polar-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;1: A line plot on a polar axis</figcaption>
</figure>
</div>
</div>
</div>
<ol type="1">
<li><p>Develop a notebook</p></li>
<li><p>Render that notebook via</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">quarto_env</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user@hostname:~/...$</span> quarto render notebook_name.ipynb</span></code></pre></div></li>
<li><p>Preview your document via</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">quarto_env</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user@hostname:~/...$</span> quarto preview quarto_blog/</span></code></pre></div>
<p>Note: Make sure <code>draft: false</code> in your document, or it won’t render.</p></li>
</ol>




<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div> ]]></description>
  <guid>https://www.matttriano.dev/posts/002_notebook_test/jupyter_quarto.html</guid>
  <pubDate>Mon, 12 Jun 2023 00:00:00 GMT</pubDate>
  <media:content url="https://www.matttriano.dev/posts/002_notebook_test/studious_robot.png" medium="image" type="image/png" height="144" width="144"/>
</item>
</channel>
</rss>
