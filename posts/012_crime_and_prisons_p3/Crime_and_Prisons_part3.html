<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Matt Triano">
<meta name="dcterms.date" content="2018-06-28">
<meta name="description" content="Exploring prisoner data up through 2016">

<title>Matt Triano - Exploration in Criminal Justice and Corrections Data, Part 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Matt Triano</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/MattTriano"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Exploration in Criminal Justice and Corrections Data, Part 3</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
                  <div>
        <div class="description">
          Exploring prisoner data up through 2016
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">pandas</div>
                <div class="quarto-category">analysis</div>
                <div class="quarto-category">old</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Matt Triano </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 28, 2018</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">June 28, 2018</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#imprisonment-by-race" id="toc-imprisonment-by-race" class="nav-link active" data-scroll-target="#imprisonment-by-race"><span class="header-section-number">1</span> Imprisonment by Race</a>
  <ul class="collapse">
  <li><a href="#data-source" id="toc-data-source" class="nav-link" data-scroll-target="#data-source"><span class="header-section-number">1.1</span> Data Source</a>
  <ul class="collapse">
  <li><a href="#census-data" id="toc-census-data" class="nav-link" data-scroll-target="#census-data"><span class="header-section-number">1.1.1</span> Census Data</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div class="callout callout-style-simple callout-note callout-titled" title="Update Note">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Update Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The majority of code and analysis in this post was originally written back in mid-2018 (in <a href="https://github.com/MattTriano/personal_site_public/blob/master/Crime_and_Prisons_part3.ipynb">this notebook</a>). I’ve consolidated some cells, automated data retrieval, and added cell labels to make things render nicely, but otherwise I’ve left the work as-is. Compared to my current work products, this old code is very messy and unpolished, but like <a href="https://youtu.be/kETDOnnt5sc?t=530">Eric Ma</a> (creator of the <code>networkx</code> graph data analysis package), I believe in showing newer data analysts and scientists I mentor that no one in this field started off with mastery of git, pandas, bash, etc, and that everyone who lasts loves to keep learning and improving.</p>
<p>After I integrate these old posts into this blog, I’ll write an EDA post that starts from scratch using up-to-date data.</p>
</div>
</div>
</div>
<section id="imprisonment-by-race" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Imprisonment by Race</h1>
<p>This notebook explores the racial breakdown of the 3 largest racial groups in US prisons (from 2006 to 2016): non-Hispanic white people, non-Hispanic black people, and Hispanic people.</p>
<p>In this notebook, I show that, over the entire span of data (2006-2016), black people are the largest racial prison population both in raw numbers and as a proportion of the total same-race US population.</p>
<p><strong>Average Number of Prisoners (from 2006-2016)</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>Race</th>
<th style="text-align: center;">Average Number in Prison</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Black</td>
<td style="text-align: center;">551209</td>
</tr>
<tr class="even">
<td>White</td>
<td style="text-align: center;">476136</td>
</tr>
<tr class="odd">
<td>Hispanic</td>
<td style="text-align: center;">336500</td>
</tr>
</tbody>
</table>
<p><strong>Average Percent US Racial Population in Prison</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>Race</th>
<th style="text-align: left;">% of US Racial Pop. in Prison</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Black</td>
<td style="text-align: left;">1.440 %</td>
</tr>
<tr class="even">
<td>White</td>
<td style="text-align: left;">0.241 %</td>
</tr>
<tr class="odd">
<td>Hispanic</td>
<td style="text-align: left;">0.656 %</td>
</tr>
</tbody>
</table>
<p><strong>Change in Average Percent US Racial Population in Prison</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>Race</th>
<th style="text-align: left;">Change in % of US Racial Pop. in Prison</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Black</td>
<td style="text-align: left;">-0.406 %</td>
</tr>
<tr class="even">
<td>White</td>
<td style="text-align: left;">-0.035 %</td>
</tr>
<tr class="odd">
<td>Hispanic</td>
<td style="text-align: left;">-0.113 %</td>
</tr>
</tbody>
</table>
<p>That is a fairly astonishing. A randomly selected black person is (on average) nearly 6 times as likely to be in prison as a randomly selected white person. There is clearly a statistically significant difference between these rates, so there are clearly more questions to answer.</p>
<section id="data-source" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="data-source"><span class="header-section-number">1.1</span> Data Source</h2>
<p>This data is from file p16t03.csv of the Bureau of Justice Statistics <a href="https://www.bjs.gov/index.cfm?ty=pbse&amp;sid=40">Prisoner Series</a> data.</p>
<div id="cell-4" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Imports, styling, and path definitions</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> urllib.request <span class="im">import</span> urlretrieve</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.ticker <span class="im">as</span> ticker</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.core.display <span class="im">import</span> display, HTML</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing modules from a visualization package.</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># from bokeh.sampledata.us_states import data as states|</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bokeh.plotting <span class="im">import</span> figure, show, output_notebook</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bokeh.models <span class="im">import</span> HoverTool, ColumnDataSource</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bokeh.models <span class="im">import</span> LinearColorMapper, ColorBar, BasicTicker</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># styling</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>pd.options.display.max_columns <span class="op">=</span> <span class="va">None</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>display(HTML(<span class="st">"&lt;style&gt;.container { width:100% !important; }&lt;/style&gt;"</span>))</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.float_format'</span>,<span class="kw">lambda</span> x: <span class="st">'</span><span class="sc">%.3f</span><span class="st">'</span> <span class="op">%</span> x)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> <span class="dv">10</span>,<span class="dv">10</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>DATA_DIR_PATH <span class="op">=</span> os.path.join(<span class="st">".."</span>, <span class="st">"010_crime_and_prisons_p1"</span>, <span class="st">'data'</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>PRISON_DATA_DIR <span class="op">=</span> os.path.join(DATA_DIR_PATH, <span class="st">'prison'</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>POP_DATA_DIR <span class="op">=</span> os.path.join(DATA_DIR_PATH, <span class="st">"population"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<style>.container { width:100% !important; }</style>
</div>
</div>
<div id="cell-5" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Loading and preprocessing the t03 dataset, Counts by Gender, Race, and Jurisdiction</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>CSV_PATH <span class="op">=</span> os.path.join(PRISON_DATA_DIR, <span class="st">'p16t03.csv'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>race_sex_raw <span class="op">=</span> pd.read_csv(CSV_PATH, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                           encoding<span class="op">=</span><span class="st">'latin1'</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                           header<span class="op">=</span><span class="dv">11</span>, </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                           na_values<span class="op">=</span><span class="st">':'</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                           thousands<span class="op">=</span><span class="vs">r','</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>race_sex_raw.dropna(axis<span class="op">=</span><span class="dv">0</span>, thresh<span class="op">=</span><span class="dv">3</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>race_sex_raw.dropna(axis<span class="op">=</span><span class="dv">1</span>, thresh<span class="op">=</span><span class="dv">3</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>race_sex_raw.dropna(axis<span class="op">=</span><span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>fix <span class="op">=</span> <span class="kw">lambda</span> x: x.split(<span class="st">'/'</span>)[<span class="dv">0</span>]</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>race_sex_raw[<span class="st">'Year'</span>] <span class="op">=</span> race_sex_raw[<span class="st">'Year'</span>].<span class="bu">apply</span>(fix)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>race_sex_raw.columns <span class="op">=</span> [x.split(<span class="st">'/'</span>)[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> race_sex_raw.columns]</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>race_sex_raw.set_index(<span class="st">'Year'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>display(race_sex_raw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Total</th>
<th data-quarto-table-cell-role="th">Federal</th>
<th data-quarto-table-cell-role="th">State</th>
<th data-quarto-table-cell-role="th">Male</th>
<th data-quarto-table-cell-role="th">Female</th>
<th data-quarto-table-cell-role="th">White</th>
<th data-quarto-table-cell-role="th">Black</th>
<th data-quarto-table-cell-role="th">Hispanic</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2006</td>
<td>1504598.000</td>
<td>173533.000</td>
<td>1331065.000</td>
<td>1401261.000</td>
<td>103337.000</td>
<td>507100.000</td>
<td>590300.000</td>
<td>313600.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2007</td>
<td>1532851.000</td>
<td>179204.000</td>
<td>1353647.000</td>
<td>1427088.000</td>
<td>105763.000</td>
<td>499800.000</td>
<td>592900.000</td>
<td>330400.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2008</td>
<td>1547742.000</td>
<td>182333.000</td>
<td>1365409.000</td>
<td>1441384.000</td>
<td>106358.000</td>
<td>499900.000</td>
<td>592800.000</td>
<td>329800.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2009</td>
<td>1553574.000</td>
<td>187886.000</td>
<td>1365688.000</td>
<td>1448239.000</td>
<td>105335.000</td>
<td>490000.000</td>
<td>584800.000</td>
<td>341200.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2010</td>
<td>1552669.000</td>
<td>190641.000</td>
<td>1362028.000</td>
<td>1447766.000</td>
<td>104903.000</td>
<td>484400.000</td>
<td>572700.000</td>
<td>345800.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2011</td>
<td>1538847.000</td>
<td>197050.000</td>
<td>1341797.000</td>
<td>1435141.000</td>
<td>103706.000</td>
<td>474300.000</td>
<td>557100.000</td>
<td>347800.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2012</td>
<td>1512430.000</td>
<td>196574.000</td>
<td>1315856.000</td>
<td>1411076.000</td>
<td>101354.000</td>
<td>466600.000</td>
<td>537800.000</td>
<td>340300.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2013</td>
<td>1520403.000</td>
<td>195098.000</td>
<td>1325305.000</td>
<td>1416102.000</td>
<td>104301.000</td>
<td>463900.000</td>
<td>529900.000</td>
<td>341200.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2014</td>
<td>1507781.000</td>
<td>191374.000</td>
<td>1316407.000</td>
<td>1401685.000</td>
<td>106096.000</td>
<td>461500.000</td>
<td>518700.000</td>
<td>338900.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2015</td>
<td>1476847.000</td>
<td>178688.000</td>
<td>1298159.000</td>
<td>1371879.000</td>
<td>104968.000</td>
<td>450200.000</td>
<td>499400.000</td>
<td>333200.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2016</td>
<td>1458173.000</td>
<td>171482.000</td>
<td>1286691.000</td>
<td>1352684.000</td>
<td>105489.000</td>
<td>439800.000</td>
<td>486900.000</td>
<td>339300.000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="cell-6" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Mean annual inmate count by race</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Average number of </span><span class="sc">{:&gt;8s}</span><span class="st"> people in prison from 2006 to 2016: </span><span class="sc">{:6.0f}</span><span class="st">'</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>      .<span class="bu">format</span>(<span class="st">'black'</span>, race_sex_raw[<span class="st">'Black'</span>].mean()))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Average number of </span><span class="sc">{:&gt;8s}</span><span class="st"> people in prison from 2006 to 2016: </span><span class="sc">{:6.0f}</span><span class="st">'</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>      .<span class="bu">format</span>(<span class="st">'white'</span>, race_sex_raw[<span class="st">'White'</span>].mean()))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Average number of </span><span class="sc">{:&gt;8s}</span><span class="st"> people in prison from 2006 to 2016: </span><span class="sc">{:6.0f}</span><span class="st">'</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>      .<span class="bu">format</span>(<span class="st">'Hispanic'</span>, race_sex_raw[<span class="st">'Hispanic'</span>].mean()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Average number of    black people in prison from 2006 to 2016: 551209
Average number of    white people in prison from 2006 to 2016: 476136
Average number of Hispanic people in prison from 2006 to 2016: 336500</code></pre>
</div>
</div>
<div id="cell-7" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Plotting annual inmate counts by race</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> sns.axes_style(<span class="st">"whitegrid"</span>):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    ax.plot(race_sex_raw[<span class="st">'White'</span>])</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    ax.plot(race_sex_raw[<span class="st">'Black'</span>])</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    ax.plot(race_sex_raw[<span class="st">'Hispanic'</span>])</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'Total Imprisonment Counts by Race (table: p16t03)'</span>,fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Number of People imprisoned'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    ax.legend(fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim([<span class="dv">0</span>, <span class="fl">1.1</span><span class="op">*</span><span class="bu">max</span>([race_sex_raw[<span class="st">'White'</span>].<span class="bu">max</span>(), </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                             race_sex_raw[<span class="st">'Black'</span>].<span class="bu">max</span>(),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                             race_sex_raw[<span class="st">'Hispanic'</span>].<span class="bu">max</span>()])])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Crime_and_Prisons_part3_files/figure-html/cell-5-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Looking at this plot of total imprisonment counts, we see that: * At any given time, there are more non-Hispanic black people in prison than any other race. * At any given time, there are more non-Hispanic white people than Hispanic people in prison. * The numbers of imprisoned black people and white people decreased steadily from 2008 to 2016, while the number of imprisoned Hispanic people was been fairly flat over that time.</p>
<p>These numbers are raw counts, so they don’t account for the fact that the fact that these races make up different proportions of the entire US population. This motivates questions like:</p>
<ul>
<li>What percent of the population of each race is in prison?</li>
</ul>
<p>To answer that, I’ll have to find population data broken down by race.</p>
<section id="census-data" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="census-data"><span class="header-section-number">1.1.1</span> Census Data</h3>
<p>The Constitution requires that a full, national census is performed every 10 years that reaches every resident on American soil. This data is used to determine how much federal money is allocated to each district for things like schools, roadways, police, etc. and it determines how many congressional representatives will be allocated to each state. With the help of smaller surveys, the US Census bureau makes estimates of populations for the years between censuses.</p>
<p><a href="https://www2.census.gov/programs-surveys/popest/tables/2010-2016/state/asrh/">data source</a></p>
<div id="cell-10" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>(NEW CODE) automating data collection</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>zip_pop_file_path <span class="op">=</span> os.path.join(POP_DATA_DIR, <span class="st">"PEP_2016_PEPSR6H.zip"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://www2.census.gov/programs-surveys/popest/tables/2010-2016/state/asrh/PEP_2016_PEPSR6H.zip"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.isfile(zip_pop_file_path):</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    urlretrieve(url<span class="op">=</span>url, filename<span class="op">=</span>zip_pop_file_path)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> zipfile.ZipFile(zip_pop_file_path, <span class="st">'r'</span>) <span class="im">as</span> zf:</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        zf.extractall(POP_DATA_DIR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-11" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Loading, filtering, and preprocessing annual national pop. estimates by race and ethnicity</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>CSV_PATH <span class="op">=</span> os.path.join(POP_DATA_DIR, <span class="st">'PEP_2016_PEPSR6H_with_ann.csv'</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>race_pop <span class="op">=</span> pd.read_csv(CSV_PATH, header<span class="op">=</span>[<span class="dv">1</span>], encoding<span class="op">=</span><span class="st">'latin1'</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">Initial Data Format:'</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>display(race_pop.head(<span class="dv">3</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Only looking for national values</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>race_pop <span class="op">=</span> race_pop[race_pop[<span class="st">'Geography'</span>] <span class="op">==</span> <span class="st">'United States'</span>]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Eliminating the actual census values</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>race_pop <span class="op">=</span> race_pop[<span class="op">~</span>race_pop[<span class="st">'Year'</span>].<span class="bu">str</span>.contains(<span class="st">'April'</span>)]</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Eliminating aggregated rows</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>race_pop <span class="op">=</span> race_pop[race_pop[<span class="st">'Hispanic Origin'</span>] <span class="op">!=</span> <span class="st">'Total'</span>]</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># race_pop = race_pop[race_pop['Sex'] != 'Both Sexes']  # for later</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>race_pop <span class="op">=</span> race_pop[<span class="op">~</span>race_pop[<span class="st">'Sex'</span>].isin([<span class="st">'Male'</span>,<span class="st">'Female'</span>])]</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>drop_cols <span class="op">=</span> [<span class="st">'Id'</span>, <span class="st">'Id.1'</span>, <span class="st">'Id.2'</span>, <span class="st">'Id2'</span>, <span class="st">'Id.3'</span>, <span class="st">'Geography'</span>, <span class="st">'Sex'</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Race Alone - American Indian and Alaska Native'</span>, <span class="st">'Race Alone - Asian'</span>,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>             <span class="st">'Race Alone - Native Hawaiian and Other Pacific Islander'</span>]</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>race_pop.drop(drop_cols, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Reducing the size of long column names</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>col_map <span class="op">=</span> {<span class="st">'Race Alone - Black or African American'</span>:<span class="st">'black_only_pop'</span>,</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>           <span class="st">'Race Alone - White'</span>: <span class="st">'white_only_pop'</span>}</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>race_pop.rename(col_map, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n\n</span><span class="st">Data Format after Processing:'</span>)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>display(race_pop.head(<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Initial Data Format:


Data Format after Processing:</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Id</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Id.1</th>
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">Id.2</th>
<th data-quarto-table-cell-role="th">Hispanic Origin</th>
<th data-quarto-table-cell-role="th">Id.3</th>
<th data-quarto-table-cell-role="th">Id2</th>
<th data-quarto-table-cell-role="th">Geography</th>
<th data-quarto-table-cell-role="th">Total</th>
<th data-quarto-table-cell-role="th">Race Alone - White</th>
<th data-quarto-table-cell-role="th">Race Alone - Black or African American</th>
<th data-quarto-table-cell-role="th">Race Alone - American Indian and Alaska Native</th>
<th data-quarto-table-cell-role="th">Race Alone - Asian</th>
<th data-quarto-table-cell-role="th">Race Alone - Native Hawaiian and Other Pacific Islander</th>
<th data-quarto-table-cell-role="th">Two or More Races</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>cen42010</td>
<td>April 1, 2010 Census</td>
<td>female</td>
<td>Female</td>
<td>hisp</td>
<td>Hispanic</td>
<td>0100000US</td>
<td>nan</td>
<td>United States</td>
<td>24858794</td>
<td>21936806</td>
<td>1191984</td>
<td>702309</td>
<td>249346</td>
<td>85203</td>
<td>693146</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>cen42010</td>
<td>April 1, 2010 Census</td>
<td>female</td>
<td>Female</td>
<td>nhisp</td>
<td>Not Hispanic</td>
<td>0100000US</td>
<td>nan</td>
<td>United States</td>
<td>132105418</td>
<td>100301335</td>
<td>19853611</td>
<td>1147502</td>
<td>7691693</td>
<td>246518</td>
<td>2864759</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>cen42010</td>
<td>April 1, 2010 Census</td>
<td>female</td>
<td>Female</td>
<td>tothisp</td>
<td>Total</td>
<td>0100000US</td>
<td>nan</td>
<td>United States</td>
<td>156964212</td>
<td>122238141</td>
<td>21045595</td>
<td>1849811</td>
<td>7941039</td>
<td>331721</td>
<td>3557905</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Hispanic Origin</th>
<th data-quarto-table-cell-role="th">Total</th>
<th data-quarto-table-cell-role="th">white_only_pop</th>
<th data-quarto-table-cell-role="th">black_only_pop</th>
<th data-quarto-table-cell-role="th">Two or More Races</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>July 1, 2010</td>
<td>Hispanic</td>
<td>50754069</td>
<td>44855529</td>
<td>2343053</td>
<td>1392607</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>July 1, 2010</td>
<td>Not Hispanic</td>
<td>258594124</td>
<td>197394319</td>
<td>38015461</td>
<td>5647760</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">33</td>
<td>July 1, 2011</td>
<td>Hispanic</td>
<td>51906353</td>
<td>45841771</td>
<td>2410490</td>
<td>1445820</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Based on the aggregation of the data I pulled, there is a rather vague ‘Two or More Races’ column. The prisoner data I’ve been working with has not differentiated between multiracial people and single-race people, rather, the prison data only breaks races down to non-Hispanic white, non-Hispanic black, and Hispanic. It’s entirely possible for someone to be non-Hispanic, black, and multiracial, which would make it much more difficult and less accurate to use this population data with the prison data. Fortunately, however, the <a href="https://www.bjs.gov/content/pub/pdf/p16.pd">documentation for the prison data</a>] includes footnotes indicating the data for white and black prison populations excludes persons of two or more races, so, conveniently, I must also exclude it.</p>
<div id="cell-13" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Engineering counts for Hispanic origin (any race), Non Hispanic White only, and Non Hispanic Black only</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>race_pop.drop(<span class="st">'Two or More Races'</span>, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>hisp <span class="op">=</span> race_pop[race_pop[<span class="st">'Hispanic Origin'</span>] <span class="op">==</span> <span class="st">'Hispanic'</span>].copy()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>non_hisp <span class="op">=</span> race_pop[race_pop[<span class="st">'Hispanic Origin'</span>] <span class="op">!=</span> <span class="st">'Hispanic'</span>].copy()</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>non_hisp.drop([<span class="st">'Hispanic Origin'</span>, <span class="st">'Total'</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>hisp.drop([<span class="st">'white_only_pop'</span>,<span class="st">'black_only_pop'</span>, <span class="st">'Hispanic Origin'</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>hisp.rename({<span class="st">'Total'</span>:<span class="st">'Hispanic_pop'</span>}, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>us_race_pop <span class="op">=</span> hisp.merge(non_hisp, on<span class="op">=</span>[<span class="st">'Year'</span>])</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>fix_yr <span class="op">=</span> <span class="kw">lambda</span> x: x.split(<span class="st">' '</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>us_race_pop[<span class="st">'Year'</span>] <span class="op">=</span> us_race_pop[<span class="st">'Year'</span>].<span class="bu">apply</span>(fix_yr)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>us_race_pop.set_index(<span class="st">'Year'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>display(us_race_pop.head(<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Hispanic_pop</th>
<th data-quarto-table-cell-role="th">white_only_pop</th>
<th data-quarto-table-cell-role="th">black_only_pop</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2010</td>
<td>50754069</td>
<td>197394319</td>
<td>38015461</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2011</td>
<td>51906353</td>
<td>197519026</td>
<td>38393758</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2012</td>
<td>52993496</td>
<td>197701109</td>
<td>38776276</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>This provides population data from 2010 on, but not for the earlier years. To deal with earlier years, I need to handle another data set.</p>
<p><a href="https://www.census.gov/data/tables/time-series/demo/popest/intercensal-2000-2010-national.html">data source</a></p>
<div id="cell-15" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>(NEW CODE) automating data collection</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>pop_file_path <span class="op">=</span> os.path.join(POP_DATA_DIR, <span class="st">"us-est00int-02.xls"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://www2.census.gov/programs-surveys/popest/tables/2000-2010/intercensal/national/us-est00int-02.xls"</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.isfile(pop_file_path):</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    urlretrieve(url<span class="op">=</span>url, filename<span class="op">=</span>pop_file_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-16" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Loading, filtering, and preprocessing annual national pop. estimates by race and ethnicity</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>race_pop0010 <span class="op">=</span> pd.read_excel(pop_file_path, header<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">Initial Data Format:'</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>display(race_pop0010.head())</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>race_pop0010.dropna(axis<span class="op">=</span><span class="dv">0</span>, thresh<span class="op">=</span><span class="dv">6</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>race_pop0010.drop([<span class="dv">1</span>],axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>race_pop0010 <span class="op">=</span> race_pop0010.T</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>race_pop0010.iloc[<span class="dv">0</span>,<span class="dv">0</span>] <span class="op">=</span> <span class="st">'Year'</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>race_pop0010.columns <span class="op">=</span> race_pop0010.loc[<span class="dv">0</span>]</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>race_pop0010.drop(<span class="dv">0</span>, axis<span class="op">=</span><span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>race_pop0010.dropna(axis<span class="op">=</span><span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>race_pop0010[<span class="st">'Year'</span>] <span class="op">=</span> race_pop0010[<span class="st">'Year'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>race_pop0010[<span class="st">'Year'</span>] <span class="op">=</span> race_pop0010[<span class="st">'Year'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>race_pop0010.set_index(<span class="st">'Year'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Code to help drop columns I'm not interested in</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>drop_cols <span class="op">=</span> []</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>drop_stumps <span class="op">=</span> [<span class="st">'AIAN'</span>,<span class="st">'Asian'</span>,<span class="st">'NHPI'</span>, <span class="st">'One Race'</span>, <span class="st">'Two or'</span>]</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> race_pop0010.columns:</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">any</span>(x <span class="kw">in</span> col <span class="cf">for</span> x <span class="kw">in</span> drop_stumps):</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        drop_cols.append(col)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>race_pop0010.drop(drop_cols, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Code to facilitate merging this DataFrame with theother Population DataFrame</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>both0010 <span class="op">=</span> race_pop0010.iloc[:,<span class="dv">4</span>:<span class="dv">7</span>].copy()</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>name_map <span class="op">=</span> {<span class="st">'...White'</span>  : <span class="st">'white_only_pop'</span>,</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">'...Black'</span>  : <span class="st">'black_only_pop'</span>,</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.HISPANIC'</span> : <span class="st">'Hispanic_pop'</span>}</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>both0010.rename(name_map, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>both0010 <span class="op">=</span> both0010.astype(<span class="bu">int</span>)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>pop_span <span class="op">=</span> pd.concat([both0010, us_race_pop], join<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>race_sex_pop <span class="op">=</span> race_sex_raw.join(pop_span)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n\n</span><span class="st">Data Format after Processing:'</span>)</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>display(race_pop0010.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Initial Data Format:


Data Format after Processing:</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">10</th>
<th data-quarto-table-cell-role="th">11</th>
<th data-quarto-table-cell-role="th">12</th>
<th data-quarto-table-cell-role="th">13</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>table with row headers in column A and column ...</td>
<td>NaN</td>
<td>NaN</td>
<td>nan</td>
<td>nan</td>
<td>nan</td>
<td>nan</td>
<td>nan</td>
<td>nan</td>
<td>nan</td>
<td>nan</td>
<td>nan</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Table 2. Intercensal Estimates of the Resident...</td>
<td>NaN</td>
<td>NaN</td>
<td>nan</td>
<td>nan</td>
<td>nan</td>
<td>nan</td>
<td>nan</td>
<td>nan</td>
<td>nan</td>
<td>nan</td>
<td>nan</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Sex, Race, and Hispanic Origin</td>
<td>April 1, 20001</td>
<td>Intercensal Estimates (as of July 1)</td>
<td>nan</td>
<td>nan</td>
<td>nan</td>
<td>nan</td>
<td>nan</td>
<td>nan</td>
<td>nan</td>
<td>nan</td>
<td>nan</td>
<td>April 1, 20102</td>
<td>July 1, 20103</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>NaN</td>
<td>2000</td>
<td>2001.000</td>
<td>2002.000</td>
<td>2003.000</td>
<td>2004.000</td>
<td>2005.000</td>
<td>2006.000</td>
<td>2007.000</td>
<td>2008.000</td>
<td>2009.000</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>BOTH SEXES</td>
<td>281424600</td>
<td>282162411</td>
<td>284968955.000</td>
<td>287625193.000</td>
<td>290107933.000</td>
<td>292805298.000</td>
<td>295516599.000</td>
<td>298379912.000</td>
<td>301231207.000</td>
<td>304093966.000</td>
<td>306771529.000</td>
<td>308745538</td>
<td>309349689</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">BOTH SEXES</th>
<th data-quarto-table-cell-role="th">..White</th>
<th data-quarto-table-cell-role="th">..Black</th>
<th data-quarto-table-cell-role="th">.NOT HISPANIC</th>
<th data-quarto-table-cell-role="th">...White</th>
<th data-quarto-table-cell-role="th">...Black</th>
<th data-quarto-table-cell-role="th">.HISPANIC</th>
<th data-quarto-table-cell-role="th">...White</th>
<th data-quarto-table-cell-role="th">...Black</th>
<th data-quarto-table-cell-role="th">MALE</th>
<th data-quarto-table-cell-role="th">..White</th>
<th data-quarto-table-cell-role="th">..Black</th>
<th data-quarto-table-cell-role="th">.NOT HISPANIC</th>
<th data-quarto-table-cell-role="th">...White</th>
<th data-quarto-table-cell-role="th">...Black</th>
<th data-quarto-table-cell-role="th">.HISPANIC</th>
<th data-quarto-table-cell-role="th">...White</th>
<th data-quarto-table-cell-role="th">...Black</th>
<th data-quarto-table-cell-role="th">FEMALE</th>
<th data-quarto-table-cell-role="th">..White</th>
<th data-quarto-table-cell-role="th">..Black</th>
<th data-quarto-table-cell-role="th">.NOT HISPANIC</th>
<th data-quarto-table-cell-role="th">...White</th>
<th data-quarto-table-cell-role="th">...Black</th>
<th data-quarto-table-cell-role="th">.HISPANIC</th>
<th data-quarto-table-cell-role="th">...White</th>
<th data-quarto-table-cell-role="th">...Black</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2000</td>
<td>282162411</td>
<td>228530479</td>
<td>35814706</td>
<td>246500526</td>
<td>195701752</td>
<td>34405800</td>
<td>35661885</td>
<td>32828727</td>
<td>1408906</td>
<td>138443407</td>
<td>112710885</td>
<td>17027514</td>
<td>120101363</td>
<td>95778530</td>
<td>16340639</td>
<td>18342044</td>
<td>16932355</td>
<td>686875</td>
<td>143719004</td>
<td>115819594</td>
<td>18787192</td>
<td>126399163</td>
<td>99923222</td>
<td>18065161</td>
<td>17319841</td>
<td>15896372</td>
<td>722031</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2001</td>
<td>284968955.000</td>
<td>230049196.000</td>
<td>36263029.000</td>
<td>247824859.000</td>
<td>195974813.000</td>
<td>34780280.000</td>
<td>37144096.000</td>
<td>34074383.000</td>
<td>1482749.000</td>
<td>139891492.000</td>
<td>113534140.000</td>
<td>17249678.000</td>
<td>120806379.000</td>
<td>95977450.000</td>
<td>16526760.000</td>
<td>19085113.000</td>
<td>17556690.000</td>
<td>722918.000</td>
<td>145077463.000</td>
<td>116515056.000</td>
<td>19013351.000</td>
<td>127018480.000</td>
<td>99997363.000</td>
<td>18253520.000</td>
<td>18058983.000</td>
<td>16517693.000</td>
<td>759831.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002</td>
<td>287625193.000</td>
<td>231446915.000</td>
<td>36684650.000</td>
<td>249007573.000</td>
<td>196140540.000</td>
<td>35130061.000</td>
<td>38617620.000</td>
<td>35306375.000</td>
<td>1554589.000</td>
<td>141230559.000</td>
<td>114269447.000</td>
<td>17454795.000</td>
<td>121412514.000</td>
<td>96101267.000</td>
<td>16697032.000</td>
<td>19818045.000</td>
<td>18168180.000</td>
<td>757763.000</td>
<td>146394634.000</td>
<td>117177468.000</td>
<td>19229855.000</td>
<td>127595059.000</td>
<td>100039273.000</td>
<td>18433029.000</td>
<td>18799575.000</td>
<td>17138195.000</td>
<td>796826.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2003</td>
<td>290107933.000</td>
<td>232717191.000</td>
<td>37066096.000</td>
<td>250058504.000</td>
<td>196232760.000</td>
<td>35438251.000</td>
<td>40049429.000</td>
<td>36484431.000</td>
<td>1627845.000</td>
<td>142428897.000</td>
<td>114897973.000</td>
<td>17631747.000</td>
<td>121910556.000</td>
<td>96155748.000</td>
<td>16839027.000</td>
<td>20518341.000</td>
<td>18742225.000</td>
<td>792720.000</td>
<td>147679036.000</td>
<td>117819218.000</td>
<td>19434349.000</td>
<td>128147948.000</td>
<td>100077012.000</td>
<td>18599224.000</td>
<td>19531088.000</td>
<td>17742206.000</td>
<td>835125.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2004</td>
<td>292805298.000</td>
<td>234120447.000</td>
<td>37510582.000</td>
<td>251303923.000</td>
<td>196461761.000</td>
<td>35797599.000</td>
<td>41501375.000</td>
<td>37658686.000</td>
<td>1712983.000</td>
<td>143828012.000</td>
<td>115664854.000</td>
<td>17856753.000</td>
<td>122592198.000</td>
<td>96345151.000</td>
<td>17022156.000</td>
<td>21235814.000</td>
<td>19319703.000</td>
<td>834597.000</td>
<td>148977286.000</td>
<td>118455593.000</td>
<td>19653829.000</td>
<td>128711725.000</td>
<td>100116610.000</td>
<td>18775443.000</td>
<td>20265561.000</td>
<td>18338983.000</td>
<td>878386.000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Now that I’ve got a full population data set, I can normalize the prisoner data.</p>
<div id="cell-18" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Engineering percent of total group population incarcerated features</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>race_sex_pop.loc[:,<span class="st">'White_pct'</span>] <span class="op">=</span> race_sex_pop.loc[:,<span class="st">'White'</span>]<span class="op">\</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                .divide(race_sex_pop.loc[:,<span class="st">'white_only_pop'</span>]) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>race_sex_pop.loc[:,<span class="st">'Black_pct'</span>] <span class="op">=</span> race_sex_pop.loc[:,<span class="st">'Black'</span>]<span class="op">\</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                .divide(race_sex_pop.loc[:,<span class="st">'black_only_pop'</span>]) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>race_sex_pop.loc[:,<span class="st">'Hispanic_pct'</span>] <span class="op">=</span> race_sex_pop.loc[:,<span class="st">'Hispanic'</span>]<span class="op">\</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                .divide(race_sex_pop.loc[:,<span class="st">'Hispanic_pop'</span>]) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>display(race_sex_pop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Total</th>
<th data-quarto-table-cell-role="th">Federal</th>
<th data-quarto-table-cell-role="th">State</th>
<th data-quarto-table-cell-role="th">Male</th>
<th data-quarto-table-cell-role="th">Female</th>
<th data-quarto-table-cell-role="th">White</th>
<th data-quarto-table-cell-role="th">Black</th>
<th data-quarto-table-cell-role="th">Hispanic</th>
<th data-quarto-table-cell-role="th">white_only_pop</th>
<th data-quarto-table-cell-role="th">black_only_pop</th>
<th data-quarto-table-cell-role="th">Hispanic_pop</th>
<th data-quarto-table-cell-role="th">White_pct</th>
<th data-quarto-table-cell-role="th">Black_pct</th>
<th data-quarto-table-cell-role="th">Hispanic_pct</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2006</td>
<td>1504598.000</td>
<td>173533.000</td>
<td>1331065.000</td>
<td>1401261.000</td>
<td>103337.000</td>
<td>507100.000</td>
<td>590300.000</td>
<td>313600.000</td>
<td>196832697</td>
<td>36520961</td>
<td>44606305</td>
<td>0.258</td>
<td>1.616</td>
<td>0.703</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2007</td>
<td>1532851.000</td>
<td>179204.000</td>
<td>1353647.000</td>
<td>1427088.000</td>
<td>105763.000</td>
<td>499800.000</td>
<td>592900.000</td>
<td>330400.000</td>
<td>197011394</td>
<td>36905758</td>
<td>46196853</td>
<td>0.254</td>
<td>1.607</td>
<td>0.715</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2008</td>
<td>1547742.000</td>
<td>182333.000</td>
<td>1365409.000</td>
<td>1441384.000</td>
<td>106358.000</td>
<td>499900.000</td>
<td>592800.000</td>
<td>329800.000</td>
<td>197183535</td>
<td>37290709</td>
<td>47793785</td>
<td>0.254</td>
<td>1.590</td>
<td>0.690</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2009</td>
<td>1553574.000</td>
<td>187886.000</td>
<td>1365688.000</td>
<td>1448239.000</td>
<td>105335.000</td>
<td>490000.000</td>
<td>584800.000</td>
<td>341200.000</td>
<td>197274549</td>
<td>37656592</td>
<td>49327489</td>
<td>0.248</td>
<td>1.553</td>
<td>0.692</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2010</td>
<td>1552669.000</td>
<td>190641.000</td>
<td>1362028.000</td>
<td>1447766.000</td>
<td>104903.000</td>
<td>484400.000</td>
<td>572700.000</td>
<td>345800.000</td>
<td>197394319</td>
<td>38015461</td>
<td>50754069</td>
<td>0.245</td>
<td>1.506</td>
<td>0.681</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2011</td>
<td>1538847.000</td>
<td>197050.000</td>
<td>1341797.000</td>
<td>1435141.000</td>
<td>103706.000</td>
<td>474300.000</td>
<td>557100.000</td>
<td>347800.000</td>
<td>197519026</td>
<td>38393758</td>
<td>51906353</td>
<td>0.240</td>
<td>1.451</td>
<td>0.670</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2012</td>
<td>1512430.000</td>
<td>196574.000</td>
<td>1315856.000</td>
<td>1411076.000</td>
<td>101354.000</td>
<td>466600.000</td>
<td>537800.000</td>
<td>340300.000</td>
<td>197701109</td>
<td>38776276</td>
<td>52993496</td>
<td>0.236</td>
<td>1.387</td>
<td>0.642</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2013</td>
<td>1520403.000</td>
<td>195098.000</td>
<td>1325305.000</td>
<td>1416102.000</td>
<td>104301.000</td>
<td>463900.000</td>
<td>529900.000</td>
<td>341200.000</td>
<td>197777454</td>
<td>39135988</td>
<td>54064149</td>
<td>0.235</td>
<td>1.354</td>
<td>0.631</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2014</td>
<td>1507781.000</td>
<td>191374.000</td>
<td>1316407.000</td>
<td>1401685.000</td>
<td>106096.000</td>
<td>461500.000</td>
<td>518700.000</td>
<td>338900.000</td>
<td>197902336</td>
<td>39507913</td>
<td>55189962</td>
<td>0.233</td>
<td>1.313</td>
<td>0.614</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2015</td>
<td>1476847.000</td>
<td>178688.000</td>
<td>1298159.000</td>
<td>1371879.000</td>
<td>104968.000</td>
<td>450200.000</td>
<td>499400.000</td>
<td>333200.000</td>
<td>197964402</td>
<td>39876758</td>
<td>56338521</td>
<td>0.227</td>
<td>1.252</td>
<td>0.591</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2016</td>
<td>1458173.000</td>
<td>171482.000</td>
<td>1286691.000</td>
<td>1352684.000</td>
<td>105489.000</td>
<td>439800.000</td>
<td>486900.000</td>
<td>339300.000</td>
<td>197969608</td>
<td>40229236</td>
<td>57470287</td>
<td>0.222</td>
<td>1.210</td>
<td>0.590</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="cell-19" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Plotting percent of total group population incarcerated by year</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> sns.axes_style(<span class="st">"whitegrid"</span>):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    ax.plot(race_sex_pop[<span class="st">'White_pct'</span>])</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    ax.plot(race_sex_pop[<span class="st">'Black_pct'</span>])</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    ax.plot(race_sex_pop[<span class="st">'Hispanic_pct'</span>])</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'</span><span class="sc">% o</span><span class="st">f Total US Racial Population in Prison'</span>,fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Percent of Racial Population In Prison [%]'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    ax.legend(fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim([<span class="dv">0</span>, <span class="fl">1.1</span><span class="op">*</span><span class="bu">max</span>([race_sex_pop[<span class="st">'White_pct'</span>].<span class="bu">max</span>(), </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>                             race_sex_pop[<span class="st">'Black_pct'</span>].<span class="bu">max</span>(),</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>                             race_sex_pop[<span class="st">'Hispanic_pct'</span>].<span class="bu">max</span>()])])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Crime_and_Prisons_part3_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-20" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Descriptive stats for percent of group incarcerated</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Average percentage of total </span><span class="sc">{:&gt;8s}</span><span class="st"> population in prison: </span><span class="sc">{:0.3f}</span><span class="st">%'</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>      .<span class="bu">format</span>(<span class="st">'black'</span>, race_sex_pop[<span class="st">'Black_pct'</span>].mean()))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Average percentage of total </span><span class="sc">{:8s}</span><span class="st"> population in prison: </span><span class="sc">{:0.3f}</span><span class="st">%'</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>      .<span class="bu">format</span>(<span class="st">'Hispanic'</span>, race_sex_pop[<span class="st">'Hispanic_pct'</span>].mean()))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Average percentage of total </span><span class="sc">{:&gt;8s}</span><span class="st"> population in prison: </span><span class="sc">{:0.3f}</span><span class="st">%'</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>      .<span class="bu">format</span>(<span class="st">'white'</span>, race_sex_pop[<span class="st">'White_pct'</span>].mean()))</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Change in percentage of total </span><span class="sc">{:&gt;8s}</span><span class="st"> population in prison between 2006 to 2016: </span><span class="sc">{:0.3f}</span><span class="st">%'</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>      .<span class="bu">format</span>(<span class="st">'black'</span>, race_sex_pop[<span class="st">'Black_pct'</span>][<span class="st">'2016'</span>] <span class="op">-</span> race_sex_pop[<span class="st">'Black_pct'</span>][<span class="st">'2006'</span>]))</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Change in percentage of total </span><span class="sc">{:&gt;8s}</span><span class="st"> population in prison between 2006 to 2016: </span><span class="sc">{:0.3f}</span><span class="st">%'</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>      .<span class="bu">format</span>(<span class="st">'Hispanic'</span>, race_sex_pop[<span class="st">'Hispanic_pct'</span>][<span class="st">'2016'</span>] <span class="op">-</span> race_sex_pop[<span class="st">'Hispanic_pct'</span>][<span class="st">'2006'</span>]))</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Change in percentage of total </span><span class="sc">{:&gt;8s}</span><span class="st"> population in prison between 2006 to 2016: </span><span class="sc">{:0.3f}</span><span class="st">%'</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>      .<span class="bu">format</span>(<span class="st">'white'</span>, race_sex_pop[<span class="st">'White_pct'</span>][<span class="st">'2016'</span>] <span class="op">-</span> race_sex_pop[<span class="st">'White_pct'</span>][<span class="st">'2006'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Average percentage of total    black population in prison: 1.440%
Average percentage of total Hispanic population in prison: 0.656%
Average percentage of total    white population in prison: 0.241%
Change in percentage of total    black population in prison between 2006 to 2016: -0.406%
Change in percentage of total Hispanic population in prison between 2006 to 2016: -0.113%
Change in percentage of total    white population in prison between 2006 to 2016: -0.035%</code></pre>
</div>
</div>
<p>That’s an extremely large difference. A randomly selected black person is nearly 6 times more likely to be in prison than a randomly selected white person and more than twice as likely as a randomly selected Hispanic person.</p>
<p>That motivates the question: Why is there such a large difference between these populations?</p>
<p>To investigate that question, it would be useful to investigate other questions, such as: * Does the criminal justice system treat different racial groups differently? * Is the average quality of education comparable for different racial populations? * Is the distribution of quality of education comparable for different racial populations? * Is the average quality of employment opportunity comparable for different racial populations? * Is the distribution of quality of employment opportunities comparable for different racial populations? * Is there a causal relationship between the pervasive housing segregation across the US and these disparities? * What drove the significant reduction in the incarcerated proportion of black Americans from 2006-2016?</p>
<p>To Be Continued?</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.matttriano\.dev");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>