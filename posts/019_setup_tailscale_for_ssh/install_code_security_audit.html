<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Matt Triano">
<meta name="dcterms.date" content="2025-01-29">
<meta name="description" content="Reading through the Tailscale install script">

<title>Tailscale Installation Script Security Audits – Matt Triano</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ea72dc5fed832574809a9c94082fbbb.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-577d00769484caf683549b83995c8fa2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Matt Triano</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/MattTriano"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Tailscale Installation Script Security Audits</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
                  <div>
        <div class="description">
          Reading through the Tailscale install script
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">tailscale</div>
                <div class="quarto-category">security</div>
                <div class="quarto-category">bash</div>
                <div class="quarto-category">code audit</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Matt Triano </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 29, 2025</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">January 29, 2025</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#tailscale-installation-script-security-audits" id="toc-tailscale-installation-script-security-audits" class="nav-link active" data-scroll-target="#tailscale-installation-script-security-audits">Tailscale Installation Script Security Audits</a>
  <ul class="collapse">
  <li><a href="#tailscale-client-installation-on-a-ubuntudebian-linux-machine" id="toc-tailscale-client-installation-on-a-ubuntudebian-linux-machine" class="nav-link" data-scroll-target="#tailscale-client-installation-on-a-ubuntudebian-linux-machine">Tailscale Client Installation on a Ubuntu/Debian Linux Machine</a></li>
  <li><a href="#internet-access-check" id="toc-internet-access-check" class="nav-link" data-scroll-target="#internet-access-check">Internet access check</a></li>
  <li><a href="#os_unsupported-check" id="toc-os_unsupported-check" class="nav-link" data-scroll-target="#os_unsupported-check">OS_UNSUPPORTED check</a></li>
  <li><a href="#root-privilege-detection" id="toc-root-privilege-detection" class="nav-link" data-scroll-target="#root-privilege-detection">Root-privilege detection</a></li>
  <li><a href="#running-the-installation" id="toc-running-the-installation" class="nav-link" data-scroll-target="#running-the-installation">Running the installation</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="tailscale-installation-script-security-audits" class="level1">
<h1>Tailscale Installation Script Security Audits</h1>
<p>The corresponding notebook/post includes directions to download and run installation scripts, but I’m always a little wary of running shell scripts I haven’t looked over, even if they’re from a reliable-seeming source. So I’ll scan over install scripts</p>
<section id="tailscale-client-installation-on-a-ubuntudebian-linux-machine" class="level3 linux_install">
<h3 class="linux_install anchored" data-anchor-id="tailscale-client-installation-on-a-ubuntudebian-linux-machine">Tailscale Client Installation on a Ubuntu/Debian Linux Machine</h3>
<pre class="console"><code>curl -fsSL https://tailscale.com/install.sh | sh</code></pre>
<div id="a03d1a6c-074d-40f7-b04b-491bcb8acd22" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>imports</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display, HTML</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="0bad064f-1f89-4e65-a5dc-92cb9538c1e4" class="cell" data-scrolled="true" data-execution_count="2">
<details open="" class="code-fold">
<summary>Getting the install script</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://tailscale.com/install.sh"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>resp <span class="op">=</span> requests.get(url)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>resp.raise_for_status()</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>linux_script_lines <span class="op">=</span> resp.text</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>lines_in_script <span class="op">=</span> <span class="bu">len</span>(linux_script_lines.split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Lines in install script: </span><span class="sc">{</span>lines_in_script<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Lines in install script: 626</code></pre>
</div>
</div>
<p>The install script defines and invokes one function, <code>main()</code>.</p>
<p>The <code>main()</code> function starts off by defining variables for the invoking-machine’s: * OS, * OS version, * OS package manager type, * package signing key type (for distros using the <code>apt</code> package manager, e.g.&nbsp;Debian/Ubuntu; options: “legacy” or “keyring”), * a boolean flag so that <code>systemctl</code> commands can be run to enable tailscale to start on boot (only necessary on the Kali linux distro), and * a <code>TRACK</code> variable that only accepts values “stable” or “unstable” (it defaults to “stable” if there’s not already a <code>TRACK</code> env-var set, so I assume this is just to make it more ergonomic for devs to install nightly releases).</p>
<p>The first four are assigned empty-string placeholder values.</p>
<div id="8cda5aa8-096f-4b0b-a5c9-43b80d553fb6" class="cell" data-execution_count="3">
<details open="" class="code-fold">
<summary>The install script’s preamble</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(linux_script_lines.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)[<span class="dv">12</span>:<span class="dv">36</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>main() {
    # Step 1: detect the current linux distro, version, and packaging system.
    #
    # We rely on a combination of 'uname' and /etc/os-release to find
    # an OS name and version, and from there work out what
    # installation method we should be using.
    #
    # The end result of this step is that the following three
    # variables are populated, if detection was successful.
    OS=""
    VERSION=""
    PACKAGETYPE=""
    APT_KEY_TYPE="" # Only for apt-based distros
    APT_SYSTEMCTL_START=false # Only needs to be true for Kali
    TRACK="${TRACK:-stable}"

    case "$TRACK" in
        stable|unstable)
            ;;
        *)
            echo "unsupported track $TRACK"
            exit 1
            ;;
    esac</code></pre>
</div>
</div>
<p>The next block of code checks the invoking-machine for an <code>/etc/os-release</code> file, and if present, it “runs” the file, adding all of the file’s variables to the shell’s present context and updates the above placeholder variables based on the OS indicated by the file’s <code>ID</code> variable.</p>
<p>If no `/etc/os-release is found, this block is skipped.</p>
<p><span class="math display">\[
f_{\text{OS}}(\text{ID}) =
\begin{cases}
\text{Ubuntu, if ID} \in \{\text{ubuntu, pop, neon, zorin, tuxedo, elementary, galliumos} \} \\
\text{Ubuntu, if ID} = \text{linuxmint } \&amp; \text{ } [\text{UBUNTU\_CODENAME} \neq \text{""} \lor \text{ DEBIAN\_CODENAME} = \text{""}] \\
\text{Ubuntu, if ID} = \text{pika } \&amp; \text{ VERSION\_ID} \lt 4 \\
\text{Debian, if ID} \in \{\text{debian, parrot, mendel, pureos, kaisen, kali, Deepin, deepin, osmc} \} \\
\text{Debian, if ID} = \text{linuxmint } \&amp; \text{ DEBIAN\_CODENAME} \neq \text{""} \\
\text{Debian, if ID} = \text{pika } \&amp; \text{ VERSION\_ID} \geq 4 \\
\text{Raspbian, if ID} \in \{\text{raspbian} \} \\
\text{CentOS, if ID} \in \{\text{centos} \} \\
\text{Oracle, if ID} \in \{\text{ol} \} \\
\text{Red Hat, if ID} \in \{\text{rhel} \} \\
\text{Fedora, if ID} \in \{\text{fedora, rocky, almalinux, nobara, openmandriva, sangoma, risios, cloudlinux, alinux, fedora-asahi-remix} \} \\
\text{Amazon-Linux, if ID} \in \{\text{amzn} \} \\
\text{CentOS, if ID} \in \{\text{xenenterprise} \} \\
\text{OpenSUSE, if ID} \in \{\text{opensuse-leap, sles, opensuse-tumbleweed, sle-micro-rancher} \} \\
\text{Arch, if ID} \in \{\text{arch, archarm, endeavouros, blendos, garuda, archcraft, cachyos} \} \\
\text{Manjaro, if ID} \in \{\text{manjaro, manjaro-arm} \} \\
\text{Alpine, if ID} \in \{\text{alpine, postmarketos} \} \\
\text{Void, if ID} \in \{\text{void} \} \\
\text{Gentoo, if ID} \in \{\text{gentoo} \} \\
\text{FreeBSD, if ID} \in \{\text{freebsd} \} \\
\text{Photon, if ID} \in \{\text{photon} \} \\
\end{cases}
\]</span></p>
<p>If <span class="math inline">\(\text{ID} = \text{nixos}\)</span>, it prints a message directing the user to manually add Tailscale to their <code>NixOS</code> config and terminates the script early.</p>
<p><span class="math display">\[
f_{\text{PACKAGETYPE}}(\text{OS, ID}) =
\begin{cases}
\text{apt, if OS} \in \{ \text{Ubuntu, Debian} \} \\
\text{dnf, if OS} \in \{ \text{Fedora} \} \\
\text{dnf, if OS} \in \{ \text{CentOS, Oracle, Red Hat} \} \text{ } \&amp; \text{ } [\lfloor \text{VERSION\_ID} \rfloor \neq 7] \text{ } \&amp; \text{ ID} \neq \text{xenenterprise} \\
\text{yum, if OS} \in \{ \text{CentOS, Oracle, Red Hat} \} \text{ } \&amp; \lfloor \text{VERSION\_ID} \rfloor = 7] \\
\text{yum, if OS} \in \{ \text{Amazon-Linux} \} \lor \text{ID} = \text{xenenterprise} \\
\text{yum, if OS} \in \{ \text{OpenSUSE} \} \\
\text{pacman, if OS} \in \{ \text{Arch, Manjaro} \} \\
\text{apk, if OS} \in \{ \text{Alpine} \} \\
\text{xbps, if OS} \in \{ \text{Void} \} \\
\text{emerge, if OS} \in \{ \text{Gentoo} \} \\
\text{pkg, if OS} \in \{ \text{FreeBSD} \} \\
\text{tdnf, if OS} \in \{ \text{Photon} \} \\
\end{cases}
\]</span></p>
<p>It also unpacks <code>VERSION_ID</code>s and sets the <code>APT_KEY_TYPE</code> for Ubuntu/Debian based distros. I’ll use python for representing the <code>APT_KEY_TYPE</code> logic; <span class="math inline">\(\LaTeX\)</span> is rather cumbersome and not as pretty as I used to believe.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>APT_KEY_TYPE <span class="op">=</span> <span class="st">"keyring"</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    (ID <span class="kw">in</span> [<span class="st">"ubuntu"</span>, <span class="st">"pop"</span>, <span class="st">"neon"</span>, <span class="st">"zorin"</span>, <span class="st">"tuxedo"</span>] <span class="kw">and</span> <span class="kw">not</span> <span class="bu">str</span>(VERSION_ID).startswith(<span class="st">"2"</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">or</span> (ID <span class="kw">in</span> [<span class="st">"debian"</span>, <span class="st">"raspbian"</span>] <span class="kw">and</span> VERSION_ID <span class="op">&lt;</span> <span class="dv">11</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">or</span> (ID <span class="kw">in</span> [<span class="st">"linuxmint"</span>, <span class="st">"parrot"</span>, <span class="st">"mendel"</span>] <span class="kw">and</span> VERSION_ID <span class="op">&lt;</span> <span class="dv">5</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">or</span> (ID <span class="kw">in</span> [<span class="st">"elementary"</span>] <span class="kw">and</span> VERSION_ID <span class="op">&lt;</span> <span class="dv">6</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">or</span> (ID <span class="kw">in</span> [<span class="st">"kali"</span>] <span class="kw">and</span> <span class="bu">int</span>(<span class="bu">str</span>(VERSION_ID)[<span class="dv">0</span>:<span class="dv">4</span>]) <span class="op">&lt;</span> <span class="dv">2021</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">or</span> (ID <span class="kw">in</span> [<span class="st">"Deepin"</span>, <span class="st">"deepin"</span>] <span class="kw">and</span> VERSION_ID <span class="op">&lt;</span> <span class="dv">20</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">or</span> (ID <span class="kw">in</span> [<span class="st">"galliumos"</span>])</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    APT_KEY_TYPE <span class="op">=</span> <span class="st">"legacy"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Ignoring the wild variety of Linux distros, everything so far seems straightforward.</p>
<div id="9438c69e-3c6d-4388-b590-56d7dbe6153c" class="cell" data-scrolled="true" data-execution_count="4">
<details open="" class="code-fold">
<summary>Showing my /etc/os-release file’s contents</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cat <span class="op">/</span>etc<span class="op">/</span>os<span class="op">-</span>release</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>PRETTY_NAME="Ubuntu 22.04.5 LTS"
NAME="Ubuntu"
VERSION_ID="22.04"
VERSION="22.04.5 LTS (Jammy Jellyfish)"
VERSION_CODENAME=jammy
ID=ubuntu
ID_LIKE=debian
HOME_URL="https://www.ubuntu.com/"
SUPPORT_URL="https://help.ubuntu.com/"
BUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"
PRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"
UBUNTU_CODENAME=jammy</code></pre>
</div>
</div>
<div id="84422ca0-2626-4e89-b999-bc3919a29f1c" class="cell" data-execution_count="5">
<details open="" class="code-fold">
<summary>The /etc/os-release parsing conditional block</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(linux_script_lines.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)[<span class="dv">37</span>:<span class="dv">304</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    if [ -f /etc/os-release ]; then
        # /etc/os-release populates a number of shell variables. We care about the following:
        #  - ID: the short name of the OS (e.g. "debian", "freebsd")
        #  - VERSION_ID: the numeric release version for the OS, if any (e.g. "18.04")
        #  - VERSION_CODENAME: the codename of the OS release, if any (e.g. "buster")
        #  - UBUNTU_CODENAME: if it exists, use instead of VERSION_CODENAME
        . /etc/os-release
        case "$ID" in
            ubuntu|pop|neon|zorin|tuxedo)
                OS="ubuntu"
                if [ "${UBUNTU_CODENAME:-}" != "" ]; then
                    VERSION="$UBUNTU_CODENAME"
                else
                    VERSION="$VERSION_CODENAME"
                fi
                PACKAGETYPE="apt"
                # Third-party keyrings became the preferred method of
                # installation in Ubuntu 20.04.
                if expr "$VERSION_ID" : "2.*" &gt;/dev/null; then
                    APT_KEY_TYPE="keyring"
                else
                    APT_KEY_TYPE="legacy"
                fi
                ;;
            debian)
                OS="$ID"
                VERSION="$VERSION_CODENAME"
                PACKAGETYPE="apt"
                # Third-party keyrings became the preferred method of
                # installation in Debian 11 (Bullseye).
                if [ -z "${VERSION_ID:-}" ]; then
                    # rolling release. If you haven't kept current, that's on you.
                    APT_KEY_TYPE="keyring"
                # Parrot Security is a special case that uses ID=debian
                elif [ "$NAME" = "Parrot Security" ]; then
                    # All versions new enough to have this behaviour prefer keyring
                    # and their VERSION_ID is not consistent with Debian.
                    APT_KEY_TYPE="keyring"
                    # They don't specify the Debian version they're based off in os-release
                    # but Parrot 6 is based on Debian 12 Bookworm.
                    VERSION=bookworm
                elif [ "$VERSION_ID" -lt 11 ]; then
                    APT_KEY_TYPE="legacy"
                else
                    APT_KEY_TYPE="keyring"
                fi
                ;;
            linuxmint)
                if [ "${UBUNTU_CODENAME:-}" != "" ]; then
                    OS="ubuntu"
                    VERSION="$UBUNTU_CODENAME"
                elif [ "${DEBIAN_CODENAME:-}" != "" ]; then
                    OS="debian"
                    VERSION="$DEBIAN_CODENAME"
                else
                    OS="ubuntu"
                    VERSION="$VERSION_CODENAME"
                fi
                PACKAGETYPE="apt"
                if [ "$VERSION_ID" -lt 5 ]; then
                    APT_KEY_TYPE="legacy"
                else
                    APT_KEY_TYPE="keyring"
                fi
                ;;
            elementary)
                OS="ubuntu"
                VERSION="$UBUNTU_CODENAME"
                PACKAGETYPE="apt"
                if [ "$VERSION_ID" -lt 6 ]; then
                    APT_KEY_TYPE="legacy"
                else
                    APT_KEY_TYPE="keyring"
                fi
                ;;
            parrot|mendel)
                OS="debian"
                PACKAGETYPE="apt"
                if [ "$VERSION_ID" -lt 5 ]; then
                    VERSION="buster"
                    APT_KEY_TYPE="legacy"
                else
                    VERSION="bullseye"
                    APT_KEY_TYPE="keyring"
                fi
                ;;
            galliumos)
                OS="ubuntu"
                PACKAGETYPE="apt"
                VERSION="bionic"
                APT_KEY_TYPE="legacy"
                ;;
            pureos|kaisen)
                OS="debian"
                PACKAGETYPE="apt"
                VERSION="bullseye"
                APT_KEY_TYPE="keyring"
                ;;
            raspbian)
                OS="$ID"
                VERSION="$VERSION_CODENAME"
                PACKAGETYPE="apt"
                # Third-party keyrings became the preferred method of
                # installation in Raspbian 11 (Bullseye).
                if [ "$VERSION_ID" -lt 11 ]; then
                    APT_KEY_TYPE="legacy"
                else
                    APT_KEY_TYPE="keyring"
                fi
                ;;
            kali)
                OS="debian"
                PACKAGETYPE="apt"
                YEAR="$(echo "$VERSION_ID" | cut -f1 -d.)"
                APT_SYSTEMCTL_START=true
                # Third-party keyrings became the preferred method of
                # installation in Debian 11 (Bullseye), which Kali switched
                # to in roughly 2021.x releases
                if [ "$YEAR" -lt 2021 ]; then
                    # Kali VERSION_ID is "kali-rolling", which isn't distinguishing
                    VERSION="buster"
                    APT_KEY_TYPE="legacy"
                else
                    VERSION="bullseye"
                    APT_KEY_TYPE="keyring"
                fi
                ;;
            Deepin|deepin)  # https://github.com/tailscale/tailscale/issues/7862
                OS="debian"
                PACKAGETYPE="apt"
                if [ "$VERSION_ID" -lt 20 ]; then
                    APT_KEY_TYPE="legacy"
                    VERSION="buster"
                else
                    APT_KEY_TYPE="keyring"
                    VERSION="bullseye"
                fi
                ;;
            pika)
                PACKAGETYPE="apt"
                # All versions of PikaOS are new enough to prefer keyring
                APT_KEY_TYPE="keyring"
                # Older versions of PikaOS are based on Ubuntu rather than Debian
                if [ "$VERSION_ID" -lt 4 ]; then
                    OS="ubuntu"
                    VERSION="$UBUNTU_CODENAME"
                else
                    OS="debian"
                    VERSION="$DEBIAN_CODENAME"
                fi
                ;;
            centos)
                OS="$ID"
                VERSION="$VERSION_ID"
                PACKAGETYPE="dnf"
                if [ "$VERSION" = "7" ]; then
                    PACKAGETYPE="yum"
                fi
                ;;
            ol)
                OS="oracle"
                VERSION="$(echo "$VERSION_ID" | cut -f1 -d.)"
                PACKAGETYPE="dnf"
                if [ "$VERSION" = "7" ]; then
                    PACKAGETYPE="yum"
                fi
                ;;
            rhel)
                OS="$ID"
                VERSION="$(echo "$VERSION_ID" | cut -f1 -d.)"
                PACKAGETYPE="dnf"
                if [ "$VERSION" = "7" ]; then
                    PACKAGETYPE="yum"
                fi
                ;;
            fedora)
                OS="$ID"
                VERSION=""
                PACKAGETYPE="dnf"
                ;;
            rocky|almalinux|nobara|openmandriva|sangoma|risios|cloudlinux|alinux|fedora-asahi-remix)
                OS="fedora"
                VERSION=""
                PACKAGETYPE="dnf"
                ;;
            amzn)
                OS="amazon-linux"
                VERSION="$VERSION_ID"
                PACKAGETYPE="yum"
                ;;
            xenenterprise)
                OS="centos"
                VERSION="$(echo "$VERSION_ID" | cut -f1 -d.)"
                PACKAGETYPE="yum"
                ;;
            opensuse-leap|sles)
                OS="opensuse"
                VERSION="leap/$VERSION_ID"
                PACKAGETYPE="zypper"
                ;;
            opensuse-tumbleweed)
                OS="opensuse"
                VERSION="tumbleweed"
                PACKAGETYPE="zypper"
                ;;
            sle-micro-rancher)
                OS="opensuse"
                VERSION="leap/15.4"
                PACKAGETYPE="zypper"
                ;;
            arch|archarm|endeavouros|blendos|garuda|archcraft|cachyos)
                OS="arch"
                VERSION="" # rolling release
                PACKAGETYPE="pacman"
                ;;
            manjaro|manjaro-arm)
                OS="manjaro"
                VERSION="" # rolling release
                PACKAGETYPE="pacman"
                ;;
            alpine)
                OS="$ID"
                VERSION="$VERSION_ID"
                PACKAGETYPE="apk"
                ;;
            postmarketos)
                OS="alpine"
                VERSION="$VERSION_ID"
                PACKAGETYPE="apk"
                ;;
            nixos)
                echo "Please add Tailscale to your NixOS configuration directly:"
                echo
                echo "services.tailscale.enable = true;"
                exit 1
                ;;
            void)
                OS="$ID"
                VERSION="" # rolling release
                PACKAGETYPE="xbps"
                ;;
            gentoo)
                OS="$ID"
                VERSION="" # rolling release
                PACKAGETYPE="emerge"
                ;;
            freebsd)
                OS="$ID"
                VERSION="$(echo "$VERSION_ID" | cut -f1 -d.)"
                PACKAGETYPE="pkg"
                ;;
            osmc)
                OS="debian"
                PACKAGETYPE="apt"
                VERSION="bullseye"
                APT_KEY_TYPE="keyring"
                ;;
            photon)
                OS="photon"
                VERSION="$(echo "$VERSION_ID" | cut -f1 -d.)"
                PACKAGETYPE="tdnf"
                ;;

            # TODO: wsl?
            # TODO: synology? qnap?
        esac
    fi</code></pre>
</div>
</div>
<p>If there wasn’t a <code>/etc/os-release</code> file and the conditional block above was skipped, the <code>OS</code> variable will be empty and the shell will enter this block (unless the running context’s <code>env</code>ironment already set an <code>OS</code> variable).</p>
<p>In the block, it checks if the invoking-shell has a command named <code>uname</code> (ie checking if the invoking-machine is running Linux/Unix or if it’s a Windows machine), and sets the <code>OS</code>, <code>VERSION</code>, and <code>PACKAGETYPE</code> variables based on the string <code>uname</code> returns.</p>
<p>Straightforward.</p>
<div id="5030c97c-d57b-42d4-9436-f654e004a9af" class="cell" data-execution_count="6">
<details open="" class="code-fold">
<summary>Showing the output of the uname command</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>uname</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Linux</code></pre>
</div>
</div>
<div id="679ec320-636d-453a-a708-bd804b55c46e" class="cell" data-execution_count="7">
<details open="" class="code-fold">
<summary>Showing the location of the <code>uname</code> program</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span><span class="bu">type</span> uname</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>uname is /usr/bin/uname</code></pre>
</div>
</div>
<div id="de68f6ef-1289-42b5-83f8-ac78d744f97e" class="cell" data-execution_count="8">
<details open="" class="code-fold">
<summary>The conditional block that determines OS when /etc/os-release doesn’t exist</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(linux_script_lines.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)[<span class="dv">305</span>:<span class="dv">336</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    # If we failed to detect something through os-release, consult
    # uname and try to infer things from that.
    if [ -z "$OS" ]; then
        if type uname &gt;/dev/null 2&gt;&amp;1; then
            case "$(uname)" in
                FreeBSD)
                    # FreeBSD before 12.2 doesn't have
                    # /etc/os-release, so we wouldn't have found it in
                    # the os-release probing above.
                    OS="freebsd"
                    VERSION="$(freebsd-version | cut -f1 -d.)"
                    PACKAGETYPE="pkg"
                    ;;
                OpenBSD)
                    OS="openbsd"
                    VERSION="$(uname -r)"
                    PACKAGETYPE=""
                    ;;
                Darwin)
                    OS="macos"
                    VERSION="$(sw_vers -productVersion | cut -f1-2 -d.)"
                    PACKAGETYPE="appstore"
                    ;;
                Linux)
                    OS="other-linux"
                    VERSION=""
                    PACKAGETYPE=""
                    ;;
            esac
        fi
    fi</code></pre>
</div>
</div>
</section>
<section id="internet-access-check" class="level2">
<h2 class="anchored" data-anchor-id="internet-access-check">Internet access check</h2>
<p>This block determines whether <code>curl</code> or <code>wget</code> are available on the invoking-machine, configures the prefix of web-request-making commands (in the <code>CURL</code> variable) based on whether the system has <code>curl</code> or not, and then uses that web-request tool to check a test URL, pkgs.tailscale.com, to make sure that the machine has access to the internet. If the test fails, the output of <code>$($CURL "$TEST_URL" 2&gt;&amp;1)</code> gets saved to the <code>RC</code> variable and an error message is displayed.</p>
<div id="8fcadf69-d784-47f8-9e2e-a665b2057c1d" class="cell" data-execution_count="9">
<details open="" class="code-fold">
<summary>The code block that checks if the running machine can access the internet</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(linux_script_lines.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)[<span class="dv">337</span>:<span class="dv">361</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    # Ideally we want to use curl, but on some installs we
    # only have wget. Detect and use what's available.
    CURL=
    if type curl &gt;/dev/null; then
        CURL="curl -fsSL"
    elif type wget &gt;/dev/null; then
        CURL="wget -q -O-"
    fi
    if [ -z "$CURL" ]; then
        echo "The installer needs either curl or wget to download files."
        echo "Please install either curl or wget to proceed."
        exit 1
    fi

    TEST_URL="https://pkgs.tailscale.com/"
    RC=0
    TEST_OUT=$($CURL "$TEST_URL" 2&gt;&amp;1) || RC=$?
    if [ $RC != 0 ]; then
        echo "The installer cannot reach $TEST_URL"
        echo "Please make sure that your machine has internet access."
        echo "Test output:"
        echo $TEST_OUT
        exit 1
    fi</code></pre>
</div>
</div>
<div id="032efbc2-636e-4ccc-957c-c7605ce9ea7a" class="cell" data-execution_count="10">
<details open="" class="code-fold">
<summary>Inspecting the TEST_URL site</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>TEST_URL<span class="op">=</span><span class="st">"https://pkgs.tailscale.com/"</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>test_url_resp <span class="op">=</span> requests.get(TEST_URL)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>test_url_resp.raise_for_status()</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>display(HTML(test_url_resp.text))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

  
    <link rel="stylesheet" href="../../minimal.css">
  

<h1>Tailscale™ Packages</h1>

<p>This server distributes <a href="https://www.tailscale.com">Tailscale</a> packages for various
operating systems.</p>

<p>Looking for the source code? It's on <a href="https://github.com/tailscale/tailscale">Github</a>.</p>



<p><b>Notice</b>: Use of this package server is governed by <a href="https://tailscale.com/terms">Tailscale's Terms of
Service</a>. By using this server to install Tailscale, you
acknowledge that you have read and accepted those terms.

</p><p>Tailscale packages come in different release tracks. Most users
should use the "stable" track. Other tracks are available, but may not
function as well. Currently available tracks are:

</p><ul>
  <li><a href="../../stable/">Stable</a>: The latest supported and tested version 
  that is considered the most reliable.</li>
  <li><a href="../../release-candidate/">Release Candidates</a>: The current release candidate 
  version actively being tested in preparation for the stable track.</li>
  <li><a href="../../unstable/">Unstable</a>: The very latest version available for testing. 
  This is updated very frequently and is not recommended for production environments.</li>
</ul>

<hr>

<p>Tailscale is a trademark of Tailscale Inc.</p>



</div>
</div>
</section>
<section id="os_unsupported-check" class="level2">
<h2 class="anchored" data-anchor-id="os_unsupported-check">OS_UNSUPPORTED check</h2>
<p>Then, the script checks to see if the detected <code>OS</code> is supported, saving that in the variable <code>OS_UNSUPPORTED</code>, which is initialized to be empty and reassigned the value <code>1</code> only if case-specific conditions are detected. If <code>OS_UNSUPPORTED == 1</code>, then the script prints out a message indicating tailscale isn’t available for the detected OS-version pair, and a copyable blurb users could email to tailscale support to potentially support future tailscale development.</p>
<div id="11ee2d49-8508-4430-853d-8d6930c0549e" class="cell" data-execution_count="11">
<details open="" class="code-fold">
<summary>The code block that checks if the invoking OS is supported</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(linux_script_lines.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)[<span class="dv">362</span>:<span class="dv">447</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    # Step 2: having detected an OS we support, is it one of the
    # versions we support?
    OS_UNSUPPORTED=
    case "$OS" in
        ubuntu|debian|raspbian|centos|oracle|rhel|amazon-linux|opensuse|photon)
            # Check with the package server whether a given version is supported.
            URL="https://pkgs.tailscale.com/$TRACK/$OS/$VERSION/installer-supported"
            $CURL "$URL" 2&gt; /dev/null | grep -q OK || OS_UNSUPPORTED=1
            ;;
        fedora)
            # All versions supported, no version checking required.
            ;;
        arch)
            # Rolling release, no version checking needed.
            ;;
        manjaro)
            # Rolling release, no version checking needed.
            ;;
        alpine)
            # All versions supported, no version checking needed.
            # TODO: is that true? When was tailscale packaged?
            ;;
        void)
            # Rolling release, no version checking needed.
            ;;
        gentoo)
            # Rolling release, no version checking needed.
            ;;
        freebsd)
            if [ "$VERSION" != "12" ] &amp;&amp; \
               [ "$VERSION" != "13" ]
            then
                OS_UNSUPPORTED=1
            fi
            ;;
        openbsd)
            OS_UNSUPPORTED=1
            ;;
        macos)
            # We delegate macOS installation to the app store, it will
            # perform version checks for us.
            ;;
        other-linux)
            OS_UNSUPPORTED=1
            ;;
        *)
            OS_UNSUPPORTED=1
            ;;
    esac
    if [ "$OS_UNSUPPORTED" = "1" ]; then
        case "$OS" in
            other-linux)
                echo "Couldn't determine what kind of Linux is running."
                echo "You could try the static binaries at:"
                echo "https://pkgs.tailscale.com/$TRACK/#static"
                ;;
            "")
                echo "Couldn't determine what operating system you're running."
                ;;
            *)
                echo "$OS $VERSION isn't supported by this script yet."
                ;;
        esac
        echo
        echo "If you'd like us to support your system better, please email support@tailscale.com"
        echo "and tell us what OS you're running."
        echo
        echo "Please include the following information we gathered from your system:"
        echo
        echo "OS=$OS"
        echo "VERSION=$VERSION"
        echo "PACKAGETYPE=$PACKAGETYPE"
        if type uname &gt;/dev/null 2&gt;&amp;1; then
            echo "UNAME=$(uname -a)"
        else
            echo "UNAME="
        fi
        echo
        if [ -f /etc/os-release ]; then
            cat /etc/os-release
        else
            echo "No /etc/os-release"
        fi
        exit 1
    fi</code></pre>
</div>
</div>
</section>
<section id="root-privilege-detection" class="level2">
<h2 class="anchored" data-anchor-id="root-privilege-detection">Root-privilege detection</h2>
<p>The script then checks to see if the running shell can run privileged commands (ie if it is the root user or if it can use the <code>sudo</code> or <code>doas</code> command).</p>
<p>If the running shell can’t run privileged commands, the script outputs a message and exits.</p>
<div id="e858741c-021e-4e1c-a712-96dd4191ddc1" class="cell" data-execution_count="12">
<details open="" class="code-fold">
<summary>The code block that checks for ability to run privileged commands</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(linux_script_lines.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)[<span class="dv">448</span>:<span class="dv">468</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    # Step 3: work out if we can run privileged commands, and if so,
    # how.
    CAN_ROOT=
    SUDO=
    if [ "$(id -u)" = 0 ]; then
        CAN_ROOT=1
        SUDO=""
    elif type sudo &gt;/dev/null; then
        CAN_ROOT=1
        SUDO="sudo"
    elif type doas &gt;/dev/null; then
        CAN_ROOT=1
        SUDO="doas"
    fi
    if [ "$CAN_ROOT" != "1" ]; then
        echo "This installer needs to run commands as root."
        echo "We tried looking for 'sudo' and 'doas', but couldn't find them."
        echo "Either re-run this script as root, or set up sudo/doas."
        exit 1
    fi</code></pre>
</div>
</div>
<div id="a07b2645-2c31-4ab5-9088-08a620ef5424" class="cell" data-execution_count="13">
<details open="" class="code-fold">
<summary>If the shell is running as root, the <code>uid</code> will be 0</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span><span class="bu">id</span> <span class="op">-</span>u</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>1000</code></pre>
</div>
</div>
<div id="43401961-8d6a-4ba8-8233-4cae70b42932" class="cell" data-execution_count="14">
<details open="" class="code-fold">
<summary>Checks if the shell can access the sudo command</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span><span class="bu">type</span> sudo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>sudo is /usr/bin/sudo</code></pre>
</div>
</div>
<div id="cf557328-d344-4afa-9900-9489a17456d9" class="cell" data-execution_count="15">
<details open="" class="code-fold">
<summary>Checks if the shell can access the doas command</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span><span class="bu">type</span> doas</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>/bin/bash: line 1: type: doas: not found</code></pre>
</div>
</div>
</section>
<section id="running-the-installation" class="level2">
<h2 class="anchored" data-anchor-id="running-the-installation">Running the installation</h2>
<p>This block of code actually does the work. I’ll dig into the Ubuntu/Debian case, as that’s my situation (and Ubuntu/Debian are the most popularly used linux distros by a wide margin).</p>
<p>For machines using the <code>apt</code> package manager, this script: 1. sets an env-var <code>DEBIAN_FRONTEND</code> to <code>noninteractive</code>, 2. ensures <code>gpg</code> is usable on the system (well, that <code>gnupg</code> is installed), 3. turns on command displaying (via <code>set -x</code>), 4. ensures the keyring dir exists, root can read/write to it, and all other groups and users can only read from that dir, 5. downloads the appropriate tailscale public key file and adds the appropriate tailscale package repo to the invoking-machine’s local keyring and package-source list, 6. updates package version intel and installs tailscale, and 7. starts <code>tailscaled</code>, the tailscale daemon.</p>
<div id="2afbaf07-b332-418f-9ce2-4b9088808bf7" class="cell" data-execution_count="16">
<details open="" class="code-fold">
<summary>The conditional block that installs tailscale</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(linux_script_lines.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)[<span class="dv">470</span>:<span class="dv">614</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    # Step 4: run the installation.
    OSVERSION="$OS"
    [ "$VERSION" != "" ] &amp;&amp; OSVERSION="$OSVERSION $VERSION"
    echo "Installing Tailscale for $OSVERSION, using method $PACKAGETYPE"
    case "$PACKAGETYPE" in
        apt)
            export DEBIAN_FRONTEND=noninteractive
            if [ "$APT_KEY_TYPE" = "legacy" ] &amp;&amp; ! type gpg &gt;/dev/null; then
                $SUDO apt-get update
                $SUDO apt-get install -y gnupg
            fi

            set -x
            $SUDO mkdir -p --mode=0755 /usr/share/keyrings
            case "$APT_KEY_TYPE" in
                legacy)
                    $CURL "https://pkgs.tailscale.com/$TRACK/$OS/$VERSION.asc" | $SUDO apt-key add -
                    $CURL "https://pkgs.tailscale.com/$TRACK/$OS/$VERSION.list" | $SUDO tee /etc/apt/sources.list.d/tailscale.list
                ;;
                keyring)
                    $CURL "https://pkgs.tailscale.com/$TRACK/$OS/$VERSION.noarmor.gpg" | $SUDO tee /usr/share/keyrings/tailscale-archive-keyring.gpg &gt;/dev/null
                    $CURL "https://pkgs.tailscale.com/$TRACK/$OS/$VERSION.tailscale-keyring.list" | $SUDO tee /etc/apt/sources.list.d/tailscale.list
                ;;
            esac
            $SUDO apt-get update
            $SUDO apt-get install -y tailscale tailscale-archive-keyring
            if [ "$APT_SYSTEMCTL_START" = "true" ]; then
                $SUDO systemctl enable --now tailscaled
                $SUDO systemctl start tailscaled
            fi
            set +x
        ;;
        yum)
            set -x
            $SUDO yum install yum-utils -y
            $SUDO yum-config-manager -y --add-repo "https://pkgs.tailscale.com/$TRACK/$OS/$VERSION/tailscale.repo"
            $SUDO yum install tailscale -y
            $SUDO systemctl enable --now tailscaled
            set +x
        ;;
        dnf)
            # DNF 5 has a different argument format; determine which one we have.
            DNF_VERSION="3"
            if dnf --version | grep -q '^dnf5 version'; then
                DNF_VERSION="5"
            fi

            # The 'config-manager' plugin wasn't implemented when
            # DNF5 was released; detect that and use the old
            # version if necessary.
            if [ "$DNF_VERSION" = "5" ]; then
                set -x
                $SUDO dnf install -y 'dnf-command(config-manager)' &amp;&amp; DNF_HAVE_CONFIG_MANAGER=1 || DNF_HAVE_CONFIG_MANAGER=0
                set +x

                if [ "$DNF_HAVE_CONFIG_MANAGER" != "1" ]; then
                    if type dnf-3 &gt;/dev/null; then
                        DNF_VERSION="3"
                    else
                        echo "dnf 5 detected, but 'dnf-command(config-manager)' not available and dnf-3 not found"
                        exit 1
                    fi
                fi
            fi

            set -x
            if [ "$DNF_VERSION" = "3" ]; then
                $SUDO dnf install -y 'dnf-command(config-manager)'
                $SUDO dnf config-manager --add-repo "https://pkgs.tailscale.com/$TRACK/$OS/$VERSION/tailscale.repo"
            elif [ "$DNF_VERSION" = "5" ]; then
                # Already installed config-manager, above.
                $SUDO dnf config-manager addrepo --from-repofile="https://pkgs.tailscale.com/$TRACK/$OS/$VERSION/tailscale.repo"
            else
                echo "unexpected: unknown dnf version $DNF_VERSION"
                exit 1
            fi
            $SUDO dnf install -y tailscale
            $SUDO systemctl enable --now tailscaled
            set +x
        ;;
        tdnf)
            set -x
            curl -fsSL "https://pkgs.tailscale.com/$TRACK/$OS/$VERSION/tailscale.repo" &gt; /etc/yum.repos.d/tailscale.repo
            $SUDO tdnf install -y tailscale
            $SUDO systemctl enable --now tailscaled
            set +x
        ;;
        zypper)
            set -x
            $SUDO rpm --import "https://pkgs.tailscale.com/$TRACK/$OS/$VERSION/repo.gpg"
            $SUDO zypper --non-interactive ar -g -r "https://pkgs.tailscale.com/$TRACK/$OS/$VERSION/tailscale.repo"
            $SUDO zypper --non-interactive --gpg-auto-import-keys refresh
            $SUDO zypper --non-interactive install tailscale
            $SUDO systemctl enable --now tailscaled
            set +x
            ;;
        pacman)
            set -x
            $SUDO pacman -S tailscale --noconfirm
            $SUDO systemctl enable --now tailscaled
            set +x
            ;;
        pkg)
            set -x
            $SUDO pkg install tailscale
            $SUDO service tailscaled enable
            $SUDO service tailscaled start
            set +x
            ;;
        apk)
            set -x
            if ! grep -Eq '^http.*/community$' /etc/apk/repositories; then
                if type setup-apkrepos &gt;/dev/null; then
                    $SUDO setup-apkrepos -c -1
                else
                    echo "installing tailscale requires the community repo to be enabled in /etc/apk/repositories"
                    exit 1
                fi
            fi
            $SUDO apk add tailscale
            $SUDO rc-update add tailscale
            $SUDO rc-service tailscale start
            set +x
            ;;
        xbps)
            set -x
            $SUDO xbps-install tailscale -y
            set +x
            ;;
        emerge)
            set -x
            $SUDO emerge --ask=n net-vpn/tailscale
            set +x
            ;;
        appstore)
            set -x
            open "https://apps.apple.com/us/app/tailscale/id1475387142"
            set +x
            ;;
        *)
            echo "unexpected: unknown package type $PACKAGETYPE"
            exit 1
            ;;
    esac</code></pre>
</div>
</div>
<div id="0e1d8857-c631-463a-b3f2-2bd098aa7e76" class="cell" data-execution_count="17">
<details open="" class="code-fold">
<summary>Checking the keys and repos</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>track <span class="op">=</span> <span class="st">"stable"</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>os <span class="op">=</span> <span class="st">"ubuntu"</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>version <span class="op">=</span> <span class="st">"jammy"</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># $CURL "https://pkgs.tailscale.com/$TRACK/$OS/$VERSION.asc" | $SUDO apt-key add -</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>legacy_key_url <span class="op">=</span> <span class="ss">f"https://pkgs.tailscale.com/</span><span class="sc">{</span>track<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>os<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>version<span class="sc">}</span><span class="ss">.asc"</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>legacy_key_resp <span class="op">=</span> requests.get(legacy_key_url)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>legacy_key_resp.raise_for_status()</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Legacy gpg key"</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(legacy_key_resp.text)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co"># $CURL "https://pkgs.tailscale.com/$TRACK/$OS/$VERSION.list" | $SUDO tee /etc/apt/sources.list.d/tailscale.list</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>legacy_pkg_repo_url <span class="op">=</span> <span class="ss">f"https://pkgs.tailscale.com/</span><span class="sc">{</span>track<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>os<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>version<span class="sc">}</span><span class="ss">.list"</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>legacy_pkg_repo_resp <span class="op">=</span> requests.get(legacy_pkg_repo_url)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>legacy_pkg_repo_resp.raise_for_status()</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>legacy_pkg_repo_resp<span class="sc">.</span>text<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="co"># $CURL "https://pkgs.tailscale.com/$TRACK/$OS/$VERSION.noarmor.gpg" | $SUDO tee /usr/share/keyrings/tailscale-archive-keyring.gpg &gt;/dev/null</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>keyring_keyfile_url <span class="op">=</span> <span class="ss">f"https://pkgs.tailscale.com/</span><span class="sc">{</span>track<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>os<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>version<span class="sc">}</span><span class="ss">.noarmor.gpg"</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>keyring_keyfile_resp <span class="op">=</span> requests.get(keyring_keyfile_url)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>keyring_keyfile_resp.raise_for_status()</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n\n</span><span class="ss">Modern keyring gpg key (compressed, binary format)"</span>)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(keyring_keyfile_resp.text)</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="co"># $CURL "https://pkgs.tailscale.com/$TRACK/$OS/$VERSION.tailscale-keyring.list" | $SUDO tee /etc/apt/sources.list.d/tailscale.list</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>keyring_pkg_repo_url <span class="op">=</span> <span class="ss">f"https://pkgs.tailscale.com/</span><span class="sc">{</span>track<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>os<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>version<span class="sc">}</span><span class="ss">.tailscale-keyring.list"</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>keyring_pkg_repo_resp <span class="op">=</span> requests.get(keyring_pkg_repo_url)</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>keyring_pkg_repo_resp.raise_for_status()</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>keyring_pkg_repo_resp<span class="sc">.</span>text<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Legacy gpg key
-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBF5UmbgBEADAA5mxC8EoWEf53RVdlhQJbNnQW7fctUA5yNcGUbGGGTk6XFqO
nlek0Us0FAl5KVBgcS0Bj+VSwKVI/wx91tnAWI36CHeMyPTawdT4FTcS2jZMHbcN
UMqM1mcGs3wEQmKz795lfy2cQdVktc886aAF8hy1GmZDSs2zcGMvq5KCNPuX3DD5
INPumZqRTjwSwlGptUZrJpKWH4KvuGr5PSy/NzC8uSCuhLbFJc1Q6dQGKlQxwh+q
AF4uQ1+bdy92GHiFsCMi7q43hiBg5J9r55M/skboXkNBlS6kFviP+PADHNZe5Vw0
0ERtD/HzYb3cH5YneZuYXvnJq2/XjaN6OwkQXuqQpusB5fhIyLXE5ZqNlwBzX71S
779tIyjShpPXf1HEVxNO8TdVncx/7Zx/FSdwUJm4PMYQmnwBIyKlYWlV2AGgfxFk
mt2VexyS5s4YA1POuyiwW0iH1Ppp9X14KtOfNimBa0yEzgW3CHTEg55MNZup6k2Q
mRGtRjeqM5cjrq/Ix15hISmgbZogPRkhz/tcalK38WWAR4h3N8eIoPasLr9i9OVe
8aqsyXefCrziaiJczA0kCqhoryUUtceMgvaHl+lIPwyW0XWwj+0q45qzjLvKet+V
Q8oKLT1nMr/whgeSJi99f/jE4sWIbHZ0wwR02ZCikKnS05arl3v+hiBKPQARAQAB
tERUYWlsc2NhbGUgSW5jLiAoUGFja2FnZSByZXBvc2l0b3J5IHNpZ25pbmcga2V5
KSA8aW5mb0B0YWlsc2NhbGUuY29tPokCTgQTAQgAOBYhBCWWqZ6qszghiTwKeUWM
qDKVf1hoBQJeVJm4AhsDBQsJCAcCBhUKCQgLAgQWAgMBAh4BAheAAAoJEEWMqDKV
f1hoWHEP/1DYd9WZrodyV5zy1izvj0FXtUReJi374gDn3cHrG6uYtXcE9HWZhxQD
6nDgYuey5sBhLvPQiE/sl5GYXNw/O95XVk8HS54BHCCYq1GeYkZaiCGLGFBA08JK
7PZItGsfdJHwHfhSMtGPS7Cpmylje9gh8ic56NAhC7c5tGTlD69Y8zGHjnRQC6Hg
wF34jdp8JTQpSctpmiOxOXN+eH8N59zb0k30CUym1Am438AR0PI6RBTnubBH+Xsc
eQhLJnmJ1bM6GP4agXw5T1G/qp95gjIddHXzOkEvrpVfJFCtp91VIlBwycspKYVp
1IKAdPM6CVf/YoDkawwm4y4OcmvNarA5dhWBG0Xqse4v1dlYbiHIFcDzXuMyrHYs
D2Wg8Hx8TD64uBHY0fp24nweCLnaZCckVUsnYjb0A494lgwveswbZeZ6JC5SbDKH
Tc2SE4jq+fsEEJsqsdHIC04d+pMXI95HinJHU1SLBTeKLvEF8Zuk7RTJyaUTjs7h
Ne+xWDmRjjR/D/GXBxNrM9mEq6Jvp/ilYTdWwAyrSmTdotHb+NWjAGpJWj5AZCH9
HeBr2mtVhvTu3KtCQmGpRiR18zMbmemRXUh+IX5hpWGzynhtnSt7vXOvhJdqqc1D
VennRMQZMb09wJjPcvLIApUMl69r29XmyB59NM3UggK/UCJrpYfmuQINBF5UmbgB
EADTSKKyeF3XWDxm3x67MOv1Zm3ocoe5xGDRApPkgqEMA+7/mjVlahNXqA8btmwM
z1BH5+trjOUoohFqhr9FPPLuKaS/pE7BBP38KzeA4KcTiEq5FQ4JzZAIRGyhsAr+
6bxcKV/tZirqOBQFC7bH2UAHH7uIKHDUbBIDFHjnmdIzJ5MBPMgqvSPZvcKWm40g
W+LWMGoSMH1Uxd+BvW74509eezL8p3ts42txVNvWMSKDkpiCRMBhfcf5c+YFXWbu
r5qus2mnVw0hIyYTUdRZIkOcYBalBjewVmGuSIISnUv76vHz133i0zh4JcXHUDqc
yLBUgVWckqci32ahy3jc4MdilPeAnjJQcpJVBtMUNTZ4KM7UxLmOa5hYwvooliFJ
wUFPB+1ZwN8d+Ly12gRKf8qA/iL8M5H4nQrML2dRJ8NKzP2U73Fw+n6S1ngrDX8k
TPhQBq4EDjDyX7SW3Liemj5BCuWJAo53/2cL9P9I5Nu3i2pLJOHzjBSXxWaMMmti
kopArlSMWMdsGgb0xYX+aSV7xW+tefYZJY1AFJ1x2ZgfIc+4zyuXnHYA2jVYLAfF
pApqwwn8JaTJWNhny/OtAss7XV/WuTEOMWXaTO9nyNmHla9KjxlBkDJG9sCcgYMg
aCAnoLRUABCWatxPly9ZlVbIPPzBAr8VN/TEUbceAH0nIwARAQABiQI2BBgBCAAg
FiEEJZapnqqzOCGJPAp5RYyoMpV/WGgFAl5UmbgCGwwACgkQRYyoMpV/WGji9w/8
Di9yLnnudvRnGLXGDDF2DbQUiwlNeJtHPHH4B9kKRKJDH1Rt5426Lw8vAumDpBlR
EeuT6/YQU+LSapWoDzNcmDLzoFP7RSQaB9aL/nJXv+VjlsVH/crpSTTgGDs8qGsL
O3Y2U1Gjo5uMBoOfXwS8o1VWO/5eUwS0KH7hpbOuZcf9U9l1VD2YpGfnMwX1rnre
INJqseQAUL3oyNl76gRzyuyQ4AIA06r40hZDgybH0ADN1JtfVk8z4ofo/GcfoXqm
hifWJa2SwwHeijhdN1T/kG0FZFHs1DBuBYJG3iJ3/bMeL15j1OjncIYIYccdoEUd
uHnp4+ZYj5kND0DFziTvOC4WyPpv3BlBVariPzEnEqnhjx5RYwMabtTXoYJwUkxX
2gAjKqh2tXissChdwDGRNASSDrChHLkQewx+SxT5kDaOhB84ZDnp+urn9A+clLkN
lZMsMQUObaRW68uybSbZSmIWFVM1GovRMgrPG3T6PAykQhFyE/kMFrv5KpPh7jDj
5JwzQkxLkFMcZDdS43VymKEggxqtM6scIRU55i059fLPAVXJG5in1WhMNsmt49lb
KqB6je3plIWOLSPuCJ/kR9xdFp7Qk88GCXEd0+4z/vFn4hoOr85NXFtxhS8k9GfJ
mM/ZfUq7YmHR+Rswe0zrrCwTDdePjGMo9cHpd39jCvc=
=AIVM
-----END PGP PUBLIC KEY BLOCK-----


# Tailscale packages for ubuntu jammy
deb https://pkgs.tailscale.com/stable/ubuntu jammy main



Modern keyring gpg key (compressed, binary format)
Pʌ�g�|Bb���e-�A�d��&lt;���fCJͳpc/���4���0� ��N&lt;�Q��Fk&amp;�����j�=,�70�� ����%�P��*T1��^.C_�w/vx��#"�7� `�k�?�F�^CA�.������^�\4�Dm��a���'y��^�ɫo׍�z; ^ꐦ���Hȵ�嚍�s_�R�m#(҆��Q�WN�7U���'pP��&lt;��|#"�aiU��d�ݕ{���Sλ(�[H���i�}x*ӟ6)�kL��tă�L5���M���F7�3�#����^a!)�m� =!��\jR��e�G�w7ǈ���.�b��^��w�
$�j"\�
�h�%�ǌ�����H?��u���*㚳���zߕC�
-=g2����&amp;/}���ňlvt�tِ����Ӗ��{�� J=�DTailscale Inc. (Package repository signing key) &lt;info@tailscale.com&gt;�N8!%�����8!�&lt;
yE��2�Xh^T��
�
^T���H��x]�X&lt;f��0��fm�r���`��䂡���5ejW��l�PG��k��(�j��E&lt;��)���N���+7���J�   Dl�����/��Xn!���^�2�v,e��||L&gt;�����v�|��d'$UK'b6��x�/z�e�z$.Rl2�M͒�����*���N��#�G�rGST�7�.����ɥ���5�X9��4�k3ل��o���a7V��Jdݢ���գjIZ&gt;@d!��k�kU���ܫBBa�F$u�3��]H~!~a�a��xm�+{�s���j��CU��D�1�=���r�����k����}4�Ԃ�P"k���
!#&amp;Q�Y"C�`�7�Va�H��K�����}��8x%��P:�ȰT�U���"�f��x���b����2Pr�U�56x(��Ĺ�k�X��(�!I�AO�Y������Jʀ�"�3���
$L�P�0�_��ܸ��&gt;A
��w�g��H�۷�jK$����f�2kb��@�T�X�l�Ņ�i%{�o�y�%�@�q٘!ϸ�+��v�5X,Ť
j�  �%��X�g���;]_ֹ11e�L�g�ه��J�A�2F����� h '��T�j�O�/Y�V�&lt;���7��Q�}'#�6 !%�����8!�&lt;
yE��2�Xh^T��
�� Mx�G&lt;q���/r.y�v�g��1v
��,1m�V�˲m&amp;�JbS5��2Qcn�ס�pRLW�#*�v�x��(]�1�4����{~K��6��8d9��������~ᥳ�e��S�uT=��g�3��z� �j��P����{�s���Ӫ��C�&amp;���ԛ_VO3���g�z��'�%���ފ8]7T��mdQ��0n�F�"w��/^c���pa��E�y���X��
׏�c(���wc���*���0��3BLK�Sd7R�ur�� ��3�!9�-9���U����hL6ɭ��[*�z��锅�-#��G�]�Г� q��3��g���M\[q�/$�gɘ��}J�ba��{L�,
�

# Tailscale packages for ubuntu jammy
deb [signed-by=/usr/share/keyrings/tailscale-archive-keyring.gpg] https://pkgs.tailscale.com/stable/ubuntu jammy main
</code></pre>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Looks fine and straightforward. There’s nothing sneaky in this script.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.matttriano\.dev");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>